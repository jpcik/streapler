(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.$rdf = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (process){
!function(){function n(n){var e=!1;return function(){if(e)throw new Error("Callback was already called.");e=!0,n.apply(t,arguments)}}var t,e,r={};t=this,null!=t&&(e=t.async),r.noConflict=function(){return t.async=e,r};var i=Object.prototype.toString,u=Array.isArray||function(n){return"[object Array]"===i.call(n)},c=function(n,t){for(var e=0;e<n.length;e+=1)t(n[e],e,n)},o=function(n,t){if(n.map)return n.map(t);var e=[];return c(n,function(n,r,i){e.push(t(n,r,i))}),e},a=function(n,t,e){return n.reduce?n.reduce(t,e):(c(n,function(n,r,i){e=t(e,n,r,i)}),e)},l=function(n){if(Object.keys)return Object.keys(n);var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t};"undefined"!=typeof process&&process.nextTick?(r.nextTick=process.nextTick,"undefined"!=typeof setImmediate?r.setImmediate=function(n){setImmediate(n)}:r.setImmediate=r.nextTick):"function"==typeof setImmediate?(r.nextTick=function(n){setImmediate(n)},r.setImmediate=r.nextTick):(r.nextTick=function(n){setTimeout(n,0)},r.setImmediate=r.nextTick),r.each=function(t,e,r){function i(n){n?(r(n),r=function(){}):(u+=1,u>=t.length&&r())}if(r=r||function(){},!t.length)return r();var u=0;c(t,function(t){e(t,n(i))})},r.forEach=r.each,r.eachSeries=function(n,t,e){if(e=e||function(){},!n.length)return e();var r=0,i=function(){t(n[r],function(t){t?(e(t),e=function(){}):(r+=1,r>=n.length?e():i())})};i()},r.forEachSeries=r.eachSeries,r.eachLimit=function(n,t,e,r){var i=f(t);i.apply(null,[n,e,r])},r.forEachLimit=r.eachLimit;var f=function(n){return function(t,e,r){if(r=r||function(){},!t.length||0>=n)return r();var i=0,u=0,c=0;!function o(){if(i>=t.length)return r();for(;n>c&&u<t.length;)u+=1,c+=1,e(t[u-1],function(n){n?(r(n),r=function(){}):(i+=1,c-=1,i>=t.length?r():o())})}()}},s=function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(null,[r.each].concat(t))}},p=function(n,t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[f(n)].concat(e))}},d=function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(null,[r.eachSeries].concat(t))}},y=function(n,t,e,r){if(t=o(t,function(n,t){return{index:t,value:n}}),r){var i=[];n(t,function(n,t){e(n.value,function(e,r){i[n.index]=r,t(e)})},function(n){r(n,i)})}else n(t,function(n,t){e(n.value,function(n){t(n)})})};r.map=s(y),r.mapSeries=d(y),r.mapLimit=function(n,t,e,r){return v(t)(n,e,r)};var v=function(n){return p(n,y)};r.reduce=function(n,t,e,i){r.eachSeries(n,function(n,r){e(t,n,function(n,e){t=e,r(n)})},function(n){i(n,t)})},r.inject=r.reduce,r.foldl=r.reduce,r.reduceRight=function(n,t,e,i){var u=o(n,function(n){return n}).reverse();r.reduce(u,t,e,i)},r.foldr=r.reduceRight;var h=function(n,t,e,r){var i=[];t=o(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e){e&&i.push(n),t()})},function(n){r(o(i.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})};r.filter=s(h),r.filterSeries=d(h),r.select=r.filter,r.selectSeries=r.filterSeries;var m=function(n,t,e,r){var i=[];t=o(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e){e||i.push(n),t()})},function(n){r(o(i.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})};r.reject=s(m),r.rejectSeries=d(m);var g=function(n,t,e,r){n(t,function(n,t){e(n,function(e){e?(r(n),r=function(){}):t()})},function(n){r()})};r.detect=s(g),r.detectSeries=d(g),r.some=function(n,t,e){r.each(n,function(n,r){t(n,function(n){n&&(e(!0),e=function(){}),r()})},function(n){e(!1)})},r.any=r.some,r.every=function(n,t,e){r.each(n,function(n,r){t(n,function(n){n||(e(!1),e=function(){}),r()})},function(n){e(!0)})},r.all=r.every,r.sortBy=function(n,t,e){r.map(n,function(n,e){t(n,function(t,r){t?e(t):e(null,{value:n,criteria:r})})},function(n,t){if(n)return e(n);var r=function(n,t){var e=n.criteria,r=t.criteria;return r>e?-1:e>r?1:0};e(null,o(t.sort(r),function(n){return n.value}))})},r.auto=function(n,t){t=t||function(){};var e=l(n),i=e.length;if(!i)return t();var o={},f=[],s=function(n){f.unshift(n)},p=function(n){for(var t=0;t<f.length;t+=1)if(f[t]===n)return void f.splice(t,1)},d=function(){i--,c(f.slice(0),function(n){n()})};s(function(){if(!i){var n=t;t=function(){},n(null,o)}}),c(e,function(e){var i=u(n[e])?n[e]:[n[e]],f=function(n){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),n){var u={};c(l(o),function(n){u[n]=o[n]}),u[e]=i,t(n,u),t=function(){}}else o[e]=i,r.setImmediate(d)},y=i.slice(0,Math.abs(i.length-1))||[],v=function(){return a(y,function(n,t){return n&&o.hasOwnProperty(t)},!0)&&!o.hasOwnProperty(e)};if(v())i[i.length-1](f,o);else{var h=function(){v()&&(p(h),i[i.length-1](f,o))};s(h)}})},r.retry=function(n,t,e){var i=5,u=[];"function"==typeof n&&(e=t,t=n,n=i),n=parseInt(n,10)||i;var c=function(i,c){for(var o=function(n,t){return function(e){n(function(n,r){e(!n||t,{err:n,result:r})},c)}};n;)u.push(o(t,!(n-=1)));r.series(u,function(n,t){t=t[t.length-1],(i||e)(t.err,t.result)})};return e?c():c},r.waterfall=function(n,t){if(t=t||function(){},!u(n)){var e=new Error("First argument to waterfall must be an array of functions");return t(e)}if(!n.length)return t();var i=function(n){return function(e){if(e)t.apply(null,arguments),t=function(){};else{var u=Array.prototype.slice.call(arguments,1),c=n.next();c?u.push(i(c)):u.push(t),r.setImmediate(function(){n.apply(null,u)})}}};i(r.iterator(n))()};var k=function(n,t,e){if(e=e||function(){},u(t))n.map(t,function(n,t){n&&n(function(n){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),t.call(null,n,e)})},e);else{var r={};n.each(l(t),function(n,e){t[n](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[n]=i,e(t)})},function(n){e(n,r)})}};r.parallel=function(n,t){k({map:r.map,each:r.each},n,t)},r.parallelLimit=function(n,t,e){k({map:v(t),each:f(t)},n,e)},r.series=function(n,t){if(t=t||function(){},u(n))r.mapSeries(n,function(n,t){n&&n(function(n){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),t.call(null,n,e)})},t);else{var e={};r.eachSeries(l(n),function(t,r){n[t](function(n){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),e[t]=i,r(n)})},function(n){t(n,e)})}},r.iterator=function(n){var t=function(e){var r=function(){return n.length&&n[e].apply(null,arguments),r.next()};return r.next=function(){return e<n.length-1?t(e+1):null},r};return t(0)},r.apply=function(n){var t=Array.prototype.slice.call(arguments,1);return function(){return n.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var A=function(n,t,e,r){var i=[];n(t,function(n,t){e(n,function(n,e){i=i.concat(e||[]),t(n)})},function(n){r(n,i)})};r.concat=s(A),r.concatSeries=d(A),r.whilst=function(n,t,e){n()?t(function(i){return i?e(i):void r.whilst(n,t,e)}):e()},r.doWhilst=function(n,t,e){n(function(i){if(i)return e(i);var u=Array.prototype.slice.call(arguments,1);t.apply(null,u)?r.doWhilst(n,t,e):e()})},r.until=function(n,t,e){n()?e():t(function(i){return i?e(i):void r.until(n,t,e)})},r.doUntil=function(n,t,e){n(function(i){if(i)return e(i);var u=Array.prototype.slice.call(arguments,1);t.apply(null,u)?e():r.doUntil(n,t,e)})},r.queue=function(t,e){function i(n,t,e,i){return n.started||(n.started=!0),u(t)||(t=[t]),0==t.length?r.setImmediate(function(){n.drain&&n.drain()}):void c(t,function(t){var u={data:t,callback:"function"==typeof i?i:null};e?n.tasks.unshift(u):n.tasks.push(u),n.saturated&&n.tasks.length===n.concurrency&&n.saturated(),r.setImmediate(n.process)})}void 0===e&&(e=1);var o=0,a={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(n,t){i(a,n,!1,t)},kill:function(){a.drain=null,a.tasks=[]},unshift:function(n,t){i(a,n,!0,t)},process:function(){if(!a.paused&&o<a.concurrency&&a.tasks.length){var e=a.tasks.shift();a.empty&&0===a.tasks.length&&a.empty(),o+=1;var r=function(){o-=1,e.callback&&e.callback.apply(e,arguments),a.drain&&a.tasks.length+o===0&&a.drain(),a.process()},i=n(r);t(e.data,i)}},length:function(){return a.tasks.length},running:function(){return o},idle:function(){return a.tasks.length+o===0},pause:function(){a.paused!==!0&&(a.paused=!0)},resume:function(){if(a.paused!==!1){a.paused=!1;for(var n=1;n<=a.concurrency;n++)r.setImmediate(a.process)}}};return a},r.priorityQueue=function(n,t){function e(n,t){return n.priority-t.priority}function i(n,t,e){for(var r=-1,i=n.length-1;i>r;){var u=r+(i-r+1>>>1);e(t,n[u])>=0?r=u:i=u-1}return r}function o(n,t,o,a){return n.started||(n.started=!0),u(t)||(t=[t]),0==t.length?r.setImmediate(function(){n.drain&&n.drain()}):void c(t,function(t){var u={data:t,priority:o,callback:"function"==typeof a?a:null};n.tasks.splice(i(n.tasks,u,e)+1,0,u),n.saturated&&n.tasks.length===n.concurrency&&n.saturated(),r.setImmediate(n.process)})}var a=r.queue(n,t);return a.push=function(n,t,e){o(a,n,t,e)},delete a.unshift,a},r.cargo=function(n,t){var e=!1,i=[],a={tasks:i,payload:t,saturated:null,empty:null,drain:null,drained:!0,push:function(n,e){u(n)||(n=[n]),c(n,function(n){i.push({data:n,callback:"function"==typeof e?e:null}),a.drained=!1,a.saturated&&i.length===t&&a.saturated()}),r.setImmediate(a.process)},process:function l(){if(!e){if(0===i.length)return a.drain&&!a.drained&&a.drain(),void(a.drained=!0);var r="number"==typeof t?i.splice(0,t):i.splice(0,i.length),u=o(r,function(n){return n.data});a.empty&&a.empty(),e=!0,n(u,function(){e=!1;var n=arguments;c(r,function(t){t.callback&&t.callback.apply(null,n)}),l()})}},length:function(){return i.length},running:function(){return e}};return a};var x=function(n){return function(t){var e=Array.prototype.slice.call(arguments,1);t.apply(null,e.concat([function(t){var e=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[n]&&c(e,function(t){console[n](t)}))}]))}};r.log=x("log"),r.dir=x("dir"),r.memoize=function(n,t){var e={},i={};t=t||function(n){return n};var u=function(){var u=Array.prototype.slice.call(arguments),c=u.pop(),o=t.apply(null,u);o in e?r.nextTick(function(){c.apply(null,e[o])}):o in i?i[o].push(c):(i[o]=[c],n.apply(null,u.concat([function(){e[o]=arguments;var n=i[o];delete i[o];for(var t=0,r=n.length;r>t;t++)n[t].apply(null,arguments)}])))};return u.memo=e,u.unmemoized=n,u},r.unmemoize=function(n){return function(){return(n.unmemoized||n).apply(null,arguments)}},r.times=function(n,t,e){for(var i=[],u=0;n>u;u++)i.push(u);return r.map(i,t,e)},r.timesSeries=function(n,t,e){for(var i=[],u=0;n>u;u++)i.push(u);return r.mapSeries(i,t,e)},r.seq=function(){var n=arguments;return function(){var t=this,e=Array.prototype.slice.call(arguments),i=e.pop();r.reduce(n,e,function(n,e,r){e.apply(t,n.concat([function(){var n=arguments[0],t=Array.prototype.slice.call(arguments,1);r(n,t)}]))},function(n,e){i.apply(t,[n].concat(e))})}},r.compose=function(){return r.seq.apply(null,Array.prototype.reverse.call(arguments))};var S=function(n,t){var e=function(){var e=this,r=Array.prototype.slice.call(arguments),i=r.pop();return n(t,function(n,t){n.apply(e,r.concat([t]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return e.apply(this,r)}return e};r.applyEach=s(S),r.applyEachSeries=d(S),r.forever=function(n,t){function e(r){if(r){if(t)return t(r);throw r}n(e)}e()},"undefined"!=typeof module&&module.exports?module.exports=r:"undefined"!=typeof define&&define.amd?define([],function(){return r}):t.async=r}();
}).call(this,require('_process'))

},{"_process":24}],2:[function(require,module,exports){
!function(t){"use strict";function r(t){var r=t.charCodeAt(0);return r===c||r===f?62:r===o||r===d?63:A>r?-1:A+10>r?r-A+26+26:u+26>r?r-u:i+26>r?r-i+26:void 0}function e(t){function e(t){i[f++]=t}var n,a,c,o,A,i;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u=t.length;A="="===t.charAt(u-2)?2:"="===t.charAt(u-1)?1:0,i=new h(3*t.length/4-A),c=A>0?t.length-4:t.length;var f=0;for(n=0,a=0;c>n;n+=4,a+=3)o=r(t.charAt(n))<<18|r(t.charAt(n+1))<<12|r(t.charAt(n+2))<<6|r(t.charAt(n+3)),e((16711680&o)>>16),e((65280&o)>>8),e(255&o);return 2===A?(o=r(t.charAt(n))<<2|r(t.charAt(n+1))>>4,e(255&o)):1===A&&(o=r(t.charAt(n))<<10|r(t.charAt(n+1))<<4|r(t.charAt(n+2))>>2,e(o>>8&255),e(255&o)),i}function n(t){function r(t){return a.charAt(t)}function e(t){return r(t>>18&63)+r(t>>12&63)+r(t>>6&63)+r(63&t)}var n,h,c,o=t.length%3,A="";for(n=0,c=t.length-o;c>n;n+=3)h=(t[n]<<16)+(t[n+1]<<8)+t[n+2],A+=e(h);switch(o){case 1:h=t[t.length-1],A+=r(h>>2),A+=r(h<<4&63),A+="==";break;case 2:h=(t[t.length-2]<<8)+t[t.length-1],A+=r(h>>10),A+=r(h>>4&63),A+=r(h<<2&63),A+="="}return A}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="undefined"!=typeof Uint8Array?Uint8Array:Array,c="+".charCodeAt(0),o="/".charCodeAt(0),A="0".charCodeAt(0),i="a".charCodeAt(0),u="A".charCodeAt(0),f="-".charCodeAt(0),d="_".charCodeAt(0);t.toByteArray=e,t.fromByteArray=n}("undefined"==typeof exports?this.base64js={}:exports);
},{}],3:[function(require,module,exports){

},{}],4:[function(require,module,exports){
(function (global){
"use strict";function typedArraySupport(){try{var t=new Uint8Array(1);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(t){return this instanceof Buffer?(Buffer.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof t?fromNumber(this,t):"string"==typeof t?fromString(this,t,arguments.length>1?arguments[1]:"utf8"):fromObject(this,t)):arguments.length>1?new Buffer(t,arguments[1]):new Buffer(t)}function fromNumber(t,e){if(t=allocate(t,0>e?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;e>r;r++)t[r]=0;return t}function fromString(t,e,r){"string"==typeof r&&""!==r||(r="utf8");var n=0|byteLength(e,r);return t=allocate(t,n),t.write(e,r),t}function fromObject(t,e){if(Buffer.isBuffer(e))return fromBuffer(t,e);if(isArray(e))return fromArray(t,e);if(null==e)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(e.buffer instanceof ArrayBuffer)return fromTypedArray(t,e);if(e instanceof ArrayBuffer)return fromArrayBuffer(t,e)}return e.length?fromArrayLike(t,e):fromJsonObject(t,e)}function fromBuffer(t,e){var r=0|checked(e.length);return t=allocate(t,r),e.copy(t,0,0,r),t}function fromArray(t,e){var r=0|checked(e.length);t=allocate(t,r);for(var n=0;r>n;n+=1)t[n]=255&e[n];return t}function fromTypedArray(t,e){var r=0|checked(e.length);t=allocate(t,r);for(var n=0;r>n;n+=1)t[n]=255&e[n];return t}function fromArrayBuffer(t,e){return e.byteLength,Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=Buffer.prototype):t=fromTypedArray(t,new Uint8Array(e)),t}function fromArrayLike(t,e){var r=0|checked(e.length);t=allocate(t,r);for(var n=0;r>n;n+=1)t[n]=255&e[n];return t}function fromJsonObject(t,e){var r,n=0;"Buffer"===e.type&&isArray(e.data)&&(r=e.data,n=0|checked(r.length)),t=allocate(t,n);for(var f=0;n>f;f+=1)t[f]=255&r[f];return t}function allocate(t,e){Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=Buffer.prototype):t.length=e;var r=0!==e&&e<=Buffer.poolSize>>>1;return r&&(t.parent=rootParent),t}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function SlowBuffer(t,e){if(!(this instanceof SlowBuffer))return new SlowBuffer(t,e);var r=new Buffer(t,e);return delete r.parent,r}function byteLength(t,e){"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"binary":case"raw":case"raws":return r;case"utf8":case"utf-8":return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(t).length;default:if(n)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),n=!0}}function slowToString(t,e,r){var n=!1;if(e=0|e,r=void 0===r||r===1/0?this.length:0|r,t||(t="utf8"),0>e&&(e=0),r>this.length&&(r=this.length),e>=r)return"";for(;;)switch(t){case"hex":return hexSlice(this,e,r);case"utf8":case"utf-8":return utf8Slice(this,e,r);case"ascii":return asciiSlice(this,e,r);case"binary":return binarySlice(this,e,r);case"base64":return base64Slice(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function hexWrite(t,e,r,n){r=Number(r)||0;var f=t.length-r;n?(n=Number(n),n>f&&(n=f)):n=f;var i=e.length;if(i%2!==0)throw new Error("Invalid hex string");n>i/2&&(n=i/2);for(var o=0;n>o;o++){var u=parseInt(e.substr(2*o,2),16);if(isNaN(u))throw new Error("Invalid hex string");t[r+o]=u}return o}function utf8Write(t,e,r,n){return blitBuffer(utf8ToBytes(e,t.length-r),t,r,n)}function asciiWrite(t,e,r,n){return blitBuffer(asciiToBytes(e),t,r,n)}function binaryWrite(t,e,r,n){return asciiWrite(t,e,r,n)}function base64Write(t,e,r,n){return blitBuffer(base64ToBytes(e),t,r,n)}function ucs2Write(t,e,r,n){return blitBuffer(utf16leToBytes(e,t.length-r),t,r,n)}function base64Slice(t,e,r){return 0===e&&r===t.length?base64.fromByteArray(t):base64.fromByteArray(t.slice(e,r))}function utf8Slice(t,e,r){r=Math.min(t.length,r);for(var n=[],f=e;r>f;){var i=t[f],o=null,u=i>239?4:i>223?3:i>191?2:1;if(r>=f+u){var s,h,a,c;switch(u){case 1:128>i&&(o=i);break;case 2:s=t[f+1],128===(192&s)&&(c=(31&i)<<6|63&s,c>127&&(o=c));break;case 3:s=t[f+1],h=t[f+2],128===(192&s)&&128===(192&h)&&(c=(15&i)<<12|(63&s)<<6|63&h,c>2047&&(55296>c||c>57343)&&(o=c));break;case 4:s=t[f+1],h=t[f+2],a=t[f+3],128===(192&s)&&128===(192&h)&&128===(192&a)&&(c=(15&i)<<18|(63&s)<<12|(63&h)<<6|63&a,c>65535&&1114112>c&&(o=c))}}null===o?(o=65533,u=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),f+=u}return decodeCodePointsArray(n)}function decodeCodePointsArray(t){var e=t.length;if(MAX_ARGUMENTS_LENGTH>=e)return String.fromCharCode.apply(String,t);for(var r="",n=0;e>n;)r+=String.fromCharCode.apply(String,t.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(t,e,r){var n="";r=Math.min(t.length,r);for(var f=e;r>f;f++)n+=String.fromCharCode(127&t[f]);return n}function binarySlice(t,e,r){var n="";r=Math.min(t.length,r);for(var f=e;r>f;f++)n+=String.fromCharCode(t[f]);return n}function hexSlice(t,e,r){var n=t.length;(!e||0>e)&&(e=0),(!r||0>r||r>n)&&(r=n);for(var f="",i=e;r>i;i++)f+=toHex(t[i]);return f}function utf16leSlice(t,e,r){for(var n=t.slice(e,r),f="",i=0;i<n.length;i+=2)f+=String.fromCharCode(n[i]+256*n[i+1]);return f}function checkOffset(t,e,r){if(t%1!==0||0>t)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,r,n,f,i){if(!Buffer.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");if(e>f||i>e)throw new RangeError("value is out of bounds");if(r+n>t.length)throw new RangeError("index out of range")}function objectWriteUInt16(t,e,r,n){0>e&&(e=65535+e+1);for(var f=0,i=Math.min(t.length-r,2);i>f;f++)t[r+f]=(e&255<<8*(n?f:1-f))>>>8*(n?f:1-f)}function objectWriteUInt32(t,e,r,n){0>e&&(e=4294967295+e+1);for(var f=0,i=Math.min(t.length-r,4);i>f;f++)t[r+f]=e>>>8*(n?f:3-f)&255}function checkIEEE754(t,e,r,n,f,i){if(r+n>t.length)throw new RangeError("index out of range");if(0>r)throw new RangeError("index out of range")}function writeFloat(t,e,r,n,f){return f||checkIEEE754(t,e,r,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(t,e,r,n,23,4),r+4}function writeDouble(t,e,r,n,f){return f||checkIEEE754(t,e,r,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(t,e,r,n,52,8),r+8}function base64clean(t){if(t=stringtrim(t).replace(INVALID_BASE64_RE,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function toHex(t){return 16>t?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){e=e||1/0;for(var r,n=t.length,f=null,i=[],o=0;n>o;o++){if(r=t.charCodeAt(o),r>55295&&57344>r){if(!f){if(r>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&i.push(239,191,189);continue}f=r;continue}if(56320>r){(e-=3)>-1&&i.push(239,191,189),f=r;continue}r=(f-55296<<10|r-56320)+65536}else f&&(e-=3)>-1&&i.push(239,191,189);if(f=null,128>r){if((e-=1)<0)break;i.push(r)}else if(2048>r){if((e-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(65536>r){if((e-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(1114112>r))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function asciiToBytes(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e}function utf16leToBytes(t,e){for(var r,n,f,i=[],o=0;o<t.length&&!((e-=2)<0);o++)r=t.charCodeAt(o),n=r>>8,f=r%256,i.push(f),i.push(n);return i}function base64ToBytes(t){return base64.toByteArray(base64clean(t))}function blitBuffer(t,e,r,n){for(var f=0;n>f&&!(f+r>=e.length||f>=t.length);f++)e[f+r]=t[f];return f}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("isarray");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:typedArraySupport(),Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.TYPED_ARRAY_SUPPORT?(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array):(Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0),Buffer.isBuffer=function(t){return!(null==t||!t._isBuffer)},Buffer.compare=function(t,e){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,f=0,i=Math.min(r,n);i>f&&t[f]===e[f];)++f;return f!==i&&(r=t[f],n=e[f]),n>r?-1:r>n?1:0},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(t,e){if(!isArray(t))throw new TypeError("list argument must be an Array of Buffers.");if(0===t.length)return new Buffer(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;r++)e+=t[r].length;var n=new Buffer(e),f=0;for(r=0;r<t.length;r++){var i=t[r];i.copy(n,f),f+=i.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:0===Buffer.compare(this,t)},Buffer.prototype.inspect=function(){var t="",e=exports.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?0:Buffer.compare(this,t)},Buffer.prototype.indexOf=function(t,e){function r(t,e,r){for(var n=-1,f=0;r+f<t.length;f++)if(t[r+f]===e[-1===n?0:f-n]){if(-1===n&&(n=f),f-n+1===e.length)return r+n}else n=-1;return-1}if(e>2147483647?e=2147483647:-2147483648>e&&(e=-2147483648),e>>=0,0===this.length)return-1;if(e>=this.length)return-1;if(0>e&&(e=Math.max(this.length+e,0)),"string"==typeof t)return 0===t.length?-1:String.prototype.indexOf.call(this,t,e);if(Buffer.isBuffer(t))return r(this,t,e);if("number"==typeof t)return Buffer.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,t,e):r(this,[t],e);throw new TypeError("val must be string, number or Buffer")},Buffer.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e=0|e,isFinite(r)?(r=0|r,void 0===n&&(n="utf8")):(n=r,r=void 0);else{var f=n;n=e,e=0|r,r=f}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(0>r||0>e)||e>this.length)throw new RangeError("attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return hexWrite(this,t,e,r);case"utf8":case"utf-8":return utf8Write(this,t,e,r);case"ascii":return asciiWrite(this,t,e,r);case"binary":return binaryWrite(this,t,e,r);case"base64":return base64Write(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,0>t?(t+=r,0>t&&(t=0)):t>r&&(t=r),0>e?(e+=r,0>e&&(e=0)):e>r&&(e=r),t>e&&(e=t);var n;if(Buffer.TYPED_ARRAY_SUPPORT)n=this.subarray(t,e),n.__proto__=Buffer.prototype;else{var f=e-t;n=new Buffer(f,void 0);for(var i=0;f>i;i++)n[i]=this[i+t]}return n.length&&(n.parent=this.parent||this),n},Buffer.prototype.readUIntLE=function(t,e,r){t=0|t,e=0|e,r||checkOffset(t,e,this.length);for(var n=this[t],f=1,i=0;++i<e&&(f*=256);)n+=this[t+i]*f;return n},Buffer.prototype.readUIntBE=function(t,e,r){t=0|t,e=0|e,r||checkOffset(t,e,this.length);for(var n=this[t+--e],f=1;e>0&&(f*=256);)n+=this[t+--e]*f;return n},Buffer.prototype.readUInt8=function(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function(t,e,r){t=0|t,e=0|e,r||checkOffset(t,e,this.length);for(var n=this[t],f=1,i=0;++i<e&&(f*=256);)n+=this[t+i]*f;return f*=128,n>=f&&(n-=Math.pow(2,8*e)),n},Buffer.prototype.readIntBE=function(t,e,r){t=0|t,e=0|e,r||checkOffset(t,e,this.length);for(var n=e,f=1,i=this[t+--n];n>0&&(f*=256);)i+=this[t+--n]*f;return f*=128,i>=f&&(i-=Math.pow(2,8*e)),i},Buffer.prototype.readInt8=function(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function(t,e){return e||checkOffset(t,4,this.length),ieee754.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function(t,e){return e||checkOffset(t,4,this.length),ieee754.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function(t,e){return e||checkOffset(t,8,this.length),ieee754.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function(t,e){return e||checkOffset(t,8,this.length),ieee754.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function(t,e,r,n){t=+t,e=0|e,r=0|r,n||checkInt(this,t,e,r,Math.pow(2,8*r),0);var f=1,i=0;for(this[e]=255&t;++i<r&&(f*=256);)this[e+i]=t/f&255;return e+r},Buffer.prototype.writeUIntBE=function(t,e,r,n){t=+t,e=0|e,r=0|r,n||checkInt(this,t,e,r,Math.pow(2,8*r),0);var f=r-1,i=1;for(this[e+f]=255&t;--f>=0&&(i*=256);)this[e+f]=t/i&255;return e+r},Buffer.prototype.writeUInt8=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Buffer.prototype.writeUInt16LE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e=0|e,!n){var f=Math.pow(2,8*r-1);checkInt(this,t,e,r,f-1,-f)}var i=0,o=1,u=0>t?1:0;for(this[e]=255&t;++i<r&&(o*=256);)this[e+i]=(t/o>>0)-u&255;return e+r},Buffer.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e=0|e,!n){var f=Math.pow(2,8*r-1);checkInt(this,t,e,r,f-1,-f)}var i=r-1,o=1,u=0>t?1:0;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=(t/o>>0)-u&255;return e+r},Buffer.prototype.writeInt8=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),0>t&&(t=255+t+1),this[e]=255&t,e+1},Buffer.prototype.writeInt16LE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function(t,e,r){return writeFloat(this,t,e,!0,r)},Buffer.prototype.writeFloatBE=function(t,e,r){return writeFloat(this,t,e,!1,r)},Buffer.prototype.writeDoubleLE=function(t,e,r){return writeDouble(this,t,e,!0,r)},Buffer.prototype.writeDoubleBE=function(t,e,r){return writeDouble(this,t,e,!1,r)},Buffer.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&r>n&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(0>e)throw new RangeError("targetStart out of bounds");if(0>r||r>=this.length)throw new RangeError("sourceStart out of bounds");if(0>n)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var f,i=n-r;if(this===t&&e>r&&n>e)for(f=i-1;f>=0;f--)t[f+e]=this[f+r];else if(1e3>i||!Buffer.TYPED_ARRAY_SUPPORT)for(f=0;i>f;f++)t[f+e]=this[f+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+i),e);return i},Buffer.prototype.fill=function(t,e,r){if(t||(t=0),e||(e=0),r||(r=this.length),e>r)throw new RangeError("end < start");if(r!==e&&0!==this.length){if(0>e||e>=this.length)throw new RangeError("start out of bounds");if(0>r||r>this.length)throw new RangeError("end out of bounds");var n;if("number"==typeof t)for(n=e;r>n;n++)this[n]=t;else{var f=utf8ToBytes(t.toString()),i=f.length;for(n=e;r>n;n++)this[n]=f[n%i]}return this}};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"base64-js":2,"ieee754":9,"isarray":5}],5:[function(require,module,exports){
var toString={}.toString;module.exports=Array.isArray||function(r){return"[object Array]"==toString.call(r)};
},{}],6:[function(require,module,exports){
(function (Buffer){
function isArray(r){return Array.isArray?Array.isArray(r):"[object Array]"===objectToString(r)}function isBoolean(r){return"boolean"==typeof r}function isNull(r){return null===r}function isNullOrUndefined(r){return null==r}function isNumber(r){return"number"==typeof r}function isString(r){return"string"==typeof r}function isSymbol(r){return"symbol"==typeof r}function isUndefined(r){return void 0===r}function isRegExp(r){return"[object RegExp]"===objectToString(r)}function isObject(r){return"object"==typeof r&&null!==r}function isDate(r){return"[object Date]"===objectToString(r)}function isError(r){return"[object Error]"===objectToString(r)||r instanceof Error}function isFunction(r){return"function"==typeof r}function isPrimitive(r){return null===r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||"symbol"==typeof r||"undefined"==typeof r}function objectToString(r){return Object.prototype.toString.call(r)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=Buffer.isBuffer;
}).call(this,{"isBuffer":require("../../is-buffer/index.js")})

},{"../../is-buffer/index.js":11}],7:[function(require,module,exports){
(function (process,global){
(function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function n(t){return"object"==typeof t&&null!==t}function r(){}function o(){return function(){process.nextTick(c)}}function i(){var t=0,e=new F(c),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function s(){var t=new MessageChannel;return t.port1.onmessage=c,function(){t.port2.postMessage(0)}}function u(){return function(){setTimeout(c,1)}}function c(){for(var t=0;D>t;t+=2){var e=N[t],n=N[t+1];e(n),N[t]=void 0,N[t+1]=void 0}D=0}function a(){}function f(){return new TypeError("You cannot resolve a promise with itself")}function l(){return new TypeError("A promises callback cannot return that same promise.")}function h(t){try{return t.then}catch(e){return z.error=e,z}}function p(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function _(t,e,n){Y(function(t){var r=!1,o=p(n,e,function(n){r||(r=!0,e!==n?m(t,n):w(t,n))},function(e){r||(r=!0,b(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,b(t,o))},t)}function d(t,e){e._state===W?w(t,e._result):t._state===q?b(t,e._result):g(e,void 0,function(e){m(t,e)},function(e){b(t,e)})}function v(t,n){if(n.constructor===t.constructor)d(t,n);else{var r=h(n);r===z?b(t,z.error):void 0===r?w(t,n):e(r)?_(t,n,r):w(t,n)}}function m(e,n){e===n?b(e,f()):t(n)?v(e,n):w(e,n)}function y(t){t._onerror&&t._onerror(t._result),A(t)}function w(t,e){t._state===U&&(t._result=e,t._state=W,0===t._subscribers.length||Y(A,t))}function b(t,e){t._state===U&&(t._state=q,t._result=e,Y(y,t))}function g(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+W]=n,o[i+q]=r,0===i&&t._state&&Y(A,t)}function A(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,o,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?P(n,r,o,i):o(i);t._subscribers.length=0}}function j(){this.error=null}function E(t,e){try{return t(e)}catch(n){return B.error=n,B}}function P(t,n,r,o){var i,s,u,c,a=e(r);if(a){if(i=E(r,o),i===B?(c=!0,s=i.error,i=null):u=!0,n===i)return void b(n,l())}else i=o,u=!0;n._state!==U||(a&&u?m(n,i):c?b(n,s):t===W?w(n,i):t===q&&b(n,i))}function T(t,e){try{e(function(e){m(t,e)},function(e){b(t,e)})}catch(n){b(t,n)}}function S(t,e,n,r){this._instanceConstructor=t,this.promise=new t(a,r),this._abortOnReject=n,this._validateInput(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._init(),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&w(this.promise,this._result))):b(this.promise,this._validationError())}function k(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function M(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function O(t){this._id=V++,this._state=void 0,this._result=void 0,this._subscribers=[],a!==t&&(e(t)||k(),this instanceof O||M(),T(this,t))}var C;C=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var R,x=C,D=(Date.now||function(){return(new Date).getTime()},Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return r.prototype=t,new r},0),Y=function(t,e){N[D]=t,N[D+1]=e,D+=2,2===D&&R()},I="undefined"!=typeof window?window:{},F=I.MutationObserver||I.WebKitMutationObserver,K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,N=new Array(1e3);R="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?o():F?i():K?s():u();var U=void 0,W=1,q=2,z=new j,B=new j;S.prototype._validateInput=function(t){return x(t)},S.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},S.prototype._init=function(){this._result=new Array(this.length)};var G=S;S.prototype._enumerate=function(){for(var t=this.length,e=this.promise,n=this._input,r=0;e._state===U&&t>r;r++)this._eachEntry(n[r],r)},S.prototype._eachEntry=function(t,e){var r=this._instanceConstructor;n(t)?t.constructor===r&&t._state!==U?(t._onerror=null,this._settledAt(t._state,e,t._result)):this._willSettleAt(r.resolve(t),e):(this._remaining--,this._result[e]=this._makeResult(W,e,t))},S.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===U&&(this._remaining--,this._abortOnReject&&t===q?b(r,n):this._result[e]=this._makeResult(t,e,n)),0===this._remaining&&w(r,this._result)},S.prototype._makeResult=function(t,e,n){return n},S.prototype._willSettleAt=function(t,e){var n=this;g(t,void 0,function(t){n._settledAt(W,e,t)},function(t){n._settledAt(q,e,t)})};var H=function(t,e){return new G(this,t,!0,e).promise},J=function(t,e){function n(t){m(i,t)}function r(t){b(i,t)}var o=this,i=new o(a,e);if(!x(t))return b(i,new TypeError("You must pass an array to race.")),i;for(var s=t.length,u=0;i._state===U&&s>u;u++)g(o.resolve(t[u]),void 0,n,r);return i},L=function(t,e){var n=this;if(t&&"object"==typeof t&&t.constructor===n)return t;var r=new n(a,e);return m(r,t),r},Q=function(t,e){var n=this,r=new n(a,e);return b(r,t),r},V=0,X=O;O.all=H,O.race=J,O.resolve=L,O.reject=Q,O.prototype={constructor:O,then:function(t,e){var n=this,r=n._state;if(r===W&&!t||r===q&&!e)return this;var o=new this.constructor(a),i=n._result;if(r){var s=arguments[r-1];Y(function(){P(r,o,s,i)})}else g(n,o,t,e);return o},"catch":function(t){return this.then(null,t)}};var Z=function(){var t;t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var n="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var n;return new t.Promise(function(t){n=t}),e(n)}();n||(t.Promise=X)},$={Promise:X,polyfill:Z};"function"==typeof define&&define.amd?define(function(){return $}):"undefined"!=typeof module&&module.exports?module.exports=$:"undefined"!=typeof this&&(this.ES6Promise=$)}).call(this);
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"_process":24}],8:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,i,n,s,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[e],isUndefined(i))return!1;if(isFunction(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),i.apply(this,s)}else if(isObject(i))for(s=Array.prototype.slice.call(arguments,1),o=i.slice(),n=o.length,r=0;n>r;r++)o[r].apply(this,s);return!0},EventEmitter.prototype.addListener=function(e,t){var i;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(i=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},EventEmitter.prototype.removeListener=function(e,t){var i,n,s,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,n=-1,i===t||isFunction(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(i)){for(r=s;r-- >0;)if(i[r]===t||i[r].listener&&i[r].listener===t){n=r;break}if(0>n)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],isFunction(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0},EventEmitter.listenerCount=function(e,t){return e.listenerCount(t)};
},{}],9:[function(require,module,exports){
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:(s?-1:1)*(1/0);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=0>o||0===o&&0>1/o?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),o+=p+N>=1?n/f:n*Math.pow(2,1-N),o*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};
},{}],10:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
},{}],11:[function(require,module,exports){
module.exports=function(r){return!(null==r||!(r._isBuffer||r.constructor&&"function"==typeof r.constructor.isBuffer&&r.constructor.isBuffer(r)))};
},{}],12:[function(require,module,exports){
module.exports=Array.isArray||function(r){return"[object Array]"==Object.prototype.toString.call(r)};
},{}],13:[function(require,module,exports){
arguments[4][3][0].apply(exports,arguments)
},{"dup":3}],14:[function(require,module,exports){
(function (process,global,__dirname){
!function(){var e="undefined"!=typeof process&&process.versions&&process.versions.node,t=!e&&("undefined"!=typeof window||"undefined"!=typeof self);t&&"undefined"==typeof global&&("undefined"!=typeof window?global=window:"undefined"!=typeof self?global=self:"undefined"!=typeof $&&(global=$));var n=function(n){function r(){}function a(e){for(var t=[],n=Object.keys(e).sort(),r=0;r<n.length;++r){var a=n[r],o=e[a];A(o)||(o=[o]);for(var i=0;i<o.length;++i){var l=o[i];if(null!==l){if(!J(l))throw new Se("Invalid JSON-LD syntax; language map values must be strings.","jsonld.SyntaxError",{code:"invalid language map value",languageMap:e});t.push({"@value":l,"@language":a.toLowerCase()})}}}return t}function o(e,t){if(A(t))for(var n=0;n<t.length;++n)t[n]=o(e,t[n]);else if(Q(t))t["@list"]=o(e,t["@list"]);else if(T(t)){G(t)&&(t["@id"]=e.getId(t["@id"]));for(var r=Object.keys(t).sort(),a=0;a<r.length;++a){var i=r[a];"@id"!==i&&(t[i]=o(e,t[i]))}}return t}function i(e,t,r){if(null===r||void 0===r)return null;var a=D(e,t,{vocab:!0});if("@id"===a)return D(e,r,{base:!0});if("@type"===a)return D(e,r,{vocab:!0,base:!0});var o=n.getContextValue(e,t,"@type");if("@id"===o||"@graph"===a&&J(r))return{"@id":D(e,r,{base:!0})};if("@vocab"===o)return{"@id":D(e,r,{vocab:!0,base:!0})};if(_(a))return r;var i={};if(null!==o)i["@type"]=o;else if(J(r)){var l=n.getContextValue(e,t,"@language");null!==l&&(i["@language"]=l)}return-1===["boolean","number","string"].indexOf(typeof r)&&(r=r.toString()),i["@value"]=r,i}function l(e,t,n){for(var r=[],a=Object.keys(e).sort(),o=0;o<a.length;++o)for(var i=a[o],l=e[i],c=Object.keys(l).sort(),d=0;d<c.length;++d){var f=c[d],p=l[f];if("@type"===f)f=we;else if(_(f))continue;for(var h=0;h<p.length;++h){var v=p[h],g={};if(g.type=0===i.indexOf("_:")?"blank node":"IRI",g.value=i,$(i)){var y={};if(y.type=0===f.indexOf("_:")?"blank node":"IRI",y.value=f,$(f)&&("blank node"!==y.type||n.produceGeneralizedRdf))if(Q(v))u(v["@list"],t,g,y,r);else{var m=s(v);m&&r.push({subject:g,predicate:y,object:m})}}}}return r}function u(e,t,n,r,a){for(var o={type:"IRI",value:me},i={type:"IRI",value:xe},l={type:"IRI",value:be},u=0;u<e.length;++u){var c=e[u],d={type:"blank node",value:t.getId()};a.push({subject:n,predicate:r,object:d}),n=d,r=o;var f=s(c);f&&a.push({subject:n,predicate:r,object:f}),r=i}a.push({subject:n,predicate:r,object:l})}function s(e){var t={};if(X(e)){t.type="literal";var n=e["@value"],r=e["@type"]||null;V(n)?(t.value=n.toString(),t.datatype=r||fe):F(n)||r===pe?(F(n)||(n=parseFloat(n)),t.value=n.toExponential(15).replace(/(\d)0*e\+?/,"$1E"),t.datatype=r||pe):P(n)?(t.value=n.toFixed(0),t.datatype=r||he):"@language"in e?(t.value=n,t.datatype=r||Le,t.language=e["@language"]):(t.value=n,t.datatype=r||ve)}else{var a=T(e)?e["@id"]:e;t.type=0===a.indexOf("_:")?"blank node":"IRI",t.value=a}return"IRI"!==t.type||$(t.value)?t:null}function c(e,t){if("IRI"===e.type||"blank node"===e.type)return{"@id":e.value};var n={"@value":e.value};if(e.language)n["@language"]=e.language;else{var r=e.datatype;if(r||(r=ve),t){if(r===fe)"true"===n["@value"]?n["@value"]=!0:"false"===n["@value"]&&(n["@value"]=!1);else if(B(n["@value"]))if(r===he){var a=parseInt(n["@value"],10);a.toFixed(0)===n["@value"]&&(n["@value"]=a)}else r===pe&&(n["@value"]=parseFloat(n["@value"]));-1===[fe,he,pe,ve].indexOf(r)&&(n["@type"]=r)}else r!==ve&&(n["@type"]=r)}return n}function d(e,t){for(var n=["subject","predicate","object"],r=0;r<n.length;++r){var a=n[r];if(e[a].type!==t[a].type||e[a].value!==t[a].value)return!1}return e.object.language!==t.object.language?!1:e.object.datatype===t.object.datatype}function f(e,t,r,a,o,i){if(A(e))for(var l=0;l<e.length;++l)f(e[l],t,r,a,void 0,i);else{if(!T(e))return void(i&&i.push(e));if(X(e)){if("@type"in e){var u=e["@type"];0===u.indexOf("_:")&&(e["@type"]=u=a.getId(u))}return void(i&&i.push(e))}if("@type"in e)for(var s=e["@type"],l=0;l<s.length;++l){var u=s[l];0===u.indexOf("_:")&&a.getId(u)}M(o)&&(o=G(e)?a.getId(e["@id"]):e["@id"]),i&&i.push({"@id":o});var c=t[r],d=c[o]=c[o]||{};d["@id"]=o;for(var p=Object.keys(e).sort(),h=0;h<p.length;++h){var v=p[h];if("@id"!==v)if("@reverse"!==v)if("@graph"!==v)if("@type"!==v&&_(v)){if("@index"===v&&v in d&&(e[v]!==d[v]||e[v]["@id"]!==d[v]["@id"]))throw new Se("Invalid JSON-LD syntax; conflicting @index property detected.","jsonld.SyntaxError",{code:"conflicting indexes",subject:d});d[v]=e[v]}else{var g=e[v];if(0===v.indexOf("_:")&&(v=a.getId(v)),0!==g.length)for(var y=0;y<g.length;++y){var m=g[y];if("@type"===v&&(m=0===m.indexOf("_:")?a.getId(m):m),z(m)||H(m)){var x=G(m)?a.getId(m["@id"]):m["@id"];n.addValue(d,v,{"@id":x},{propertyIsArray:!0,allowDuplicate:!1}),f(m,t,r,a,x)}else if(Q(m)){var b=[];f(m["@list"],t,r,a,o,b),m={"@list":b},n.addValue(d,v,m,{propertyIsArray:!0,allowDuplicate:!1})}else f(m,t,r,a,o),n.addValue(d,v,m,{propertyIsArray:!0,allowDuplicate:!1})}else n.addValue(d,v,[],{propertyIsArray:!0})}else{o in t||(t[o]={});var w="@merged"===r?r:o;f(e[v],t,w,a)}else{var j={"@id":o},k=e["@reverse"];for(var I in k)for(var L=k[I],O=0;O<L.length;++O){var E=L[O],S=E["@id"];G(E)&&(S=a.getId(S)),f(E,t,r,a,S),n.addValue(c[S],I,j,{propertyIsArray:!0,allowDuplicate:!1})}}}}}function p(e){for(var t=e["@default"],n=Object.keys(e).sort(),r=0;r<n.length;++r){var a=n[r];if("@default"!==a){var o=e[a],i=t[a];i?"@graph"in i||(i["@graph"]=[]):t[a]=i={"@id":a,"@graph":[]};for(var l=i["@graph"],u=Object.keys(o).sort(),s=0;s<u.length;++s){var c=o[u[s]];H(c)||l.push(c)}}}return t}function h(e,t,n,r,a){m(n),n=n[0];for(var o=e.options,i={embed:y(n,o,"embed"),explicit:y(n,o,"explicit"),requireAll:y(n,o,"requireAll")},l=x(e,t,n,i),u=Object.keys(l).sort(),s=0;s<u.length;++s){var c=u[s],d=l[c];if("@link"===i.embed&&c in e.link)j(r,a,e.link[c]);else{null===a&&(e.uniqueEmbeds={});var f={};if(f["@id"]=c,e.link[c]=f,"@never"===i.embed||g(d,e.subjectStack))j(r,a,f);else{"@last"===i.embed&&(c in e.uniqueEmbeds&&w(e,c),e.uniqueEmbeds[c]={parent:r,property:a}),e.subjectStack.push(d);for(var p=Object.keys(d).sort(),b=0;b<p.length;b++){var k=p[b];if(_(k))f[k]=W(d[k]);else if(!i.explicit||k in n)for(var I=d[k],L=0;L<I.length;++L){var O=I[L];if(Q(O)){var E={"@list":[]};j(f,k,E);var S=O["@list"];for(var D in S)if(O=S[D],H(O)){var N=k in n?n[k][0]["@list"]:v(i);h(e,[O["@id"]],N,E,"@list")}else j(E,"@list",W(O))}else if(H(O)){var N=k in n?n[k]:v(i);h(e,[O["@id"]],N,f,k)}else j(f,k,W(O))}}for(var p=Object.keys(n).sort(),b=0;b<p.length;++b){var k=p[b];if(!_(k)){var C=n[k][0],R=y(C,o,"omitDefault");if(!(R||k in f)){var T="@null";"@default"in C&&(T=W(C["@default"])),A(T)||(T=[T]),f[k]=[{"@preserve":T}]}}}j(r,a,f),e.subjectStack.pop()}}}}function v(e){var t={};for(var n in e)void 0!==e[n]&&(t["@"+n]=[e[n]]);return[t]}function g(e,t){for(var n=t.length-1;n>=0;--n)if(t[n]["@id"]===e["@id"])return!0;return!1}function y(e,t,n){var r="@"+n,a=r in e?e[r][0]:t[n];return"embed"===n&&(a===!0?a="@last":a===!1?a="@never":"@always"!==a&&"@never"!==a&&"@link"!==a&&(a="@last")),a}function m(e){if(!A(e)||1!==e.length||!T(e[0]))throw new Se("Invalid JSON-LD syntax; a JSON-LD frame must be a single object.","jsonld.SyntaxError",{frame:e})}function x(e,t,n,r){for(var a={},o=0;o<t.length;++o){var i=t[o],l=e.subjects[i];b(l,n,r)&&(a[i]=l)}return a}function b(e,t,r){if("@type"in t&&(1!==t["@type"].length||!T(t["@type"][0]))){for(var a=t["@type"],o=0;o<a.length;++o)if(n.hasValue(e,"@type",a[o]))return!0;return!1}var i=!0,l=!1;for(var u in t){if(_(u)){if("@id"!==u&&"@type"!==u)continue;if(i=!1,"@id"===u&&J(t[u])){if(e[u]!==t[u])return!1;l=!0;continue}}if(i=!1,u in e){if(A(t[u])&&0===t[u].length&&void 0!==e[u])return!1;l=!0}else{var s=A(t[u])&&T(t[u][0])&&"@default"in t[u][0];if(r.requireAll&&!s)return!1}}return i||l}function w(e,t){var r=e.uniqueEmbeds,a=r[t],o=a.parent,i=a.property,l={"@id":t};if(A(o)){for(var u=0;u<o.length;++u)if(n.compareValues(o[u],l)){o[u]=l;break}}else{var s=A(o[i]);n.removeValue(o,i,l,{propertyIsArray:s}),n.addValue(o,i,l,{propertyIsArray:s})}var c=function(e){for(var t=Object.keys(r),n=0;n<t.length;++n){var a=t[n];a in r&&T(r[a].parent)&&r[a].parent["@id"]===e&&(delete r[a],c(a))}};c(t)}function j(e,t,r){T(e)?n.addValue(e,t,r,{propertyIsArray:!0}):e.push(r)}function k(e,t,r){if(A(t)){for(var a=[],o=0;o<t.length;++o){var i=k(e,t[o],r);null!==i&&a.push(i)}t=a}else if(T(t)){if("@preserve"in t)return"@null"===t["@preserve"]?null:t["@preserve"];if(X(t))return t;if(Q(t))return t["@list"]=k(e,t["@list"],r),t;var l=O(e,"@id");if(l in t){var u=t[l];if(u in r.link){var s=r.link[u].indexOf(t);if(-1!==s)return r.link[u][s];r.link[u].push(t)}else r.link[u]=[t]}for(var c in t){var i=k(e,t[c],r),d=n.getContextValue(e,c,"@container");r.compactArrays&&A(i)&&1===i.length&&null===d&&(i=i[0]),t[c]=i}}return t}function I(e,t){return e.length<t.length?-1:t.length<e.length?1:e===t?0:t>e?-1:1}function L(e,t,n,r,a,o){null===o&&(o="@null");var i=[];if("@id"!==o&&"@reverse"!==o||!H(n))i.push(o);else{"@reverse"===o&&i.push("@reverse");var l=O(e,n["@id"],null,{vocab:!0});l in e.mappings&&e.mappings[l]&&e.mappings[l]["@id"]===n["@id"]?i.push.apply(i,["@vocab","@id"]):i.push.apply(i,["@id","@vocab"])}i.push("@none");for(var u=e.inverse[t],s=0;s<r.length;++s){var c=r[s];if(c in u)for(var d=u[c][a],f=0;f<i.length;++f){var p=i[f];if(p in d)return d[p]}}return null}function O(e,t,n,r,a){if(null===t)return t;if(M(n)&&(n=null),M(a)&&(a=!1),r=r||{},_(t)&&(r.vocab=!0),r.vocab&&t in e.getInverse()){var o=e["@language"]||"@none",i=[];T(n)&&"@index"in n&&i.push("@index");var l="@language",u="@null";if(a)l="@type",u="@reverse",i.push("@set");else if(Q(n)){"@index"in n||i.push("@list");for(var s=n["@list"],c=0===s.length?o:null,d=null,f=0;f<s.length;++f){var p=s[f],h="@none",v="@none";if(X(p)?"@language"in p?h=p["@language"]:"@type"in p?v=p["@type"]:h="@null":v="@id",null===c?c=h:h!==c&&X(p)&&(c="@none"),null===d?d=v:v!==d&&(d="@none"),"@none"===c&&"@none"===d)break}c=c||"@none",d=d||"@none","@none"!==d?(l="@type",u=d):u=c}else X(n)?"@language"in n&&!("@index"in n)?(i.push("@language"),u=n["@language"]):"@type"in n&&(l="@type",u=n["@type"]):(l="@type",u="@id"),i.push("@set");i.push("@none");var g=L(e,t,n,i,l,u);if(null!==g)return g}if(r.vocab&&"@vocab"in e){var y=e["@vocab"];if(0===t.indexOf(y)&&t!==y){var m=t.substr(y.length);if(!(m in e.mappings))return m}}var x=null;for(var g in e.mappings)if(-1===g.indexOf(":")){var b=e.mappings[g];if(b&&b["@id"]!==t&&0===t.indexOf(b["@id"])){var w=g+":"+t.substr(b["@id"].length),j=!(w in e.mappings)||null===n&&e.mappings[w]&&e.mappings[w]["@id"]===t;j&&(null===x||I(w,x)<0)&&(x=w)}}return null!==x?x:r.vocab?t:C(e["@base"],t)}function E(e,t,r){if(X(r)){var a=n.getContextValue(e,t,"@type"),o=n.getContextValue(e,t,"@language"),i=n.getContextValue(e,t,"@container"),l="@index"in r&&"@index"!==i;if(!l&&(r["@type"]===a||r["@language"]===o))return r["@value"];var u=Object.keys(r).length,s=1===u||2===u&&"@index"in r&&!l,c="@language"in e,d=J(r["@value"]),f=e.mappings[t]&&null===e.mappings[t]["@language"];if(s&&(!c||!d||f))return r["@value"];var p={};return l&&(p[O(e,"@index")]=r["@index"]),"@type"in r?p[O(e,"@type")]=O(e,r["@type"],null,{vocab:!0}):"@language"in r&&(p[O(e,"@language")]=r["@language"]),p[O(e,"@value")]=r["@value"],p}var h=D(e,t,{vocab:!0}),a=n.getContextValue(e,t,"@type"),v=O(e,r["@id"],null,{vocab:"@vocab"===a});if("@id"===a||"@vocab"===a||"@graph"===h)return v;var p={};return p[O(e,"@id")]=v,p}function S(e,t,n,r){if(n in r){if(r[n])return;throw new Se("Cyclical context definition detected.","jsonld.CyclicalContext",{code:"cyclic IRI mapping",context:t,term:n})}if(r[n]=!1,_(n))throw new Se("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{code:"keyword redefinition",context:t,term:n});if(""===n)throw new Se("Invalid JSON-LD syntax; a term cannot be an empty string.","jsonld.SyntaxError",{code:"invalid term definition",context:t});e.mappings[n]&&delete e.mappings[n];var a=t[n];if(null===a||T(a)&&null===a["@id"])return e.mappings[n]=null,void(r[n]=!0);if(J(a)&&(a={"@id":a}),!T(a))throw new Se("Invalid JSON-LD syntax; @context property values must be strings or objects.","jsonld.SyntaxError",{code:"invalid term definition",context:t});var o=e.mappings[n]={};if(o.reverse=!1,"@reverse"in a){if("@id"in a)throw new Se("Invalid JSON-LD syntax; a @reverse term definition must not contain @id.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});var i=a["@reverse"];if(!J(i))throw new Se("Invalid JSON-LD syntax; a @context @reverse value must be a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});var l=D(e,i,{vocab:!0,base:!1},t,r);if(!$(l))throw new Se("Invalid JSON-LD syntax; a @context @reverse value must be an absolute IRI or a blank node identifier.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});o["@id"]=l,o.reverse=!0}else if("@id"in a){var l=a["@id"];if(!J(l))throw new Se("Invalid JSON-LD syntax; a @context @id value must be an array of strings or a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});if(l!==n){if(l=D(e,l,{vocab:!0,base:!1},t,r),!$(l)&&!_(l))throw new Se("Invalid JSON-LD syntax; a @context @id value must be an absolute IRI, a blank node identifier, or a keyword.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});o["@id"]=l}}if(!("@id"in o)){var u=n.indexOf(":");if(-1!==u){var s=n.substr(0,u);if(s in t&&S(e,t,s,r),e.mappings[s]){var c=n.substr(u+1);o["@id"]=e.mappings[s]["@id"]+c}else o["@id"]=n}else{if(!("@vocab"in e))throw new Se("Invalid JSON-LD syntax; @context terms must define an @id.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t,term:n});o["@id"]=e["@vocab"]+n}}if(r[n]=!0,"@type"in a){var d=a["@type"];if(!J(d))throw new Se("Invalid JSON-LD syntax; an @context @type values must be a string.","jsonld.SyntaxError",{code:"invalid type mapping",context:t});if("@id"!==d&&"@vocab"!==d){if(d=D(e,d,{vocab:!0,base:!1},t,r),!$(d))throw new Se("Invalid JSON-LD syntax; an @context @type value must be an absolute IRI.","jsonld.SyntaxError",{code:"invalid type mapping",context:t});if(0===d.indexOf("_:"))throw new Se("Invalid JSON-LD syntax; an @context @type values must be an IRI, not a blank node identifier.","jsonld.SyntaxError",{code:"invalid type mapping",context:t})}o["@type"]=d}if("@container"in a){var f=a["@container"];if("@list"!==f&&"@set"!==f&&"@index"!==f&&"@language"!==f)throw new Se("Invalid JSON-LD syntax; @context @container value must be one of the following: @list, @set, @index, or @language.","jsonld.SyntaxError",{code:"invalid container mapping",context:t});if(o.reverse&&"@index"!==f&&"@set"!==f&&null!==f)throw new Se("Invalid JSON-LD syntax; @context @container value for a @reverse type definition must be @index or @set.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});o["@container"]=f}if("@language"in a&&!("@type"in a)){var p=a["@language"];if(null!==p&&!J(p))throw new Se("Invalid JSON-LD syntax; @context @language value must be a string or null.","jsonld.SyntaxError",{code:"invalid language mapping",context:t});null!==p&&(p=p.toLowerCase()),o["@language"]=p}var l=o["@id"];if("@context"===l||"@preserve"===l)throw new Se("Invalid JSON-LD syntax; @context and @preserve cannot be aliased.","jsonld.SyntaxError",{code:"invalid keyword alias",context:t})}function D(e,t,r,a,o){if(null===t||_(t))return t;if(t=String(t),a&&t in a&&o[t]!==!0&&S(e,a,t,o),r=r||{},r.vocab){var i=e.mappings[t];if(null===i)return null;if(i)return i["@id"]}var l=t.indexOf(":");if(-1!==l){var u=t.substr(0,l),s=t.substr(l+1);if("_"===u||0===s.indexOf("//"))return t;a&&u in a&&S(e,a,u,o);var i=e.mappings[u];return i?i["@id"]+s:t}if(r.vocab&&"@vocab"in e)return e["@vocab"]+t;var c=t;return r.base&&(c=n.prependBase(e["@base"],c)),c}function N(e,t){if(null===e)return t;if(-1!==t.indexOf(":"))return t;J(e)&&(e=n.url.parse(e||""));var r=n.url.parse(t),a={protocol:e.protocol||""};if(null!==r.authority)a.authority=r.authority,a.path=r.path,a.query=r.query;else if(a.authority=e.authority,""===r.path)a.path=e.path,null!==r.query?a.query=r.query:a.query=e.query;else{if(0===r.path.indexOf("/"))a.path=r.path;else{var o=e.path;""!==r.path&&(o=o.substr(0,o.lastIndexOf("/")+1),o.length>0&&"/"!==o.substr(-1)&&(o+="/"),o+=r.path),a.path=o}a.query=r.query}a.path=ae(a.path,!!a.authority);var i=a.protocol;return null!==a.authority&&(i+="//"+a.authority),i+=a.path,null!==a.query&&(i+="?"+a.query),null!==r.fragment&&(i+="#"+r.fragment),""===i&&(i="./"),i}function C(e,t){if(null===e)return t;J(e)&&(e=n.url.parse(e||""));var r="";if(""!==e.href?r+=(e.protocol||"")+"//"+(e.authority||""):t.indexOf("//")&&(r+="//"),0!==t.indexOf(r))return t;for(var a=n.url.parse(t.substr(r.length)),o=e.normalizedPath.split("/"),i=a.normalizedPath.split("/"),l=a.fragment||a.query?0:1;o.length>0&&i.length>l&&o[0]===i[0];)o.shift(),i.shift();var u="";if(o.length>0){o.pop();for(var s=0;s<o.length;++s)u+="../"}return u+=i.join("/"),null!==a.query&&(u+="?"+a.query),null!==a.fragment&&(u+="#"+a.fragment),""===u&&(u="./"),u}function R(e){function t(){var e=this;if(e.inverse)return e.inverse;for(var t=e.inverse={},n=e["@language"]||"@none",a=e.mappings,o=Object.keys(a).sort(I),i=0;i<o.length;++i){var l=o[i],u=a[l];if(null!==u){var s=u["@container"]||"@none",c=u["@id"];A(c)||(c=[c]);for(var d=0;d<c.length;++d){var f=c[d],p=t[f];if(p||(t[f]=p={}),p[s]||(p[s]={"@language":{},"@type":{}}),p=p[s],u.reverse)r(u,l,p["@type"],"@reverse");else if("@type"in u)r(u,l,p["@type"],u["@type"]);else if("@language"in u){var h=u["@language"]||"@null";r(u,l,p["@language"],h)}else r(u,l,p["@language"],n),r(u,l,p["@type"],"@none"),r(u,l,p["@language"],"@none")}}}return t}function r(e,t,n,r){r in n||(n[r]=t)}function a(){var e={};return e["@base"]=this["@base"],e.mappings=W(this.mappings),e.clone=this.clone,e.inverse=null,e.getInverse=this.getInverse,"@language"in this&&(e["@language"]=this["@language"]),"@vocab"in this&&(e["@vocab"]=this["@vocab"]),e}var o=n.url.parse(e.base||"");return{"@base":o,mappings:{},inverse:null,getInverse:t,clone:a}}function _(e){if(!J(e))return!1;switch(e){case"@base":case"@context":case"@container":case"@default":case"@embed":case"@explicit":case"@graph":case"@id":case"@index":case"@language":case"@list":case"@omitDefault":case"@preserve":case"@requireAll":case"@reverse":case"@set":case"@type":case"@value":case"@vocab":return!0}return!1}function T(e){return"[object Object]"===Object.prototype.toString.call(e)}function U(e){return T(e)&&0===Object.keys(e).length}function A(e){return Array.isArray(e)}function q(e){if(!J(e)&&!U(e)){var t=!1;if(A(e)){t=!0;for(var n=0;n<e.length;++n)if(!J(e[n])){t=!1;break}}if(!t)throw new Se('Invalid JSON-LD syntax; "@type" value must a string, an array of strings, or an empty object.',"jsonld.SyntaxError",{code:"invalid type value",value:e})}}function J(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)}function P(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function F(e){return P(e)&&-1!==String(e).indexOf(".")}function B(e){return!isNaN(parseFloat(e))&&isFinite(e)}function V(e){return"boolean"==typeof e||"[object Boolean]"===Object.prototype.toString.call(e)}function M(e){return"undefined"==typeof e}function z(e){var t=!1;if(T(e)&&!("@value"in e||"@set"in e||"@list"in e)){var n=Object.keys(e).length;t=n>1||!("@id"in e)}return t}function H(e){return T(e)&&1===Object.keys(e).length&&"@id"in e}function X(e){return T(e)&&"@value"in e}function Q(e){return T(e)&&"@list"in e}function G(e){var t=!1;return T(e)&&(t="@id"in e?0===e["@id"].indexOf("_:"):0===Object.keys(e).length||!("@value"in e||"@set"in e||"@list"in e)),t}function $(e){return J(e)&&-1!==e.indexOf(":")}function W(e){if(e&&"object"==typeof e){var t;if(A(e)){t=[];for(var n=0;n<e.length;++n)t[n]=W(e[n])}else if(T(e)){t={};for(var r in e)t[r]=W(e[r])}else t=e.toString();return t}return e}function Y(e,t,r,a){var o=Object.keys(t).length;if(A(e)){for(var i=0;i<e.length;++i)Y(e[i],t,r,a);return o<Object.keys(t).length}if(T(e)){for(var l in e)if("@context"===l){var u=e[l];if(A(u))for(var s=u.length,i=0;s>i;++i){var c=u[i];J(c)&&(c=n.prependBase(a,c),r?(c=t[c],A(c)?(Array.prototype.splice.apply(u,[i,1].concat(c)),i+=c.length-1,s=u.length):u[i]=c):c in t||(t[c]=!1))}else J(u)&&(u=n.prependBase(a,u),r?e[l]=t[u]:u in t||(t[u]=!1))}else Y(e[l],t,r,a);return o<Object.keys(t).length}return!1}function Z(e,t,n){var r=null,a=t.documentLoader,o=function(e,t,n,a,i){if(Object.keys(t).length>Ee)return r=new Se("Maximum number of @context URLs exceeded.","jsonld.ContextUrlError",{code:"loading remote context failed",max:Ee}),i(r);var l={},u=function(){Y(e,l,!0,a),i(null,e)};Y(e,l,!1,a)||u();var s=[];for(var c in l)l[c]===!1&&s.push(c);for(var d=s.length,f=0;f<s.length;++f)!function(e){if(e in t)return r=new Se("Cyclical @context URLs detected.","jsonld.ContextUrlError",{code:"recursive context inclusion",url:e}),i(r);var a=W(t);a[e]=!0;var s=function(t,s){if(!r){var c=s?s.document:null;if(!t&&J(c))try{c=JSON.parse(c)}catch(f){t=f}if(t?t=new Se("Dereferencing a URL did not result in a valid JSON-LD object. Possible causes are an inaccessible URL perhaps due to a same-origin policy (ensure the server uses CORS if you are using client-side JavaScript), too many redirects, a non-JSON response, or more than one HTTP Link Header was provided for a remote context.","jsonld.InvalidUrl",{code:"loading remote context failed",url:e,cause:t}):T(c)||(t=new Se("Dereferencing a URL did not result in a JSON object. The response was valid JSON, but it was not a JSON object.","jsonld.InvalidUrl",{code:"invalid remote context",url:e,cause:t})),t)return r=t,i(r);c="@context"in c?{"@context":c["@context"]}:{"@context":{}},s.contextUrl&&(A(c["@context"])||(c["@context"]=[c["@context"]]),c["@context"].push(s.contextUrl)),o(c,a,n,e,function(t,n){return t?i(t):(l[e]=n["@context"],d-=1,void(0===d&&u()))})}},c=n(e,s);c&&"then"in c&&c.then(s.bind(null,null),s)}(s[f])};o(e,{},a,t.base,n)}function K(e){for(var t="(?:<([^:]+:[^>]*)>)",n="(_:(?:[A-Za-z0-9]+))",r='"([^"\\\\]*(?:\\\\.[^"\\\\]*)*)"',a="(?:\\^\\^"+t+")",o="(?:@([a-z]+(?:-[a-z0-9]+)*))",i="(?:"+r+"(?:"+a+"|"+o+")?)",l="(?:#.*)?",u="[ \\t]+",s="[ \\t]*",c=/(?:\r\n)|(?:\n)|(?:\r)/g,f=new RegExp("^"+s+l+"$"),p="(?:"+t+"|"+n+")"+u,h=t+u,v="(?:"+t+"|"+n+"|"+i+")"+s,g="(?:\\.|(?:(?:"+t+"|"+n+")"+s+"\\.))",y=new RegExp("^"+s+p+h+v+g+s+l+"$"),m={},x=e.split(c),b=0,w=0;w<x.length;++w){var j=x[w];if(b++,!f.test(j)){var k=j.match(y);if(null===k)throw new Se("Error while parsing N-Quads; invalid quad.","jsonld.ParseError",{line:b});var I={};if(M(k[1])?I.subject={type:"blank node",value:k[2]}:I.subject={type:"IRI",value:k[1]},I.predicate={type:"IRI",value:k[3]},M(k[4]))if(M(k[5])){I.object={type:"literal"},M(k[7])?M(k[8])?I.object.datatype=ve:(I.object.datatype=Le,I.object.language=k[8]):I.object.datatype=k[7];var L=k[6].replace(/\\"/g,'"').replace(/\\t/g,"	").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\/g,"\\");I.object.value=L}else I.object={type:"blank node",value:k[5]};else I.object={type:"IRI",value:k[4]};var O="@default";if(M(k[9])?M(k[10])||(O=k[10]):O=k[9],O in m){for(var E=!0,S=m[O],D=0;E&&D<S.length;++D)d(S[D],I)&&(E=!1);E&&S.push(I)}else m[O]=[I]}}return m}function ee(e){var t=[];for(var n in e)for(var r=e[n],a=0;a<r.length;++a){var o=r[a];"@default"===n&&(n=null),t.push(te(o,n))}return t.sort().join("")}function te(e,t){var n=e.subject,r=e.predicate,a=e.object,o=t||null;"name"in e&&e.name&&(o=e.name.value);var i="";if(i+="IRI"===n.type?"<"+n.value+">":n.value,i+=" ",i+="IRI"===r.type?"<"+r.value+">":r.value,i+=" ","IRI"===a.type)i+="<"+a.value+">";else if("blank node"===a.type)i+=a.value;else{var l=a.value.replace(/\\/g,"\\\\").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\"/g,'\\"');i+='"'+l+'"',a.datatype===Le?a.language&&(i+="@"+a.language):a.datatype!==ve&&(i+="^^<"+a.datatype+">")}return null!==o&&void 0!==o&&(i+=0!==o.indexOf("_:")?" <"+o+">":" "+o),i+=" .\n"}function ne(e){var t={};t["@default"]=[];for(var n=e.getSubjects(),r=0;r<n.length;++r){var a=n[r];if(null!==a){var o=e.getSubjectTriples(a);if(null!==o){var i=o.predicates;for(var l in i)for(var u=i[l].objects,s=0;s<u.length;++s){var c=u[s],d={};0===a.indexOf("_:")?d.subject={type:"blank node",value:a}:d.subject={type:"IRI",value:a},0===l.indexOf("_:")?d.predicate={type:"blank node",value:l}:d.predicate={type:"IRI",value:l};var f=c.value;if(c.type===ke){ce||Te();var p=new ce;f="";for(var h=0;h<c.value.length;h++)c.value[h].nodeType===de.ELEMENT_NODE?f+=p.serializeToString(c.value[h]):c.value[h].nodeType===de.TEXT_NODE&&(f+=c.value[h].nodeValue)}d.object={},c.type===Ie?0===c.value.indexOf("_:")?d.object.type="blank node":d.object.type="IRI":(d.object.type="literal",c.type===je?c.language?(d.object.datatype=Le,d.object.language=c.language):d.object.datatype=ve:d.object.datatype=c.type),d.object.value=f,t["@default"].push(d)}}}}return t}function re(e){this.prefix=e,this.counter=0,this.existing={}}function ae(e,t){var n="";0===e.indexOf("/")&&(n="/");for(var r=e.split("/"),a=[];r.length>0;)"."===r[0]||""===r[0]&&r.length>1?r.shift():".."!==r[0]?a.push(r.shift()):(r.shift(),t||a.length>0&&".."!==a[a.length-1]?a.pop():a.push(".."));return n+a.join("/")}n.compact=function(e,t,r,a){function o(e,n,r,o){if(e)return a(e);o.compactArrays&&!o.graph&&A(n)?1===n.length?n=n[0]:0===n.length&&(n={}):o.graph&&T(n)&&(n=[n]),T(t)&&"@context"in t&&(t=t["@context"]),t=W(t),A(t)||(t=[t]);var i=t;t=[];for(var l=0;l<i.length;++l)(!T(i[l])||Object.keys(i[l]).length>0)&&t.push(i[l]);var u=t.length>0;if(1===t.length&&(t=t[0]),A(n)){var s=O(r,"@graph"),c=n;n={},u&&(n["@context"]=t),n[s]=c}else if(T(n)&&u){var c=n;n={"@context":t};for(var d in c)n[d]=c[d]}a(null,n,r)}if(arguments.length<2)return n.nextTick(function(){a(new TypeError("Could not compact, too few arguments."))});if("function"==typeof r&&(a=r,r={}),r=r||{},null===t)return n.nextTick(function(){a(new Se("The compaction context must not be null.","jsonld.CompactError",{code:"invalid local context"}))});if(null===e)return n.nextTick(function(){a(null,null)});"base"in r||(r.base="string"==typeof e?e:""),"compactArrays"in r||(r.compactArrays=!0),"graph"in r||(r.graph=!1),"skipExpansion"in r||(r.skipExpansion=!1),"documentLoader"in r||(r.documentLoader=n.loadDocument),"link"in r||(r.link=!1),r.link&&(r.skipExpansion=!0);var i=function(e,t,r){n.nextTick(function(){return t.skipExpansion?r(null,e):void n.expand(e,t,r)})};i(e,r,function(e,i){if(e)return a(new Se("Could not expand input before compaction.","jsonld.CompactError",{cause:e}));var l=R(r);n.processContext(l,t,r,function(e,t){if(e)return a(new Se("Could not process context before compaction.","jsonld.CompactError",{cause:e}));var n;try{n=(new De).compact(t,null,i,r)}catch(l){return a(l)}o(null,n,t,r)})})},n.expand=function(e,t,r){function a(e){"base"in t||(t.base=e.documentUrl||"");var n={document:W(e.document),remoteContext:{"@context":e.contextUrl}};if("expandContext"in t){var a=W(t.expandContext);"object"==typeof a&&"@context"in a?n.expandContext=a:n.expandContext={"@context":a}}Z(n,t,function(e,n){if(e)return r(e);var a;try{var o=new De,i=R(t),l=n.document,u=n.remoteContext["@context"];n.expandContext&&(i=o.processContext(i,n.expandContext["@context"],t)),u&&(i=o.processContext(i,u,t)),a=o.expand(i,null,l,t,!1),T(a)&&"@graph"in a&&1===Object.keys(a).length?a=a["@graph"]:null===a&&(a=[]),A(a)||(a=[a])}catch(s){return r(s)}r(null,a)})}return arguments.length<1?n.nextTick(function(){r(new TypeError("Could not expand, too few arguments."))}):("function"==typeof t&&(r=t,t={}),t=t||{},"documentLoader"in t||(t.documentLoader=n.loadDocument),"keepFreeFloatingNodes"in t||(t.keepFreeFloatingNodes=!1),void n.nextTick(function(){if("string"==typeof e){var n=function(e,t){if(e)return r(e);try{if(!t.document)throw new Se("No remote document found at the given URL.","jsonld.NullRemoteDocument");"string"==typeof t.document&&(t.document=JSON.parse(t.document))}catch(n){return r(new Se("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:n,remoteDoc:t}))}a(t)},o=t.documentLoader(e,n);return void(o&&"then"in o&&o.then(n.bind(null,null),n))}a({contextUrl:null,documentUrl:null,document:e})}))},n.flatten=function(e,t,r,a){return arguments.length<1?n.nextTick(function(){a(new TypeError("Could not flatten, too few arguments."))}):("function"==typeof r?(a=r,r={}):"function"==typeof t&&(a=t,t=null,r={}),r=r||{},"base"in r||(r.base="string"==typeof e?e:""),"documentLoader"in r||(r.documentLoader=n.loadDocument),void n.expand(e,r,function(e,o){if(e)return a(new Se("Could not expand input before flattening.","jsonld.FlattenError",{cause:e}));var i;try{i=(new De).flatten(o)}catch(l){return a(l)}return null===t?a(null,i):(r.graph=!0,r.skipExpansion=!0,void n.compact(i,t,r,function(e,t){return e?a(new Se("Could not compact flattened output.","jsonld.FlattenError",{cause:e})):void a(null,t)}))}))},n.frame=function(e,t,r,a){function o(t){var o,i=t.document;i?(o=i["@context"],t.contextUrl?(o?A(o)?o.push(t.contextUrl):o=[o,t.contextUrl]:o=t.contextUrl,i["@context"]=o):o=o||{}):o={},n.expand(e,r,function(e,t){if(e)return a(new Se("Could not expand input before framing.","jsonld.FrameError",{cause:e}));var l=W(r);l.isFrame=!0,l.keepFreeFloatingNodes=!0,n.expand(i,l,function(e,r){if(e)return a(new Se("Could not expand frame before framing.","jsonld.FrameError",{cause:e}));var i;try{i=(new De).frame(t,r,l)}catch(u){return a(u)}l.graph=!0,l.skipExpansion=!0,l.link={},n.compact(i,o,l,function(e,t,n){if(e)return a(new Se("Could not compact framed output.","jsonld.FrameError",{cause:e}));var r=O(n,"@graph");l.link={},t[r]=k(n,t[r],l),a(null,t)})})})}return arguments.length<2?n.nextTick(function(){a(new TypeError("Could not frame, too few arguments."))}):("function"==typeof r&&(a=r,r={}),r=r||{},"base"in r||(r.base="string"==typeof e?e:""),"documentLoader"in r||(r.documentLoader=n.loadDocument),"embed"in r||(r.embed="@last"),r.explicit=r.explicit||!1,"requireAll"in r||(r.requireAll=!0),r.omitDefault=r.omitDefault||!1,void n.nextTick(function(){if("string"==typeof t){var e=function(e,t){if(e)return a(e);try{if(!t.document)throw new Se("No remote document found at the given URL.","jsonld.NullRemoteDocument");"string"==typeof t.document&&(t.document=JSON.parse(t.document))}catch(n){return a(new Se("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:n,remoteDoc:t}))}o(t)},n=r.documentLoader(t,e);return void(n&&"then"in n&&n.then(e.bind(null,null),e))}o({contextUrl:null,documentUrl:null,document:t})}))},n.link=function(e,t,r,a){var o={};t&&(o["@context"]=t),o["@embed"]="@link",n.frame(e,o,r,a)},n.objectify=function(e,t,r,a){"function"==typeof r&&(a=r,r={}),r=r||{},"base"in r||(r.base="string"==typeof e?e:""),"documentLoader"in r||(r.documentLoader=n.loadDocument),n.expand(e,r,function(e,o){if(e)return a(new Se("Could not expand input before linking.","jsonld.LinkError",{cause:e}));var i;try{i=(new De).flatten(o)}catch(l){return a(l)}r.graph=!0,r.skipExpansion=!0,n.compact(i,t,r,function(e,t,r){if(e)return a(new Se("Could not compact flattened output before linking.","jsonld.LinkError",{cause:e}));var o=O(r,"@graph"),i=t[o][0],l=function(e){if(T(e)||A(e)){if(T(e)){if(l.visited[e["@id"]])return;l.visited[e["@id"]]=!0}for(var t in e){var a=e[t],o="@id"===n.getContextValue(r,t,"@type");if(A(a)||T(a)||o)if(J(a)&&o)e[t]=a=i[a],l(a);else if(A(a))for(var u=0;u<a.length;++u)J(a[u])&&o?a[u]=i[a[u]]:T(a[u])&&"@id"in a[u]&&(a[u]=i[a[u]["@id"]]),l(a[u]);else if(T(a)){var s=a["@id"];e[t]=a=i[s],l(a)}}}};l.visited={},l(i),t.of_type={};for(var u in i)if("@type"in i[u]){var s=i[u]["@type"];A(s)||(s=[s]);for(var c=0;c<s.length;++c)s[c]in t.of_type||(t.of_type[s[c]]=[]),t.of_type[s[c]].push(i[u])}a(null,t)})})},n.normalize=function(e,t,r){
if(arguments.length<1)return n.nextTick(function(){r(new TypeError("Could not normalize, too few arguments."))});if("function"==typeof t&&(r=t,t={}),t=t||{},"algorithm"in t||(t.algorithm="URGNA2012"),"base"in t||(t.base="string"==typeof e?e:""),"documentLoader"in t||(t.documentLoader=n.loadDocument),"inputFormat"in t){if("application/nquads"!==t.inputFormat)return r(new Se("Unknown normalization input format.","jsonld.NormalizeError"));var a=K(e);(new De).normalize(a,t,r)}else{var o=W(t);delete o.format,o.produceGeneralizedRdf=!1,n.toRDF(e,o,function(e,n){return e?r(new Se("Could not convert input to RDF dataset before normalization.","jsonld.NormalizeError",{cause:e})):void(new De).normalize(n,t,r)})}},n.fromRDF=function(e,t,r){return arguments.length<1?n.nextTick(function(){r(new TypeError("Could not convert from RDF, too few arguments."))}):("function"==typeof t&&(r=t,t={}),t=t||{},"useRdfType"in t||(t.useRdfType=!1),"useNativeTypes"in t||(t.useNativeTypes=!1),"format"in t||!J(e)||"format"in t||(t.format="application/nquads"),void n.nextTick(function(){function n(e,t,n){(new De).fromRDF(e,t,n)}var a;if(t.format){if(a=t.rdfParser||se[t.format],!a)return r(new Se("Unknown input format.","jsonld.UnknownFormat",{format:t.format}))}else a=function(){return e};var o=!1;try{e=a(e,function(e,a){return o=!0,e?r(e):void n(a,t,r)})}catch(i){if(!o)return r(i);throw i}if(e){if("then"in e)return e.then(function(e){n(e,t,r)},r);n(e,t,r)}}))},n.toRDF=function(e,t,r){return arguments.length<1?n.nextTick(function(){r(new TypeError("Could not convert to RDF, too few arguments."))}):("function"==typeof t&&(r=t,t={}),t=t||{},"base"in t||(t.base="string"==typeof e?e:""),"documentLoader"in t||(t.documentLoader=n.loadDocument),void n.expand(e,t,function(e,n){if(e)return r(new Se("Could not expand input before serialization to RDF.","jsonld.RdfError",{cause:e}));var a;try{if(a=De.prototype.toRDF(n,t),t.format){if("application/nquads"===t.format)return r(null,ee(a));throw new Se("Unknown output format.","jsonld.UnknownFormat",{format:t.format})}}catch(o){return r(o)}r(null,a)}))},n.createNodeMap=function(e,t,r){return arguments.length<1?n.nextTick(function(){r(new TypeError("Could not create node map, too few arguments."))}):("function"==typeof t&&(r=t,t={}),t=t||{},"base"in t||(t.base="string"==typeof e?e:""),"documentLoader"in t||(t.documentLoader=n.loadDocument),void n.expand(e,t,function(e,n){if(e)return r(new Se("Could not expand input before creating node map.","jsonld.CreateNodeMapError",{cause:e}));var a;try{a=(new De).createNodeMap(n,t)}catch(o){return r(o)}r(null,a)}))},n.merge=function(e,t,r,a){function o(e,t){if(!u){if(e)return u=e,a(new Se("Could not expand input before flattening.","jsonld.FlattenError",{cause:e}));l.push(t),0===--s&&i(l)}}function i(e){var o=!0;"mergeNodes"in r&&(o=r.mergeNodes);var i,l=r.namer||r.issuer||new re("_:b"),u={"@default":{}};try{for(var s=0;s<e.length;++s){var c=e[s];c=n.relabelBlankNodes(c,{issuer:new re("_:b"+s+"-")});var d=o||0===s?u:{"@default":{}};if(f(c,d,"@default",l),d!==u)for(var h in d){var v=d[h];if(h in u){var g=u[h];for(var y in v)y in g||(g[y]=v[y])}else u[h]=v}}i=p(u)}catch(m){return a(m)}for(var x=[],b=Object.keys(i).sort(),w=0;w<b.length;++w){var j=i[b[w]];H(j)||x.push(j)}return null===t?a(null,x):(r.graph=!0,r.skipExpansion=!0,void n.compact(x,t,r,function(e,t){return e?a(new Se("Could not compact merged output.","jsonld.MergeError",{cause:e})):void a(null,t)}))}if(arguments.length<1)return n.nextTick(function(){a(new TypeError("Could not merge, too few arguments."))});if(!A(e))return n.nextTick(function(){a(new TypeError('Could not merge, "docs" must be an array.'))});"function"==typeof r?(a=r,r={}):"function"==typeof t&&(a=t,t=null,r={}),r=r||{};for(var l=[],u=null,s=e.length,c=0;c<e.length;++c){var d={};for(var h in r)d[h]=r[h];n.expand(e[c],d,o)}},n.relabelBlankNodes=function(e,t){t=t||{};var n=t.namer||t.issuer||new re("_:b");return o(n,e)},n.prependBase=function(e,t){return N(e,t)},n.documentLoader=function(t,r){var a=new Se("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed"});return e?r(a,{contextUrl:null,documentUrl:t,document:null}):n.promisify(function(e){e(a)})},n.loadDocument=function(e,t){var r=n.documentLoader(e,t);r&&"then"in r&&r.then(t.bind(null,null),t)},n.promises=function(e){e=e||{};var t=Array.prototype.slice,r=n.promisify,a=e.api||{},o=e.version||"jsonld.js";"string"==typeof e.api&&(e.version||(o=e.api),a={}),a.expand=function(e){if(arguments.length<1)throw new TypeError("Could not expand, too few arguments.");return r.apply(null,[n.expand].concat(t.call(arguments)))},a.compact=function(e,a){if(arguments.length<2)throw new TypeError("Could not compact, too few arguments.");var o=function(e,t,r,a){n.compact(e,t,r,function(e,t){a(e,t)})};return r.apply(null,[o].concat(t.call(arguments)))},a.flatten=function(e){if(arguments.length<1)throw new TypeError("Could not flatten, too few arguments.");return r.apply(null,[n.flatten].concat(t.call(arguments)))},a.frame=function(e,a){if(arguments.length<2)throw new TypeError("Could not frame, too few arguments.");return r.apply(null,[n.frame].concat(t.call(arguments)))},a.fromRDF=function(e){if(arguments.length<1)throw new TypeError("Could not convert from RDF, too few arguments.");return r.apply(null,[n.fromRDF].concat(t.call(arguments)))},a.toRDF=function(e){if(arguments.length<1)throw new TypeError("Could not convert to RDF, too few arguments.");return r.apply(null,[n.toRDF].concat(t.call(arguments)))},a.normalize=function(e){if(arguments.length<1)throw new TypeError("Could not normalize, too few arguments.");return r.apply(null,[n.normalize].concat(t.call(arguments)))},"jsonld.js"===o&&(a.link=function(e,a){if(arguments.length<2)throw new TypeError("Could not link, too few arguments.");return r.apply(null,[n.link].concat(t.call(arguments)))},a.objectify=function(e){return r.apply(null,[n.objectify].concat(t.call(arguments)))},a.createNodeMap=function(e){return r.apply(null,[n.createNodeMap].concat(t.call(arguments)))},a.merge=function(e){return r.apply(null,[n.merge].concat(t.call(arguments)))});try{n.Promise=global.Promise||require("es6-promise").Promise}catch(i){var l=function(){throw new Error("Unable to find a Promise implementation.")};for(var u in a)a[u]=l}return a},n.promisify=function(e){if(!n.Promise)try{n.Promise=global.Promise||require("es6-promise").Promise}catch(t){throw new Error("Unable to find a Promise implementation.")}var r=Array.prototype.slice.call(arguments,1);return new n.Promise(function(t,n){e.apply(null,r.concat(function(e,r){e?n(e):t(r)}))})},n.promises({api:n.promises}),r.prototype=n.promises({version:"json-ld-1.0"}),r.prototype.toString=function(){return this instanceof r?"[object JsonLdProcessor]":"[object JsonLdProcessorPrototype]"},n.JsonLdProcessor=r;var oe=!!Object.defineProperty;if(oe)try{Object.defineProperty({},"x",{})}catch(ie){oe=!1}oe&&(Object.defineProperty(r,"prototype",{writable:!1,enumerable:!1}),Object.defineProperty(r.prototype,"constructor",{writable:!0,enumerable:!1,configurable:!0,value:r})),t&&"undefined"==typeof global.JsonLdProcessor&&(oe?Object.defineProperty(global,"JsonLdProcessor",{writable:!0,enumerable:!1,configurable:!0,value:r}):global.JsonLdProcessor=r);var le="function"==typeof setImmediate&&setImmediate,ue=le?function(e){le(e)}:function(e){setTimeout(e,0)};"object"==typeof process&&"function"==typeof process.nextTick?n.nextTick=process.nextTick:n.nextTick=ue,n.setImmediate=le?ue:n.nextTick,n.parseLinkHeader=function(e){for(var t={},n=e.match(/(?:<[^>]*?>|"[^"]*?"|[^,])+/g),r=/\s*<([^>]*?)>\s*(?:;\s*(.*))?/,a=0;a<n.length;++a){var o=n[a].match(r);if(o){for(var i={target:o[1]},l=o[2],u=/(.*?)=(?:(?:"([^"]*?)")|([^"]*?))\s*(?:(?:;\s*)|$)/g;o=u.exec(l);)i[o[1]]=void 0===o[2]?o[3]:o[2];var s=i.rel||"";A(t[s])?t[s].push(i):s in t?t[s]=[t[s],i]:t[s]=i}}return t},n.RequestQueue=function(){this._requests={}},n.RequestQueue.prototype.wrapLoader=function(e){return this._loader=e,this._usePromise=1===e.length,this.add.bind(this)},n.RequestQueue.prototype.add=function(e,t){var r=this;if(!t&&!r._usePromise)throw new Error("callback must be specified.");return r._usePromise?new n.Promise(function(t,n){var a=r._requests[e];a||(a=r._requests[e]=r._loader(e).then(function(t){return delete r._requests[e],t})["catch"](function(t){throw delete r._requests[e],t})),a.then(function(e){t(e)})["catch"](function(e){n(e)})}):void(e in r._requests?r._requests[e].push(t):(r._requests[e]=[t],r._loader(e,function(t,n){var a=r._requests[e];delete r._requests[e];for(var o=0;o<a.length;++o)a[o](t,n)})))},n.DocumentCache=function(e){this.order=[],this.cache={},this.size=e||50,this.expires=3e4},n.DocumentCache.prototype.get=function(e){if(e in this.cache){var t=this.cache[e];if(t.expires>=+new Date)return t.ctx;delete this.cache[e],this.order.splice(this.order.indexOf(e),1)}return null},n.DocumentCache.prototype.set=function(e,t){this.order.length===this.size&&delete this.cache[this.order.shift()],this.order.push(e),this.cache[e]={ctx:t,expires:+new Date+this.expires}},n.ActiveContextCache=function(e){this.order=[],this.cache={},this.size=e||100},n.ActiveContextCache.prototype.get=function(e,t){var n=JSON.stringify(e),r=JSON.stringify(t),a=this.cache[n];return a&&r in a?a[r]:null},n.ActiveContextCache.prototype.set=function(e,t,n){if(this.order.length===this.size){var r=this.order.shift();delete this.cache[r.activeCtx][r.localCtx]}var a=JSON.stringify(e),o=JSON.stringify(t);this.order.push({activeCtx:a,localCtx:o}),a in this.cache||(this.cache[a]={}),this.cache[a][o]=W(n)},n.cache={activeCtx:new n.ActiveContextCache},n.documentLoaders={},n.documentLoaders.jquery=function(e,t){function r(r,a){return 0!==r.indexOf("http:")&&0!==r.indexOf("https:")?a(new Se('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:r}),{contextUrl:null,documentUrl:r,document:null}):t.secure&&0!==r.indexOf("https")?a(new Se('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:r}),{contextUrl:null,documentUrl:r,document:null}):void e.ajax({url:r,accepts:{json:"application/ld+json, application/json"},headers:{Accept:"application/ld+json, application/json"},dataType:"json",crossDomain:!0,success:function(e,t,o){var i={contextUrl:null,documentUrl:r,document:e},l=o.getResponseHeader("Content-Type"),u=o.getResponseHeader("Link");if(u&&"application/ld+json"!==l){if(u=n.parseLinkHeader(u)[Oe],A(u))return a(new Se("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:r}),i);u&&(i.contextUrl=u.target)}a(null,i)},error:function(e,t,n){a(new Se("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:r,cause:n}),{contextUrl:null,documentUrl:r,document:null})}})}t=t||{};var a=new n.RequestQueue,o="usePromise"in t?t.usePromise:"undefined"!=typeof Promise;return o?a.wrapLoader(function(e){return n.promisify(r,e)}):a.wrapLoader(r)},n.documentLoaders.node=function(e){function t(l,u,s){function c(e,r,o){if(d={contextUrl:null,documentUrl:l,document:o||null},e)return s(new Se("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:l,cause:e}),d);var c=i.STATUS_CODES[r.statusCode];if(r.statusCode>=400)return s(new Se("URL could not be dereferenced: "+c,"jsonld.InvalidUrl",{code:"loading document failed",url:l,httpStatusCode:r.statusCode}),d);if(r.headers.link&&"application/ld+json"!==r.headers["content-type"]){var f=n.parseLinkHeader(r.headers.link)[Oe];if(A(f))return s(new Se("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:l}),d);f&&(d.contextUrl=f.target)}return r.statusCode>=300&&r.statusCode<400&&r.headers.location?u.length===a?s(new Se("URL could not be dereferenced; there were too many redirects.","jsonld.TooManyRedirects",{code:"loading document failed",url:l,httpStatusCode:r.statusCode,redirects:u}),d):-1!==u.indexOf(l)?s(new Se("URL could not be dereferenced; infinite redirection was detected.","jsonld.InfiniteRedirectDetected",{code:"recursive context inclusion",url:l,httpStatusCode:r.statusCode,redirects:u}),d):(u.push(l),t(r.headers.location,u,s)):(u.push(l),void s(e,d))}if(0!==l.indexOf("http:")&&0!==l.indexOf("https:"))return s(new Se('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:l}),{contextUrl:null,documentUrl:l,document:null});if(e.secure&&0!==l.indexOf("https"))return s(new Se('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:l}),{contextUrl:null,documentUrl:l,document:null});var d=null;return null!==d?s(null,d):void o({url:l,headers:{Accept:"application/ld+json, application/json"},strictSSL:r,followRedirect:!1},c)}e=e||{};var r="strictSSL"in e?e.strictSSL:!0,a="maxRedirects"in e?e.maxRedirects:-1,o=require("request"),i=require("http"),l=new n.RequestQueue;return e.usePromise?l.wrapLoader(function(e){return n.promisify(t,e,[])}):l.wrapLoader(function(e,n){t(e,[],n)})},n.documentLoaders.xhr=function(e){function t(t,a){if(0!==t.indexOf("http:")&&0!==t.indexOf("https:"))return a(new Se('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:t}),{contextUrl:null,documentUrl:t,document:null});if(e.secure&&0!==t.indexOf("https"))return a(new Se('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:t}),{contextUrl:null,documentUrl:t,document:null});var o=e.xhr||XMLHttpRequest,i=new o;i.onload=function(){if(i.status>=400)return a(new Se("URL could not be dereferenced: "+i.statusText,"jsonld.LoadDocumentError",{code:"loading document failed",url:t,httpStatusCode:i.status}),{contextUrl:null,documentUrl:t,document:null});var e,o={contextUrl:null,documentUrl:t,document:i.response},l=i.getResponseHeader("Content-Type");if(r.test(i.getAllResponseHeaders())&&(e=i.getResponseHeader("Link")),e&&"application/ld+json"!==l){if(e=n.parseLinkHeader(e)[Oe],A(e))return a(new Se("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:t}),o);e&&(o.contextUrl=e.target)}a(null,o)},i.onerror=function(){a(new Se("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:t}),{contextUrl:null,documentUrl:t,document:null})},i.open("GET",t,!0),i.setRequestHeader("Accept","application/ld+json, application/json"),i.send()}e=e||{};var r=/(^|(\r\n))link:/i,a=new n.RequestQueue,o="usePromise"in e?e.usePromise:"undefined"!=typeof Promise;return o?a.wrapLoader(function(e){return n.promisify(t,e)}):a.wrapLoader(t)},n.useDocumentLoader=function(e){if(!(e in n.documentLoaders))throw new Se('Unknown document loader type: "'+e+'"',"jsonld.UnknownDocumentLoader",{type:e});n.documentLoader=n.documentLoaders[e].apply(n,Array.prototype.slice.call(arguments,1))},n.processContext=function(e,t){var r={},a=2;arguments.length>3&&(r=arguments[2]||{},a+=1);var o=arguments[a];return"base"in r||(r.base=""),"documentLoader"in r||(r.documentLoader=n.loadDocument),null===t?o(null,R(r)):(t=W(t),T(t)&&"@context"in t||(t={"@context":t}),void Z(t,r,function(t,n){if(t)return o(t);try{n=(new De).processContext(e,n,r)}catch(a){return o(a)}o(null,n)}))},n.hasProperty=function(e,t){var n=!1;if(t in e){var r=e[t];n=!A(r)||r.length>0}return n},n.hasValue=function(e,t,r){var a=!1;if(n.hasProperty(e,t)){var o=e[t],i=Q(o);if(A(o)||i){i&&(o=o["@list"]);for(var l=0;l<o.length;++l)if(n.compareValues(r,o[l])){a=!0;break}}else A(r)||(a=n.compareValues(r,o))}return a},n.addValue=function(e,t,r,a){if(a=a||{},"propertyIsArray"in a||(a.propertyIsArray=!1),"allowDuplicate"in a||(a.allowDuplicate=!0),A(r)){0!==r.length||!a.propertyIsArray||t in e||(e[t]=[]);for(var o=0;o<r.length;++o)n.addValue(e,t,r[o],a)}else if(t in e){var i=!a.allowDuplicate&&n.hasValue(e,t,r);A(e[t])||i&&!a.propertyIsArray||(e[t]=[e[t]]),i||e[t].push(r)}else e[t]=a.propertyIsArray?[r]:r},n.getValues=function(e,t){var n=e[t]||[];return A(n)||(n=[n]),n},n.removeProperty=function(e,t){delete e[t]},n.removeValue=function(e,t,r,a){a=a||{},"propertyIsArray"in a||(a.propertyIsArray=!1);var o=n.getValues(e,t).filter(function(e){return!n.compareValues(e,r)});0===o.length?n.removeProperty(e,t):1!==o.length||a.propertyIsArray?e[t]=o:e[t]=o[0]},n.compareValues=function(e,t){return e===t?!0:X(e)&&X(t)&&e["@value"]===t["@value"]&&e["@type"]===t["@type"]&&e["@language"]===t["@language"]&&e["@index"]===t["@index"]?!0:T(e)&&"@id"in e&&T(t)&&"@id"in t?e["@id"]===t["@id"]:!1},n.getContextValue=function(e,t,n){var r=null;if(null===t)return r;if("@language"===n&&n in e&&(r=e[n]),e.mappings[t]){var a=e.mappings[t];M(n)?r=a:n in a&&(r=a[n])}return r};var se={};if(n.registerRDFParser=function(e,t){se[e]=t},n.unregisterRDFParser=function(e){delete se[e]},e){if("undefined"==typeof ce)var ce=null;if("undefined"==typeof de)var de={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}var fe="http://www.w3.org/2001/XMLSchema#boolean",pe="http://www.w3.org/2001/XMLSchema#double",he="http://www.w3.org/2001/XMLSchema#integer",ve="http://www.w3.org/2001/XMLSchema#string",ge="http://www.w3.org/1999/02/22-rdf-syntax-ns#",ye=ge+"List",me=ge+"first",xe=ge+"rest",be=ge+"nil",we=ge+"type",je=ge+"PlainLiteral",ke=ge+"XMLLiteral",Ie=ge+"object",Le=ge+"langString",Oe="http://www.w3.org/ns/json-ld#context",Ee=10,Se=function(t,n,r){e?(Error.call(this),Error.captureStackTrace(this,this.constructor)):"undefined"!=typeof Error&&(this.stack=(new Error).stack),this.name=n||"jsonld.Error",this.message=t||"An unspecified JSON-LD error occurred.",this.details=r||{}};e?require("util").inherits(Se,Error):"undefined"!=typeof Error&&(Se.prototype=new Error);var De=function(){};De.prototype.compact=function(e,t,r,a){if(A(r)){for(var o=[],i=0;i<r.length;++i){var l=this.compact(e,t,r[i],a);null!==l&&o.push(l)}if(a.compactArrays&&1===o.length){var u=n.getContextValue(e,t,"@container");null===u&&(o=o[0])}return o}if(T(r)){if(a.link&&"@id"in r&&r["@id"]in a.link)for(var s=a.link[r["@id"]],i=0;i<s.length;++i)if(s[i].expanded===r)return s[i].compacted;if(X(r)||H(r)){var o=E(e,t,r);return a.link&&H(r)&&(r["@id"]in a.link||(a.link[r["@id"]]=[]),a.link[r["@id"]].push({expanded:r,compacted:o})),o}var c="@reverse"===t,o={};a.link&&"@id"in r&&(r["@id"]in a.link||(a.link[r["@id"]]=[]),a.link[r["@id"]].push({expanded:r,compacted:o}));for(var d=Object.keys(r).sort(),f=0;f<d.length;++f){var p=d[f],h=r[p];if("@id"!==p&&"@type"!==p)if("@reverse"!==p)if("@index"!==p)if("@graph"!==p&&"@list"!==p&&_(p)){var v=O(e,p);n.addValue(o,v,h)}else{if(0===h.length){var g=O(e,p,h,{vocab:!0},c);n.addValue(o,g,h,{propertyIsArray:!0})}for(var y=0;y<h.length;++y){var m=h[y],g=O(e,p,m,{vocab:!0},c),u=n.getContextValue(e,g,"@container"),x=Q(m),b=null;x&&(b=m["@list"]);var w=this.compact(e,g,x?b:m,a);if(x)if(A(w)||(w=[w]),"@list"!==u){var j={};j[O(e,"@list")]=w,w=j,"@index"in m&&(w[O(e,"@index")]=m["@index"])}else if(g in o)throw new Se('JSON-LD compact error; property has a "@list" @container rule but there is more than a single @list that matches the compacted term in the document. Compaction might mix unwanted items into the list.',"jsonld.SyntaxError",{code:"compaction to list of lists"});if("@language"===u||"@index"===u){var k;g in o?k=o[g]:o[g]=k={},"@language"===u&&X(w)&&(w=w["@value"]),n.addValue(k,m[u],w)}else{var I=!a.compactArrays||"@set"===u||"@list"===u||A(w)&&0===w.length||"@list"===p||"@graph"===p;n.addValue(o,g,w,{propertyIsArray:I})}}}else{var u=n.getContextValue(e,t,"@container");if("@index"===u)continue;var v=O(e,p);n.addValue(o,v,h)}else{var L=this.compact(e,"@reverse",h,a);for(var S in L)if(e.mappings[S]&&e.mappings[S].reverse){var D=L[S],u=n.getContextValue(e,S,"@container"),N="@set"===u||!a.compactArrays;n.addValue(o,S,D,{propertyIsArray:N}),delete L[S]}if(Object.keys(L).length>0){var v=O(e,p);n.addValue(o,v,L)}}else{var L;if(J(h))L=O(e,h,null,{vocab:"@type"===p});else{L=[];for(var y=0;y<h.length;++y)L.push(O(e,h[y],null,{vocab:!0}))}var v=O(e,p),I=A(L)&&0===h.length;n.addValue(o,v,L,{propertyIsArray:I})}}return o}return r},De.prototype.expand=function(e,t,r,o,l){var u=this;if(null===r||void 0===r)return null;if(!A(r)&&!T(r))return l||null!==t&&"@graph"!==D(e,t,{vocab:!0})?i(e,t,r):null;if(A(r)){var s=[],c=n.getContextValue(e,t,"@container");l=l||"@list"===c;for(var d=0;d<r.length;++d){var f=u.expand(e,t,r[d],o);if(l&&(A(f)||Q(f)))throw new Se("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"});null!==f&&(A(f)?s=s.concat(f):s.push(f))}return s}"@context"in r&&(e=u.processContext(e,r["@context"],o));for(var p=D(e,t,{vocab:!0}),s={},h=Object.keys(r).sort(),v=0;v<h.length;++v){var g,y=h[v],m=r[y];if("@context"!==y){var x=D(e,y,{vocab:!0});if(null!==x&&($(x)||_(x))){if(_(x)){if("@reverse"===p)throw new Se("Invalid JSON-LD syntax; a keyword cannot be used as a @reverse property.","jsonld.SyntaxError",{code:"invalid reverse property map",value:m});if(x in s)throw new Se("Invalid JSON-LD syntax; colliding keywords detected.","jsonld.SyntaxError",{code:"colliding keywords",keyword:x})}if("@id"===x&&!J(m)){if(!o.isFrame)throw new Se('Invalid JSON-LD syntax; "@id" value must a string.',"jsonld.SyntaxError",{code:"invalid @id value",value:m});if(!T(m))throw new Se('Invalid JSON-LD syntax; "@id" value must be a string or an object.',"jsonld.SyntaxError",{code:"invalid @id value",value:m})}if("@type"===x&&q(m),"@graph"===x&&!T(m)&&!A(m))throw new Se('Invalid JSON-LD syntax; "@graph" value must not be an object or an array.',"jsonld.SyntaxError",{code:"invalid @graph value",value:m});if("@value"===x&&(T(m)||A(m)))throw new Se('Invalid JSON-LD syntax; "@value" value must not be an object or an array.',"jsonld.SyntaxError",{code:"invalid value object value",value:m});if("@language"===x){if(null===m)continue;if(!J(m))throw new Se('Invalid JSON-LD syntax; "@language" value must be a string.',"jsonld.SyntaxError",{code:"invalid language-tagged string",value:m});m=m.toLowerCase()}if("@index"===x&&!J(m))throw new Se('Invalid JSON-LD syntax; "@index" value must be a string.',"jsonld.SyntaxError",{code:"invalid @index value",value:m});if("@reverse"!==x){var c=n.getContextValue(e,y,"@container");if("@language"===c&&T(m))g=a(m);else if("@index"===c&&T(m))g=function(t){for(var n=[],r=Object.keys(m).sort(),a=0;a<r.length;++a){var i=r[a],l=m[i];A(l)||(l=[l]),l=u.expand(e,t,l,o,!1);for(var s=0;s<l.length;++s){var c=l[s];"@index"in c||(c["@index"]=i),n.push(c)}}return n}(y);else{var b="@list"===x;if(b||"@set"===x){var w=t;if(b&&"@graph"===p&&(w=null),g=u.expand(e,w,m,o,b),b&&Q(g))throw new Se("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"})}else g=u.expand(e,y,m,o,!1)}if(null!==g||"@value"===x)if("@list"===x||Q(g)||"@list"!==c||(g=A(g)?g:[g],g={"@list":g}),e.mappings[y]&&e.mappings[y].reverse){var j=s["@reverse"]=s["@reverse"]||{};A(g)||(g=[g]);for(var k=0;k<g.length;++k){var I=g[k];if(X(I)||Q(I))throw new Se('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{code:"invalid reverse property value",value:g});n.addValue(j,x,I,{propertyIsArray:!0})}}else{var L=-1===["@index","@id","@type","@value","@language"].indexOf(x);n.addValue(s,x,g,{propertyIsArray:L})}}else{if(!T(m))throw new Se('Invalid JSON-LD syntax; "@reverse" value must be an object.',"jsonld.SyntaxError",{code:"invalid @reverse value",value:m});if(g=u.expand(e,"@reverse",m,o),"@reverse"in g)for(var O in g["@reverse"])n.addValue(s,O,g["@reverse"][O],{propertyIsArray:!0});var j=s["@reverse"]||null;for(var O in g)if("@reverse"!==O){null===j&&(j=s["@reverse"]={}),n.addValue(j,O,[],{propertyIsArray:!0});for(var E=g[O],k=0;k<E.length;++k){var I=E[k];if(X(I)||Q(I))throw new Se('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{code:"invalid reverse property value",value:g});n.addValue(j,O,I,{propertyIsArray:!0})}}}}}}h=Object.keys(s);var S=h.length;if("@value"in s){if("@type"in s&&"@language"in s)throw new Se('Invalid JSON-LD syntax; an element containing "@value" may not contain both "@type" and "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:s});var N=S-1;if("@type"in s&&(N-=1),"@index"in s&&(N-=1),"@language"in s&&(N-=1),0!==N)throw new Se('Invalid JSON-LD syntax; an element containing "@value" may only have an "@index" property and at most one other property which can be "@type" or "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:s});if(null===s["@value"])s=null;else{if("@language"in s&&!J(s["@value"]))throw new Se("Invalid JSON-LD syntax; only strings may be language-tagged.","jsonld.SyntaxError",{code:"invalid language-tagged value",element:s});if("@type"in s&&(!$(s["@type"])||0===s["@type"].indexOf("_:")))throw new Se('Invalid JSON-LD syntax; an element containing "@value" and "@type" must have an absolute IRI for the value of "@type".',"jsonld.SyntaxError",{code:"invalid typed value",element:s})}}else if("@type"in s&&!A(s["@type"]))s["@type"]=[s["@type"]];else if("@set"in s||"@list"in s){if(S>1&&!(2===S&&"@index"in s))throw new Se('Invalid JSON-LD syntax; if an element has the property "@set" or "@list", then it can have at most one other property that is "@index".',"jsonld.SyntaxError",{code:"invalid set or list object",element:s});"@set"in s&&(s=s["@set"],h=Object.keys(s),S=h.length)}else 1===S&&"@language"in s&&(s=null);return!T(s)||o.keepFreeFloatingNodes||l||null!==t&&"@graph"!==p||(0===S||"@value"in s||"@list"in s||1===S&&"@id"in s)&&(s=null),s},De.prototype.createNodeMap=function(e,t){t=t||{};var n=t.namer||t.issuer||new re("_:b"),r={"@default":{}};return f(e,r,"@default",n),p(r)},De.prototype.flatten=function(e){for(var t=this.createNodeMap(e),n=[],r=Object.keys(t).sort(),a=0;a<r.length;++a){var o=t[r[a]];H(o)||n.push(o)}return n},De.prototype.frame=function(e,t,n){var r={options:n,graphs:{"@default":{},"@merged":{}},subjectStack:[],link:{}},a=new re("_:b");f(e,r.graphs,"@merged",a),r.subjects=r.graphs["@merged"];var o=[];return h(r,Object.keys(r.subjects).sort(),t,o,null),o},De.prototype.normalize=function(e,t,n){return"URDNA2015"===t.algorithm?new Ne(t).main(e,n):"URGNA2012"===t.algorithm?new Ce(t).main(e,n):void n(new Error("Invalid RDF Dataset Normalization algorithm: "+t.algorithm))},De.prototype.fromRDF=function(e,t,r){var a={},o={"@default":a},i={};for(var l in e){var u=e[l];l in o||(o[l]={}),"@default"===l||l in a||(a[l]={"@id":l});for(var s=o[l],d=0;d<u.length;++d){var f=u[d],p=f.subject.value,h=f.predicate.value,v=f.object;p in s||(s[p]={"@id":p});var g=s[p],y="IRI"===v.type||"blank node"===v.type;if(!y||v.value in s||(s[v.value]={"@id":v.value}),h!==we||t.useRdfType||!y){var m=c(v,t.useNativeTypes);if(n.addValue(g,h,m,{propertyIsArray:!0}),y)if(v.value===be){var x=s[v.value];"usages"in x||(x.usages=[]),x.usages.push({node:g,property:h,value:m})}else v.value in i?i[v.value]=!1:i[v.value]={node:g,property:h,value:m}}else n.addValue(g,"@type",v.value,{propertyIsArray:!0})}}for(var l in o){var b=o[l];if(be in b){for(var w=b[be],j=0;j<w.usages.length;++j){for(var k=w.usages[j],g=k.node,I=k.property,L=k.value,O=[],E=[],S=Object.keys(g).length;I===xe&&T(i[g["@id"]])&&A(g[me])&&1===g[me].length&&A(g[xe])&&1===g[xe].length&&(3===S||4===S&&A(g["@type"])&&1===g["@type"].length&&g["@type"][0]===ye)&&(O.push(g[me][0]),E.push(g["@id"]),k=i[g["@id"]],g=k.node,I=k.property,L=k.value,S=Object.keys(g).length,0===g["@id"].indexOf("_:")););if(I===me){if(g["@id"]===be)continue;L=b[L["@id"]][xe][0],O.pop(),E.pop()}delete L["@id"],L["@list"]=O.reverse();for(var D=0;D<E.length;++D)delete b[E[D]]}delete w.usages}}for(var N=[],C=Object.keys(a).sort(),j=0;j<C.length;++j){var R=C[j],g=a[R];if(R in o)for(var u=g["@graph"]=[],b=o[R],_=Object.keys(b).sort(),U=0;U<_.length;++U){var q=b[_[U]];H(q)||u.push(q)}H(g)||N.push(g)}r(null,N)},De.prototype.toRDF=function(e,t){var n=new re("_:b"),r={"@default":{}};f(e,r,"@default",n);for(var a={},o=Object.keys(r).sort(),i=0;i<o.length;++i){var u=o[i];("@default"===u||$(u))&&(a[u]=l(r[u],n,t))}return a},De.prototype.processContext=function(e,t,r){T(t)&&"@context"in t&&A(t["@context"])&&(t=t["@context"]);var a=A(t)?t:[t];if(0===a.length)return e.clone();for(var o=e,i=0;i<a.length;++i){var l=a[i];if(null!==l){if(T(l)&&"@context"in l&&(l=l["@context"]),!T(l))throw new Se("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{code:"invalid local context",context:l});if(n.cache.activeCtx){var u=n.cache.activeCtx.get(e,l);if(u){o=e=u;continue}}e=o,o=o.clone();var s={};if("@base"in l){var c=l["@base"];if(null===c)c=null;else{if(!J(c))throw new Se('Invalid JSON-LD syntax; the value of "@base" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid base IRI",context:l});if(""!==c&&!$(c))throw new Se('Invalid JSON-LD syntax; the value of "@base" in a @context must be an absolute IRI or the empty string.',"jsonld.SyntaxError",{code:"invalid base IRI",context:l})}null!==c&&(c=n.url.parse(c||"")),o["@base"]=c,s["@base"]=!0}if("@vocab"in l){var d=l["@vocab"];if(null===d)delete o["@vocab"];else{if(!J(d))throw new Se('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid vocab mapping",context:l});if(!$(d))throw new Se('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be an absolute IRI.',"jsonld.SyntaxError",{code:"invalid vocab mapping",context:l});o["@vocab"]=d}s["@vocab"]=!0}if("@language"in l){var d=l["@language"];if(null===d)delete o["@language"];else{if(!J(d))throw new Se('Invalid JSON-LD syntax; the value of "@language" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid default language",context:l});o["@language"]=d.toLowerCase()}s["@language"]=!0}for(var f in l)S(o,l,f,s);n.cache.activeCtx&&n.cache.activeCtx.set(e,l,o)}else o=e=R(r)}return o};var Ne=function(){var e={subject:"s",object:"o",name:"g"},t=function(e){e=e||{},this.name="URDNA2015",this.options=e,this.blankNodeInfo={},this.hashToBlankNodes={},this.canonicalIssuer=new re("_:c14n"),this.quads=[],this.schedule={},"maxCallStackDepth"in e?this.schedule.MAX_DEPTH=e.maxCallStackDepth:this.schedule.MAX_DEPTH=500,"maxTotalCallStackDepth"in e?this.schedule.MAX_TOTAL_DEPTH=e.maxCallStackDepth:this.schedule.MAX_TOTAL_DEPTH=4294967295,this.schedule.depth=0,this.schedule.totalDepth=0,"timeSlice"in e?this.schedule.timeSlice=e.timeSlice:this.schedule.timeSlice=10};return t.prototype.doWork=function(e,t){var r=this.schedule;return r.totalDepth>=r.MAX_TOTAL_DEPTH?t(new Error("Maximum total call stack depth exceeded; normalization aborting.")):void function a(){if(r.depth===r.MAX_DEPTH)return r.depth=0,r.running=!1,n.nextTick(a);var o=(new Date).getTime();return r.running||(r.start=(new Date).getTime(),r.deadline=r.start+r.timeSlice),o<r.deadline?(r.running=!0,r.depth++,r.totalDepth++,e(function(e,n){r.depth--,r.totalDepth--,t(e,n)})):(r.depth=0,r.running=!1,void n.setImmediate(a))}()},t.prototype.forEach=function(e,t,n){var r,a,o=this,i=0;if(A(e))a=e.length,r=function(){return i===a?!1:(r.value=e[i++],r.key=i,!0)};else{var l=Object.keys(e);a=l.length,
r=function(){return i===a?!1:(r.key=l[i++],r.value=e[r.key],!0)}}!function u(e,a){return e?n(e):r()?o.doWork(function(){t(r.value,r.key,u)}):void n()}()},t.prototype.waterfall=function(e,t){var n=this;n.forEach(e,function(e,t,r){n.doWork(e,r)},t)},t.prototype.whilst=function(e,t,n){var r=this;!function a(o){return o?n(o):e()?void r.doWork(t,a):n()}()},t.prototype.main=function(e,t){var n=this;n.schedule.start=(new Date).getTime();var r;if(n.options.format&&"application/nquads"!==n.options.format)return t(new Se("Unknown output format.","jsonld.UnknownFormat",{format:n.options.format}));var a={};n.waterfall([function(t){n.forEach(e,function(e,t,r){"@default"===t&&(t=null),n.forEach(e,function(e,r,o){null!==t&&(0===t.indexOf("_:")?e.name={type:"blank node",value:t}:e.name={type:"IRI",value:t}),n.quads.push(e),n.forEachComponent(e,function(t){if("blank node"===t.type){var r=t.value;r in n.blankNodeInfo?n.blankNodeInfo[r].quads.push(e):(a[r]=!0,n.blankNodeInfo[r]={quads:[e]})}}),o()},r)},t)},function(e){var t=!0;n.whilst(function(){return t},function(e){t=!1,n.hashToBlankNodes={},n.waterfall([function(e){n.forEach(a,function(e,t,r){n.hashFirstDegreeQuads(t,function(e,a){return e?r(e):(a in n.hashToBlankNodes?n.hashToBlankNodes[a].push(t):n.hashToBlankNodes[a]=[t],void r())})},e)},function(e){var r=Object.keys(n.hashToBlankNodes).sort();n.forEach(r,function(e,r,o){var i=n.hashToBlankNodes[e];if(i.length>1)return o();var l=i[0];n.canonicalIssuer.getId(l),delete a[l],delete n.hashToBlankNodes[e],t=!0,o()},e)}],e)},e)},function(e){var t=Object.keys(n.hashToBlankNodes).sort();n.forEach(t,function(e,t,r){var a=[],o=n.hashToBlankNodes[e];n.waterfall([function(e){n.forEach(o,function(e,t,r){if(n.canonicalIssuer.hasId(e))return r();var o=new re("_:b");o.getId(e),n.hashNDegreeQuads(e,o,function(e,t){return e?r(e):(a.push(t),void r())})},e)},function(e){a.sort(function(e,t){return e.hash<t.hash?-1:e.hash>t.hash?1:0}),n.forEach(a,function(e,t,r){for(var a in e.issuer.existing)n.canonicalIssuer.getId(a);r()},e)}],r)},e)},function(e){var t=[];n.waterfall([function(e){n.forEach(n.quads,function(e,r,a){n.forEachComponent(e,function(e){"blank node"===e.type&&0!==e.value.indexOf(n.canonicalIssuer.prefix)&&(e.value=n.canonicalIssuer.getId(e.value))}),t.push(te(e)),a()},e)},function(e){return t.sort(),"application/nquads"===n.options.format?(r=t.join(""),e()):(r=K(t.join("")),void e())}],e)}],function(e){t(e,r)})},t.prototype.hashFirstDegreeQuads=function(e,t){var n=this,r=n.blankNodeInfo[e];if("hash"in r)return t(null,r.hash);var a=[],o=r.quads;n.forEach(o,function(t,r,o){var i={predicate:t.predicate};n.forEachComponent(t,function(t,r){i[r]=n.modifyFirstDegreeComponent(e,t,r)}),a.push(te(i)),o()},function(e){return e?t(e):(a.sort(),r.hash=_e.hashNQuads(n.name,a),void t(null,r.hash))})},t.prototype.modifyFirstDegreeComponent=function(e,t){return"blank node"!==t.type?t:(t=W(t),t.value=t.value===e?"_:a":"_:z",t)},t.prototype.hashRelatedBlankNode=function(e,t,n,r,a){var o,i=this;i.waterfall([function(t){return i.canonicalIssuer.hasId(e)?(o=i.canonicalIssuer.getId(e),t()):n.hasId(e)?(o=n.getId(e),t()):void i.hashFirstDegreeQuads(e,function(e,n){return e?t(e):(o=n,void t())})}],function(e){if(e)return a(e);var n=new _e(i.name);return n.update(r),"g"!==r&&n.update(i.getRelatedPredicate(t)),n.update(o),a(null,n.digest())})},t.prototype.getRelatedPredicate=function(e){return"<"+e.predicate.value+">"},t.prototype.hashNDegreeQuads=function(e,t,n){var r,a=this,o=new _e(a.name);a.waterfall([function(n){a.createHashToRelated(e,t,function(e,t){return e?n(e):(r=t,void n())})},function(e){var n=Object.keys(r).sort();a.forEach(n,function(e,n,i){o.update(e);var l,u="",s=new Re(r[e]);a.whilst(function(){return s.hasNext()},function(e){var n=s.next(),r=t.clone(),o="",i=[];a.waterfall([function(t){a.forEach(n,function(t,n,l){return a.canonicalIssuer.hasId(t)?o+=a.canonicalIssuer.getId(t):(r.hasId(t)||i.push(t),o+=r.getId(t)),0!==u.length&&o.length>=u.length&&o>u?e():void l()},t)},function(t){a.forEach(i,function(t,n,i){a.hashNDegreeQuads(t,r,function(n,a){return n?i(n):(o+=r.getId(t),o+="<"+a.hash+">",r=a.issuer,0!==u.length&&o.length>=u.length&&o>u?e():void i())})},t)},function(e){(0===u.length||u>o)&&(u=o,l=r),e()}],e)},function(e){return e?i(e):(o.update(u),t=l,void i())})},e)}],function(e){n(e,{hash:o.digest(),issuer:t})})},t.prototype.createHashToRelated=function(t,n,r){var a=this,o={},i=a.blankNodeInfo[t].quads;a.forEach(i,function(r,i,l){a.forEach(r,function(i,l,u){if("predicate"===l||"blank node"!==i.type||i.value===t)return u();var s=i.value,c=e[l];a.hashRelatedBlankNode(s,r,n,c,function(e,t){return e?u(e):(t in o?o[t].push(s):o[t]=[s],void u())})},l)},function(e){r(e,o)})},t.prototype.forEachComponent=function(e,t){for(var n in e)"predicate"!==n&&t(e[n],n,e)},t}(),Ce=function(){var e=function(e){Ne.call(this,e),this.name="URGNA2012"};return e.prototype=new Ne,e.prototype.modifyFirstDegreeComponent=function(e,t,n){return"blank node"!==t.type?t:(t=W(t),"name"===n?t.value="_:g":t.value=t.value===e?"_:a":"_:z",t)},e.prototype.getRelatedPredicate=function(e){return e.predicate.value},e.prototype.createHashToRelated=function(e,t,n){var r=this,a={},o=r.blankNodeInfo[e].quads;r.forEach(o,function(n,o,i){var l,u;if("blank node"===n.subject.type&&n.subject.value!==e)u=n.subject.value,l="p";else{if("blank node"!==n.object.type||n.object.value===e)return i();u=n.object.value,l="r"}r.hashRelatedBlankNode(u,n,t,l,function(e,t){t in a?a[t].push(u):a[t]=[u],i()})},function(e){n(e,a)})},e}();Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on non-object");var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),n.registerRDFParser("application/nquads",K),n.registerRDFParser("rdfa-api",ne),n.IdentifierIssuer=re,n.UniqueNamer=re,re.prototype.clone=function(){var e=new re(this.prefix);return e.counter=this.counter,e.existing=W(this.existing),e},re.prototype.getId=function(e){if(e&&e in this.existing)return this.existing[e];var t=this.prefix+this.counter;return this.counter+=1,e&&(this.existing[e]=t),t},re.prototype.getName=re.prototype.getName,re.prototype.hasId=function(e){return e in this.existing},re.prototype.isNamed=re.prototype.hasId;var Re=function(e){this.list=e.sort(),this.done=!1,this.left={};for(var t=0;t<e.length;++t)this.left[e[t]]=!0};Re.prototype.hasNext=function(){return!this.done},Re.prototype.next=function(){for(var e=this.list.slice(),t=null,n=0,r=this.list.length,a=0;r>a;++a){var o=this.list[a],i=this.left[o];(null===t||o>t)&&(i&&a>0&&o>this.list[a-1]||!i&&r-1>a&&o>this.list[a+1])&&(t=o,n=a)}if(null===t)this.done=!0;else{var l=this.left[t]?n-1:n+1;this.list[n]=this.list[l],this.list[l]=t;for(var a=0;r>a;++a)this.list[a]>t&&(this.left[this.list[a]]=!this.left[this.list[a]])}return e};var _e=function(e){if(!(this instanceof _e))return new _e(e);if(-1===["URDNA2015","URGNA2012"].indexOf(e))throw new Error("Invalid RDF Dataset Normalization algorithm: "+e);_e._init.call(this,e)};if(_e.hashNQuads=function(e,t){for(var n=new _e(e),r=0;r<t.length;++r)n.update(t[r]);return n.digest()},function(e){if(e){var t=require("crypto");return _e._init=function(e){e="URDNA2015"===e?"sha256":"sha1",this.md=t.createHash(e)},_e.prototype.update=function(e){return this.md.update(e,"utf8")},void(_e.prototype.digest=function(){return this.md.digest("hex")})}_e._init=function(e){e="URDNA2015"===e?new a.Algorithm:new r.Algorithm,this.md=new n(e)},_e.prototype.update=function(e){return this.md.update(e)},_e.prototype.digest=function(){return this.md.digest().toHex()};var n=function(e){if(!(this instanceof n))return new n(e);if(this._algorithm=e,!n._padding||n._padding.length<this._algorithm.blockSize){n._padding=String.fromCharCode(128);for(var t=String.fromCharCode(0),r=64;r>0;)1&r&&(n._padding+=t),r>>>=1,r>0&&(t+=t)}this.start()};n.prototype.start=function(){this.messageLength=0,this.fullMessageLength=[];for(var e=this._algorithm.messageLengthSize/4,t=0;e>t;++t)this.fullMessageLength.push(0);return this._input=new n.ByteBuffer,this.state=this._algorithm.start(),this},n.prototype.update=function(e){e=new n.ByteBuffer(unescape(encodeURIComponent(e))),this.messageLength+=e.length();var t=e.length();t=[t/4294967296>>>0,t>>>0];for(var r=this.fullMessageLength.length-1;r>=0;--r)this.fullMessageLength[r]+=t[1],t[1]=t[0]+(this.fullMessageLength[r]/4294967296>>>0),this.fullMessageLength[r]=this.fullMessageLength[r]>>>0,t[0]=t[1]/4294967296>>>0;for(this._input.putBytes(e.bytes());this._input.length()>=this._algorithm.blockSize;)this.state=this._algorithm.digest(this.state,this._input);return(this._input.read>2048||0===this._input.length())&&this._input.compact(),this},n.prototype.digest=function(){var e=new n.ByteBuffer;e.putBytes(this._input.bytes());var t=this.fullMessageLength[this.fullMessageLength.length-1]+this._algorithm.messageLengthSize,r=t&this._algorithm.blockSize-1;e.putBytes(n._padding.substr(0,this._algorithm.blockSize-r));for(var a=new n.ByteBuffer,o=0;o<this.fullMessageLength.length;++o)a.putInt32(this.fullMessageLength[o]<<3|this.fullMessageLength[o+1]>>>28);this._algorithm.writeMessageLength(e,a);var i=this._algorithm.digest(this.state.copy(),e),l=new n.ByteBuffer;return i.write(l),l},n.ByteBuffer=function(e){"string"==typeof e?this.data=e:this.data="",this.read=0},n.ByteBuffer.prototype.putInt32=function(e){this.data+=String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)},n.ByteBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},n.ByteBuffer.prototype.putBytes=function(e){this.data+=e},n.ByteBuffer.prototype.bytes=function(){return this.data.slice(this.read)},n.ByteBuffer.prototype.length=function(){return this.data.length-this.read},n.ByteBuffer.prototype.compact=function(){this.data=this.data.slice(this.read),this.read=0},n.ByteBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var n=this.data.charCodeAt(t);16>n&&(e+="0"),e+=n.toString(16)}return e};var r={_w:null};r.Algorithm=function(){this.name="sha1",this.blockSize=64,this.digestLength=20,this.messageLengthSize=8},r.Algorithm.prototype.start=function(){return r._w||(r._w=new Array(80)),r._createState()},r.Algorithm.prototype.writeMessageLength=function(e,t){e.putBytes(t.bytes())},r.Algorithm.prototype.digest=function(e,t){for(var n,a,o,i,l,u,s,c,d=t.length(),f=r._w;d>=64;){for(a=e.h0,o=e.h1,i=e.h2,l=e.h3,u=e.h4,c=0;16>c;++c)n=t.getInt32(),f[c]=n,s=l^o&(i^l),n=(a<<5|a>>>27)+s+u+1518500249+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;for(;20>c;++c)n=f[c-3]^f[c-8]^f[c-14]^f[c-16],n=n<<1|n>>>31,f[c]=n,s=l^o&(i^l),n=(a<<5|a>>>27)+s+u+1518500249+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;for(;32>c;++c)n=f[c-3]^f[c-8]^f[c-14]^f[c-16],n=n<<1|n>>>31,f[c]=n,s=o^i^l,n=(a<<5|a>>>27)+s+u+1859775393+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;for(;40>c;++c)n=f[c-6]^f[c-16]^f[c-28]^f[c-32],n=n<<2|n>>>30,f[c]=n,s=o^i^l,n=(a<<5|a>>>27)+s+u+1859775393+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;for(;60>c;++c)n=f[c-6]^f[c-16]^f[c-28]^f[c-32],n=n<<2|n>>>30,f[c]=n,s=o&i|l&(o^i),n=(a<<5|a>>>27)+s+u+2400959708+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;for(;80>c;++c)n=f[c-6]^f[c-16]^f[c-28]^f[c-32],n=n<<2|n>>>30,f[c]=n,s=o^i^l,n=(a<<5|a>>>27)+s+u+3395469782+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;e.h0=e.h0+a|0,e.h1=e.h1+o|0,e.h2=e.h2+i|0,e.h3=e.h3+l|0,e.h4=e.h4+u|0,d-=64}return e},r._createState=function(){var e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520};return e.copy=function(){var t=r._createState();return t.h0=e.h0,t.h1=e.h1,t.h2=e.h2,t.h3=e.h3,t.h4=e.h4,t},e.write=function(t){t.putInt32(e.h0),t.putInt32(e.h1),t.putInt32(e.h2),t.putInt32(e.h3),t.putInt32(e.h4)},e};var a={_k:null,_w:null};a.Algorithm=function(){this.name="sha256",this.blockSize=64,this.digestLength=32,this.messageLengthSize=8},a.Algorithm.prototype.start=function(){return a._k||a._init(),a._createState()},a.Algorithm.prototype.writeMessageLength=function(e,t){e.putBytes(t.bytes())},a.Algorithm.prototype.digest=function(e,t){for(var n,r,o,i,l,u,s,c,d,f,p,h,v,g,y,m=t.length(),x=a._k,b=a._w;m>=64;){for(s=0;16>s;++s)b[s]=t.getInt32();for(;64>s;++s)n=b[s-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,r=b[s-15],r=(r>>>7|r<<25)^(r>>>18|r<<14)^r>>>3,b[s]=n+b[s-7]+r+b[s-16]|0;for(c=e.h0,d=e.h1,f=e.h2,p=e.h3,h=e.h4,v=e.h5,g=e.h6,y=e.h7,s=0;64>s;++s)i=(h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7),l=g^h&(v^g),o=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),u=c&d|f&(c^d),n=y+i+l+x[s]+b[s],r=o+u,y=g,g=v,v=h,h=p+n|0,p=f,f=d,d=c,c=n+r|0;e.h0=e.h0+c|0,e.h1=e.h1+d|0,e.h2=e.h2+f|0,e.h3=e.h3+p|0,e.h4=e.h4+h|0,e.h5=e.h5+v|0,e.h6=e.h6+g|0,e.h7=e.h7+y|0,m-=64}return e},a._createState=function(){var e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225};return e.copy=function(){var t=a._createState();return t.h0=e.h0,t.h1=e.h1,t.h2=e.h2,t.h3=e.h3,t.h4=e.h4,t.h5=e.h5,t.h6=e.h6,t.h7=e.h7,t},e.write=function(t){t.putInt32(e.h0),t.putInt32(e.h1),t.putInt32(e.h2),t.putInt32(e.h3),t.putInt32(e.h4),t.putInt32(e.h5),t.putInt32(e.h6),t.putInt32(e.h7)},e},a._init=function(){a._k=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a._w=new Array(64)}}(e),!ce)var Te=function(){ce=require("xmldom").XMLSerializer};if(n.url={},n.url.parsers={simple:{keys:["href","scheme","authority","path","query","fragment"],regex:/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/},full:{keys:["href","protocol","scheme","authority","auth","user","password","hostname","port","path","directory","file","query","fragment"],regex:/^(([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(?:(((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},n.url.parse=function(e,t){for(var r={},a=n.url.parsers[t||"full"],o=a.regex.exec(e),i=a.keys.length;i--;)r[a.keys[i]]=void 0===o[i]?null:o[i];return r.normalizedPath=ae(r.path,!!r.authority),r},e?n.useDocumentLoader("node"):"undefined"!=typeof XMLHttpRequest&&n.useDocumentLoader("xhr"),e){n.use=function(e){switch(e){case"request":n.request=require("jsonld-request");break;default:throw new Se("Unknown extension.","jsonld.UnknownExtension",{extension:e})}};var Ue={exports:{},filename:__dirname};require("pkginfo")(Ue,"version"),n.version=Ue.exports.version}return n},r=function(){return n(function(){return r()})};return!e&&"function"==typeof define&&define.amd?define([],function(){return n(r),r}):(n(r),"function"==typeof require&&"undefined"!=typeof module&&module.exports&&(module.exports=r),t&&("undefined"==typeof jsonld?jsonld=jsonldjs=r:jsonldjs=r)),r}();
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},"/node_modules/jsonld/js")

},{"_process":24,"crypto":13,"es6-promise":7,"http":13,"jsonld-request":13,"pkginfo":13,"request":13,"util":13,"xmldom":13}],15:[function(require,module,exports){
var globalRequire=require;require=function(){};var exports=module.exports={Lexer:require("./lib/N3Lexer"),Parser:require("./lib/N3Parser"),Writer:require("./lib/N3Writer"),Store:require("./lib/N3Store"),StreamParser:require("./lib/N3StreamParser"),StreamWriter:require("./lib/N3StreamWriter"),Util:require("./lib/N3Util")};Object.keys(exports).forEach(function(e){Object.defineProperty(exports,e,{configurable:!0,enumerable:!0,get:function(){return delete exports[e],exports[e]=globalRequire("./lib/N3"+e)}})});
},{"./lib/N3Lexer":16,"./lib/N3Parser":17,"./lib/N3Store":18,"./lib/N3StreamParser":19,"./lib/N3StreamWriter":20,"./lib/N3Util":21,"./lib/N3Writer":22}],16:[function(require,module,exports){
function N3Lexer(e){if(!(this instanceof N3Lexer))return new N3Lexer(e);if(e&&e.lineMode){this._tripleQuotedString=this._number=this._boolean=/$0^/;var f=this;this._tokenize=this.tokenize,this.tokenize=function(e,u){this._tokenize(e,function(e,t){!e&&/^(?:IRI|prefixed|literal|langcode|type|\.|eof)$/.test(t.type)?u&&u(e,t):u&&u(e||f._syntaxError(t.type,u=null))})}}}var fromCharCode=String.fromCharCode,immediately="function"==typeof setImmediate?setImmediate:function(e){setTimeout(e,0)},escapeSequence=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g,escapeReplacements={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},illegalIriChars=/[\x00-\x20<>\\"\{\}\|\^\`]/;N3Lexer.prototype={_iri:/^<((?:[^>\\]|\\[uU])+)>/,_unescapedIri:/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>/,_unescapedString:/^"[^"\\]+"(?=[^"\\])/,_singleQuotedString:/^"[^"\\]*(?:\\.[^"\\]*)*"(?=[^"\\])|^'[^'\\]*(?:\\.[^'\\]*)*'(?=[^'\\])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,_prefixed:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?=\.?[,;\s#()\[\]\{\}"'<])/,_blank:/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=\.?[,;:\s#()\[\]\{\}"'<])/,_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d*\.?\d+)(?=[.,;:\s#()\[\]\{\}"'<])/,_boolean:/^(?:true|false)(?=[.,;:\s#()\[\]\{\}"'<])/,_keyword:/^@[a-z]+(?=[\s#<:])/,_sparqlKeyword:/^(?:PREFIX|BASE|GRAPH)(?=[\s#<:])/i,_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_whitespace:/^[ \t]+/,_endOfFile:/^(?:#[^\n\r]*)?$/,_tokenizeToEnd:function(e,f){function u(f){e(f._syntaxError(/^\S*/.exec(t)[0]))}for(var t=this._input;;){for(var i;i=this._newline.exec(t);)t=t.substr(i[0].length,t.length),this._line++;if((i=this._whitespace.exec(t))&&(t=t.substr(i[0].length,t.length)),this._endOfFile.test(t))return f&&e(t=null,{line:this._line,type:"eof",value:"",prefix:""}),this._input=t;var n,r=this._line,d="",s="",a="",c=t[0],o=null,l=0,x=!1;switch(c){case"^":if(1===t.length)break;if("^"!==t[1])return u(this);if(this._prevTokenType="^",t=t.substr(2),"<"!==t[0]){x=!0;break}case"<":if(o=this._unescapedIri.exec(t))d="IRI",s=o[1];else if(o=this._iri.exec(t)){if(n=this._unescape(o[1]),null===n||illegalIriChars.test(n))return u(this);d="IRI",s=n}break;case"_":((o=this._blank.exec(t))||f&&(o=this._blank.exec(t+" ")))&&(d="prefixed",a="_",s=o[1]);break;case'"':case"'":if(o=this._unescapedString.exec(t))d="literal",s=o[0];else if(o=this._singleQuotedString.exec(t)){if(n=this._unescape(o[0]),null===n)return u(this);d="literal",s=n.replace(/^'|'$/g,'"')}else if(o=this._tripleQuotedString.exec(t)){if(n=o[1]||o[2],this._line+=n.split(/\r\n|\r|\n/).length-1,n=this._unescape(n),null===n)return u(this);d="literal",s=n.replace(/^'|'$/g,'"')}break;case"@":"literal"===this._prevTokenType&&(o=this._langcode.exec(t))?(d="langcode",s=o[1]):(o=this._keyword.exec(t))&&(d=o[0]);break;case".":if(1===t.length?f:t[1]<"0"||t[1]>"9"){d=".",l=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(o=this._number.exec(t))&&(d="literal",s='"'+o[0]+'"^^http://www.w3.org/2001/XMLSchema#'+(o[1]?"double":/^[+\-]?\d+$/.test(o[0])?"integer":"decimal"));break;case"B":case"b":case"p":case"P":case"G":case"g":(o=this._sparqlKeyword.exec(t))?d=o[0].toUpperCase():x=!0;break;case"f":case"t":(o=this._boolean.exec(t))?(d="literal",s='"'+o[0]+'"^^http://www.w3.org/2001/XMLSchema#boolean'):x=!0;break;case"a":(o=this._shortPredicates.exec(t))?(d="abbreviation",s="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):x=!0;break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":l=1,d=c;break;default:x=!0}if(x&&("@prefix"!==this._prevTokenType&&"PREFIX"!==this._prevTokenType||!(o=this._prefix.exec(t))?((o=this._prefixed.exec(t))||f&&(o=this._prefixed.exec(t+" ")))&&(d="prefixed",a=o[1]||"",s=this._unescape(o[2])):(d="prefix",s=o[1]||"")),"^"===this._prevTokenType&&(d="IRI"===d||"prefixed"===d?"type":""),!d)return f||!/^'''|^"""/.test(t)&&/\n|\r/.test(t)?u(this):this._input=t;e(null,{line:r,type:d,value:s,prefix:a}),this._prevTokenType=d,t=t.substr(l||o[0].length,t.length)}},_unescape:function(e){try{return e.replace(escapeSequence,function(e,f,u,t){var i;if(f){if(i=parseInt(f,16),isNaN(i))throw new Error;return fromCharCode(i)}if(u){if(i=parseInt(u,16),isNaN(i))throw new Error;return 65535>=i?fromCharCode(i):fromCharCode(55296+(i-=65536)/1024,56320+(1023&i))}var n=escapeReplacements[t];if(!n)throw new Error;return n})}catch(f){return null}},_syntaxError:function(e){return this._input=null,new Error('Syntax error: unexpected "'+e+'" on line '+this._line+".")},tokenize:function(e,f){function u(e){null!==i._input&&(i._input+=e,i._tokenizeToEnd(f,!1))}function t(){null!==i._input&&i._tokenizeToEnd(f,!0)}var i=this;this._line=1,"string"==typeof e?(this._input=e,immediately(function(){i._tokenizeToEnd(f,!0)})):(this._input="",e&&"function"!=typeof e?("function"==typeof e.setEncoding&&e.setEncoding("utf8"),e.on("data",u),e.on("end",t)):(this.addChunk=u,this.end=t,f||(f=e)))}},module.exports=N3Lexer;
},{}],17:[function(require,module,exports){
function N3Parser(e){if(!(this instanceof N3Parser))return new N3Parser(e);this._tripleStack=[],this._graph=null,e=e||{},this._setBase(e.documentIRI);var t="string"==typeof e.format&&e.format.match(/\w*$/)[0].toLowerCase(),r="turtle"===t,a="trig"===t,s=/triple/.test(t),i=/quad/.test(t),n=s||i;(this._supportsNamedGraphs=!r)||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(r||a||s),n&&(this._base="",this._resolveIRI=function(e){return this._error("Disallowed relative IRI",e),this._callback=noop,this._subject=null}),this._blankNodePrefix="string"!=typeof e.blankNodePrefix?"":"_:"+e.blankNodePrefix.replace(/^_:/,""),this._lexer=e.lexer||new N3Lexer({lineMode:n})}function noop(){}var N3Lexer=require("./N3Lexer"),RDF_PREFIX="http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDF_NIL=RDF_PREFIX+"nil",RDF_FIRST=RDF_PREFIX+"first",RDF_REST=RDF_PREFIX+"rest",absoluteIRI=/^[a-z][a-z0-9+.-]*:/i,schemeAuthority=/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i,dotSegments=/(?:^|\/)\.\.?(?:$|[\/#?])/,blankNodePrefix=0,blankNodeCount=0;N3Parser._resetBlankNodeIds=function(){blankNodePrefix=blankNodeCount=0},N3Parser.prototype={_setBase:function(e){if(e){if(e.indexOf("#")>=0)throw new Error("Invalid base IRI "+e)}else e=null;(this._base=e)&&(this._basePath=e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(schemeAuthority),this._baseRoot=e[0],this._baseScheme=e[1])},_readInTopContext:function(e){switch(e.type){case"eof":return null!==this._graph?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"@prefix":return this._sparqlStyle=!1,this._readPrefix;case"PREFIX":return this._sparqlStyle=!0,this._readPrefix;case"@base":return this._sparqlStyle=!1,this._readBaseIRI;case"BASE":return this._sparqlStyle=!0,this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}},_readSubject:function(e){switch(this._predicate=null,e.type){case"IRI":null===this._base||absoluteIRI.test(e.value)?this._subject=e.value:this._subject=this._resolveIRI(e);break;case"prefixed":var t=this._prefixes[e.prefix];if(void 0===t)return this._error('Undefined prefix "'+e.prefix+':"',e);this._subject=t+e.value;break;case"[":return this._subject="_:b"+blankNodeCount++,this._tripleStack.push({subject:this._subject,predicate:null,object:null,type:"blank"}),this._readBlankNodeHead;case"(":return this._tripleStack.push({subject:RDF_NIL,predicate:null,object:null,type:"list"}),this._subject=null,this._readListItem;case"}":return this._readPunctuation(e);default:return this._error("Expected subject but got "+e.type,e)}return this._readPredicateOrNamedGraph},_readPredicate:function(e){var t=e.type;switch(t){case"IRI":case"abbreviation":null===this._base||absoluteIRI.test(e.value)?this._predicate=e.value:this._predicate=this._resolveIRI(e);break;case"prefixed":if("_"===e.prefix)return this._error("Disallowed blank node as predicate",e);var r=this._prefixes[e.prefix];if(void 0===r)return this._error('Undefined prefix "'+e.prefix+':"',e);this._predicate=r+e.value;break;case".":case"]":case"}":return null===this._predicate?this._error("Unexpected "+t,e):(this._subject=null,"]"===t?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._readPredicate;default:return this._error('Expected predicate to follow "'+this._subject+'"',e)}return this._readObject},_readObject:function(e){switch(e.type){case"IRI":null===this._base||absoluteIRI.test(e.value)?this._object=e.value:this._object=this._resolveIRI(e);break;case"prefixed":var t=this._prefixes[e.prefix];if(void 0===t)return this._error('Undefined prefix "'+e.prefix+':"',e);this._object=t+e.value;break;case"literal":return this._object=e.value,this._readDataTypeOrLang;case"[":var r="_:b"+blankNodeCount++;return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:r,type:"blank"}),this._subject=r,this._readBlankNodeHead;case"(":return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:RDF_NIL,type:"list"}),this._subject=null,this._readListItem;default:return this._error('Expected object to follow "'+this._predicate+'"',e)}return this._getTripleEndReader()},_readPredicateOrNamedGraph:function(e){return"{"===e.type?this._readGraph(e):this._readPredicate(e)},_readGraph:function(e){return"{"!==e.type?this._error("Expected graph but got "+e.type,e):(this._graph=this._subject,this._subject=null,this._readSubject)},_readBlankNodeHead:function(e){return"]"===e.type?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))},_readBlankNodeTail:function(e){if("]"!==e.type)return this._readBlankNodePunctuation(e);null!==this._subject&&this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""});var t=this._tripleStack.pop();return this._subject=t.subject,null!==t.object?(this._predicate=t.predicate,this._object=t.object,this._getTripleEndReader()):null!==this._predicate?this._readPredicate:this._readPredicateOrNamedGraph},_readDataTypeOrLang:function(e){switch(e.type){case"type":var t;if(""===e.prefix)t=null===this._base||absoluteIRI.test(e.value)?e.value:this._resolveIRI(e);else{var r=this._prefixes[e.prefix];if(void 0===r)return this._error('Undefined prefix "'+e.prefix+':"',e);t=r+e.value}return this._object+="^^"+t,this._getTripleEndReader();case"langcode":return this._object+="@"+e.value.toLowerCase(),this._getTripleEndReader();default:return this._getTripleEndReader().call(this,e)}},_readListItem:function(e){var t=null,r=null,a=this._subject,s=this._tripleStack,i=s[s.length-1],n=this._readListItem;switch(e.type){case"IRI":t=null===this._base||absoluteIRI.test(e.value)?e.value:this._resolveIRI(e);break;case"prefixed":var l=this._prefixes[e.prefix];if(void 0===l)return this._error('Undefined prefix "'+e.prefix+':"',e);t=l+e.value;break;case"literal":t=e.value,n=this._readDataTypeOrLang;break;case"[":r="_:b"+blankNodeCount++,t="_:b"+blankNodeCount++,s.push({subject:r,predicate:RDF_FIRST,object:t,type:"blank"}),this._subject=t,n=this._readBlankNodeHead;break;case"(":r="_:b"+blankNodeCount++,s.push({subject:r,predicate:RDF_FIRST,object:RDF_NIL,type:"list"}),this._subject=null,n=this._readListItem;break;case")":if(s.pop(),0!==s.length&&"list"===s[s.length-1].type&&this._callback(null,{subject:i.subject,predicate:i.predicate,object:i.object,graph:this._graph||""}),this._subject=i.subject,null===i.predicate){if(n=this._readPredicate,i.subject===RDF_NIL)return n}else if(this._predicate=i.predicate,this._object=i.object,n=this._getTripleEndReader(),i.object===RDF_NIL)return n;r=RDF_NIL;break;default:return this._error('Expected list item instead of "'+e.type+'"',e)}return null===r&&(this._subject=r="_:b"+blankNodeCount++),null===a?i.object===RDF_NIL?i.object=r:i.subject=r:this._callback(null,{subject:a,predicate:RDF_REST,object:r,graph:this._graph||""}),null!==t&&this._callback(null,{subject:r,predicate:RDF_FIRST,object:t,graph:this._graph||""}),n},_readPunctuation:function(e){var t,r=this._subject,a=this._graph;switch(e.type){case"}":if(null===this._graph)return this._error("Unexpected graph closing",e);this._graph=null;case".":this._subject=null,t=this._readInTopContext;break;case";":t=this._readPredicate;break;case",":t=this._readObject;break;case"IRI":if(this._supportsQuads&&null===this._graph){a=null===this._base||absoluteIRI.test(e.value)?e.value:this._resolveIRI(e),r=this._subject,t=this._readQuadPunctuation;break}case"prefixed":if(this._supportsQuads&&null===this._graph){var s=this._prefixes[e.prefix];if(void 0===s)return this._error('Undefined prefix "'+e.prefix+':"',e);a=s+e.value,t=this._readQuadPunctuation;break}default:return this._error('Expected punctuation to follow "'+this._object+'"',e)}return null!==r&&this._callback(null,{subject:r,predicate:this._predicate,object:this._object,graph:a||""}),t},_readBlankNodePunctuation:function(e){var t;switch(e.type){case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:return this._error('Expected punctuation to follow "'+this._object+'"',e)}return this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""}),t},_readQuadPunctuation:function(e){return"."!==e.type?this._error("Expected dot to follow quad",e):this._readInTopContext},_readPrefix:function(e){return"prefix"!==e.type?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)},_readPrefixIRI:function(e){if("IRI"!==e.type)return this._error('Expected IRI to follow prefix "'+this._prefix+':"',e);var t;return t=null===this._base||absoluteIRI.test(e.value)?e.value:this._resolveIRI(e),this._prefixes[this._prefix]=t,this._prefixCallback(this._prefix,t),this._readDeclarationPunctuation},_readBaseIRI:function(e){if("IRI"!==e.type)return this._error("Expected IRI to follow base declaration",e);try{this._setBase(null===this._base||absoluteIRI.test(e.value)?e.value:this._resolveIRI(e))}catch(t){this._error(t.message,e)}return this._readDeclarationPunctuation},_readNamedGraphLabel:function(e){switch(e.type){case"IRI":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}},_readNamedGraphBlankLabel:function(e){return"]"!==e.type?this._error("Invalid graph label",e):(this._subject="_:b"+blankNodeCount++,this._readGraph)},_readDeclarationPunctuation:function(e){return this._sparqlStyle?this._readInTopContext(e):"."!==e.type?this._error("Expected declaration to end with a dot",e):this._readInTopContext},_getTripleEndReader:function(){var e=this._tripleStack;if(0===e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem}},_error:function(e,t){this._callback(new Error(e+" at line "+t.line+"."))},_resolveIRI:function(e){var t=e.value;switch(t[0]){case void 0:return this._base;case"#":return this._base+t;case"?":return this._base.replace(/(?:\?.*)?$/,t);case"/":return("/"===t[1]?this._baseScheme:this._baseRoot)+this._removeDotSegments(t);default:return this._removeDotSegments(this._basePath+t)}},_removeDotSegments:function(e){if(!dotSegments.test(e))return e;for(var t="",r=e.length,a=-1,s=-1,i=0,n="/";r>a;){switch(n){case":":if(0>s&&"/"===e[++a]&&"/"===e[++a])for(;(s=a+1)<r&&"/"!==e[s];)a=s;break;case"?":case"#":a=r;break;case"/":if("."===e[a+1])switch(n=e[++a+1]){case"/":t+=e.substring(i,a-1),i=a+1;break;case void 0:case"?":case"#":return t+e.substring(i,a)+e.substr(a+1);case".":if(n=e[++a+1],void 0===n||"/"===n||"?"===n||"#"===n){if(t+=e.substring(i,a-2),(i=t.lastIndexOf("/"))>=s&&(t=t.substr(0,i)),"/"!==n)return t+"/"+e.substr(a+1);i=a+1}}}n=e[++a]}return t+e.substring(i)},parse:function(e,t,r){this._readCallback=this._readInTopContext,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix||"_:b"+blankNodePrefix++ +"_","function"==typeof e&&(r=t,t=e,e=null),this._callback=t||noop,this._prefixCallback=r||noop;var a=this;this._lexer.tokenize(e,function(e,t){null!==e?(a._callback(e),a._callback=noop):void 0!==a._readCallback&&(a._readCallback=a._readCallback(t))}),e||(this.addChunk=this._lexer.addChunk,this.end=this._lexer.end)}},module.exports=N3Parser;
},{"./N3Lexer":16}],18:[function(require,module,exports){
function N3Store(e,t){return this instanceof N3Store?(this._size=0,this._graphs=Object.create(null),this._entities=Object.create(null),this._entities["><"]=0,this._entityCount=0,this._blankNodeIndex=0,t||!e||e[0]||(t=e,e=null),this._prefixes=Object.create(null),t&&t.prefixes&&this.addPrefixes(t.prefixes),void(e&&this.addTriples(e))):new N3Store(e,t)}var expandPrefixedName=require("./N3Util").expandPrefixedName;N3Store.prototype={get size(){var e=this._size;if(null!==e)return e;var t,i,n=this._graphs;for(var r in n)for(var s in t=n[r].subjects)for(var d in i=t[s])e+=Object.keys(i[d]).length;return this._size=e},_addToIndex:function(e,t,i,n){var r=e[t]||(e[t]={}),s=r[i]||(r[i]={});s[n]=null},_removeFromIndex:function(e,t,i,n){var r,s=e[t],d=s[i];delete d[n];for(r in d)return;delete s[i];for(r in s)return;delete e[t]},_findInIndex:function(e,t,i,n,r,s,d,a){var o,c,u,h=[],f=Object.keys(this._entities);t&&((o=e,e={})[t]=o[t]);for(var _ in e){var l=f[_];if(c=e[_]){i&&((o=c,c={})[i]=o[i]);for(var x in c){var p=f[x];if(u=c[x])for(var b=(n?n in u?[n]:[]:Object.keys(u)),j=b.length-1;j>=0;j--){var I={subject:"",predicate:"",object:"",graph:a};I[r]=l,I[s]=p,I[d]=f[b[j]],h.push(I)}}}}return h},_countInIndex:function(e,t,i,n){var r,s,d,a=0;t&&((r=e,e={})[t]=r[t]);for(var o in e)if(s=e[o]){i&&((r=s,s={})[i]=r[i]);for(var c in s)(d=s[c])&&(n?n in d&&a++:a+=Object.keys(d).length)}return a},addTriple:function(e,t,i,n){t||(n=e.graph,i=e.object,t=e.predicate,e=e.subject),n=n||"";var r=this._graphs[n];r||(r=this._graphs[n]={subjects:{},predicates:{},objects:{}},Object.freeze(r));var s=this._entities;e=s[e]||(s[e]=++this._entityCount),t=s[t]||(s[t]=++this._entityCount),i=s[i]||(s[i]=++this._entityCount),this._addToIndex(r.subjects,e,t,i),this._addToIndex(r.predicates,t,i,e),this._addToIndex(r.objects,i,e,t),this._size=null},addTriples:function(e){for(var t=e.length-1;t>=0;t--)this.addTriple(e[t])},addPrefix:function(e,t){this._prefixes[e]=t},addPrefixes:function(e){for(var t in e)this.addPrefix(t,e[t])},removeTriple:function(e,t,i,n){t||(n=e.graph,i=e.object,t=e.predicate,e=e.subject),n=n||"";var r,s=this._entities,d=this._graphs;if((e=s[e])&&(t=s[t])&&(i=s[i])&&(r=d[n])){var a,o;if((a=r.subjects[e])&&(o=a[t])&&i in o){this._removeFromIndex(r.subjects,e,t,i),this._removeFromIndex(r.predicates,t,i,e),this._removeFromIndex(r.objects,i,e,t),null!==this._size&&this._size--;for(e in r.subjects)return;delete d[n]}}},removeTriples:function(e){for(var t=e.length-1;t>=0;t--)this.removeTriple(e[t])},find:function(e,t,i,n){var r=this._prefixes;return this.findByIRI(expandPrefixedName(e,r),expandPrefixedName(t,r),expandPrefixedName(i,r),expandPrefixedName(n,r))},findByIRI:function(e,t,i,n){n=n||"";var r=this._graphs[n],s=this._entities;return r?e&&!(e=s[e])?[]:t&&!(t=s[t])?[]:i&&!(i=s[i])?[]:e?i?this._findInIndex(r.objects,i,e,t,"object","subject","predicate",n):this._findInIndex(r.subjects,e,t,null,"subject","predicate","object",n):t?this._findInIndex(r.predicates,t,i,null,"predicate","object","subject",n):i?this._findInIndex(r.objects,i,null,null,"object","subject","predicate",n):this._findInIndex(r.subjects,null,null,null,"subject","predicate","object",n):[]},count:function(e,t,i,n){var r=this._prefixes;return this.countByIRI(expandPrefixedName(e,r),expandPrefixedName(t,r),expandPrefixedName(i,r),expandPrefixedName(n,r))},countByIRI:function(e,t,i,n){n=n||"";var r=this._graphs[n],s=this._entities;return r?e&&!(e=s[e])?0:t&&!(t=s[t])?0:i&&!(i=s[i])?0:e?i?this._countInIndex(r.objects,i,e,t):this._countInIndex(r.subjects,e,t,i):t?this._countInIndex(r.predicates,t,i,e):this._countInIndex(r.objects,i,e,t):0},createBlankNode:function(e){var t,i;if(e)for(t=e="_:"+e,i=1;this._entities[t];)t=e+i++;else do t="_:b"+this._blankNodeIndex++;while(this._entities[t]);return this._entities[t]=++this._entityCount,t}},module.exports=N3Store;
},{"./N3Util":21}],19:[function(require,module,exports){
function N3StreamParser(r){if(!(this instanceof N3StreamParser))return new N3StreamParser(r);Transform.call(this,{decodeStrings:!0}),this._readableState.objectMode=!0;var e=this,t=new N3Parser(r);t.parse(function(r,t){t&&e.push(t)||r&&e.emit("error",r)},this.emit.bind(this,"prefix")),this._transform=function(r,e,s){t.addChunk(r),s()},this._flush=function(r){t.end(),r()}}var Transform=require("stream").Transform,util=require("util"),N3Parser=require("./N3Parser.js");util.inherits(N3StreamParser,Transform),module.exports=N3StreamParser;
},{"./N3Parser.js":17,"stream":35,"util":39}],20:[function(require,module,exports){
function N3StreamWriter(r){if(!(this instanceof N3StreamWriter))return new N3StreamWriter(r);Transform.call(this,{encoding:"utf8"}),this._writableState.objectMode=!0;var t=this,e=new N3Writer({write:function(r,e,i){t.push(r),i&&i()},end:function(r){t.push(null),r&&r()}},r);this._transform=function(r,t,i){e.addTriple(r,i)},this._flush=function(r){e.end(r)}}var Transform=require("stream").Transform,util=require("util"),N3Writer=require("./N3Writer.js");util.inherits(N3StreamWriter,Transform),module.exports=N3StreamWriter;
},{"./N3Writer.js":22,"stream":35,"util":39}],21:[function(require,module,exports){
function addN3Util(t,e){for(var r in N3Util)e?t.prototype[r]=applyToThis(N3Util[r]):t[r]=N3Util[r];return t}function applyToThis(t){return function(e){return t(this,e)}}var Xsd="http://www.w3.org/2001/XMLSchema#",XsdString=Xsd+"string",XsdInteger=Xsd+"integer",XsdDecimal=Xsd+"decimal",XsdBoolean=Xsd+"boolean",RdfLangString="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",N3Util={isIRI:function(t){if(!t)return t;var e=t[0];return'"'!==e&&"_"!==e},isLiteral:function(t){return t&&'"'===t[0]},isBlank:function(t){return t&&"_:"===t.substr(0,2)},getLiteralValue:function(t){var e=/^"([^]*)"/.exec(t);if(!e)throw new Error(t+" is not a literal");return e[1]},getLiteralType:function(t){var e=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(t);if(!e)throw new Error(t+" is not a literal");return e[1]||(e[2]?RdfLangString:XsdString)},getLiteralLanguage:function(t){var e=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(t);if(!e)throw new Error(t+" is not a literal");return e[1]?e[1].toLowerCase():""},isPrefixedName:function(t){return t&&/^[^:\/"']*:[^:\/"']+$/.test(t)},expandPrefixedName:function(t,e){var r,n,i,a=/(?:^|"\^\^)([^:\/#"'\^_]*):[^\/]*$/.exec(t);return a&&(r=a[1],n=e[r],i=a.index),void 0===n?t:0===i?n+t.substr(r.length+1):t.substr(0,i+3)+n+t.substr(i+r.length+4)},createIRI:function(t){return t&&'"'===t[0]?N3Util.getLiteralValue(t):t},createLiteral:function(t,e){if(!e)switch(typeof t){case"boolean":e=XsdBoolean;break;case"number":if(isFinite(t)){e=t%1===0?XsdInteger:XsdDecimal;break}default:return'"'+t+'"'}return'"'+t+(/^[a-z]+(-[a-z0-9]+)*$/i.test(e)?'"@'+e.toLowerCase():'"^^'+e)}};module.exports=addN3Util(addN3Util);
},{}],22:[function(require,module,exports){
function N3Writer(e,t){if(!(this instanceof N3Writer))return new N3Writer(e,t);if(e&&"function"!=typeof e.write&&(t=e,e=null),t=t||{},e)this._outputStream=e,this._endStream=void 0===t.end?!0:!!t.end;else{var r="";this._outputStream={write:function(e,t,i){r+=e,i&&i()},end:function(e){e&&e(null,r)}},this._endStream=!0}this._subject=null,/triple|quad/i.test(t.format)?this._writeTriple=this._writeTripleLine:(this._graph="",this._prefixIRIs=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes))}function characterReplacer(e){var t=escapeReplacements[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}var N3LiteralMatcher=/^"([^]*)"(?:\^\^(.+)|@([\-a-z]+))?$/i,RDF_PREFIX="http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDF_TYPE=RDF_PREFIX+"type",escape=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,escapeAll=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,escapeReplacements={"\\":"\\\\",'"':'\\"',"	":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};N3Writer.prototype={_write:function(e,t){this._outputStream.write(e,"utf8",t)},_writeTriple:function(e,t,r,i,n){try{this._graph!==i&&(this._write((null===this._subject?"":this._graph?"\n}\n":".\n")+(i?this._encodeIriOrBlankNode(i)+" {\n":"")),this._subject=null,this._graph="["!==i[0]?i:"]"),this._subject===e?this._predicate===t?this._write(", "+this._encodeObject(r),n):this._write(";\n    "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(r),n):this._write((null===this._subject?"":".\n")+this._encodeSubject(this._subject=e)+" "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(r),n)}catch(c){n&&n(c)}},_writeTripleLine:function(e,t,r,i,n){delete this._prefixMatch;try{this._write(this._encodeIriOrBlankNode(e)+" "+this._encodeIriOrBlankNode(t)+" "+this._encodeObject(r)+(i?" "+this._encodeIriOrBlankNode(i)+".\n":".\n"),n)}catch(c){n&&n(c)}},_encodeIriOrBlankNode:function(e){var t=e[0];if("["===t||"("===t||"_"===t&&":"===e[1])return e;escape.test(e)&&(e=e.replace(escapeAll,characterReplacer));var r=this._prefixRegex.exec(e);return r?r[1]?this._prefixIRIs[r[1]]+r[2]:e:"<"+e+">"},_encodeLiteral:function(e,t,r){return escape.test(e)&&(e=e.replace(escapeAll,characterReplacer)),r?'"'+e+'"@'+r:t?'"'+e+'"^^'+this._encodeIriOrBlankNode(t):'"'+e+'"'},_encodeSubject:function(e){if('"'===e[0])throw new Error("A literal as subject is not allowed: "+e);return"["===e[0]&&(this._subject="]"),this._encodeIriOrBlankNode(e)},_encodePredicate:function(e){if('"'===e[0])throw new Error("A literal as predicate is not allowed: "+e);return e===RDF_TYPE?"a":this._encodeIriOrBlankNode(e)},_encodeObject:function(e){if('"'!==e[0])return this._encodeIriOrBlankNode(e);var t=N3LiteralMatcher.exec(e);if(!t)throw new Error("Invalid literal: "+e);return this._encodeLiteral(t[1],t[2],t[3])},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},addTriple:function(e,t,r,i,n){void 0===r?this._writeTriple(e.subject,e.predicate,e.object,e.graph||"",t):"string"!=typeof i?this._writeTriple(e,t,r,"",i):this._writeTriple(e,t,r,i,n)},addTriples:function(e){for(var t=0;t<e.length;t++)this.addTriple(e[t])},addPrefix:function(e,t,r){var i={};i[e]=t,this.addPrefixes(i,r)},addPrefixes:function(e,t){var r=this._prefixIRIs,i=!1;for(var n in e){var c=e[n];/[#\/]$/.test(c)&&r[c]!==(n+=":")&&(i=!0,r[c]=n,null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null,this._graph=""),this._write("@prefix "+n+" <"+c+">.\n"))}if(i){var s="",a="";for(var h in r)s+=s?"|"+h:h,a+=(a?"|":"")+r[h];s=s.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp("^(?:"+a+")[^/]*$|^("+s+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(i?"\n":"",t)},blank:function(e,t){var r,i,n=e;switch(void 0===e?n=[]:"string"==typeof e?n=[{predicate:e,object:t}]:"length"in e||(n=[e]),i=n.length){case 0:return"[]";case 1:if(r=n[0],"["!==r.object[0])return"[ "+this._encodePredicate(r.predicate)+" "+this._encodeObject(r.object)+" ]";default:for(var c="[",s=0;i>s;s++)r=n[s],r.predicate===e?c+=", "+this._encodeObject(r.object):(c+=(s?";\n  ":"\n  ")+this._encodePredicate(r.predicate)+" "+this._encodeObject(r.object),e=r.predicate);return c+"\n]"}},list:function(e){for(var t=e&&e.length||0,r=new Array(t),i=0;t>i;i++)r[i]=this._encodeObject(e[i]);return"("+r.join(" ")+")"},_prefixRegex:/$0^/,end:function(e){null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null),this._write=this._blockedWrite;var t=e&&function(r,i){t=null,e(r,i)};if(this._endStream)try{return this._outputStream.end(t)}catch(r){}t&&t()}},module.exports=N3Writer;
},{}],23:[function(require,module,exports){
(function (process){
"use strict";function nextTick(e){for(var s=new Array(arguments.length-1),n=0;n<s.length;)s[n++]=arguments[n];process.nextTick(function(){e.apply(null,s)})}!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports=nextTick:module.exports=process.nextTick;
}).call(this,require('_process'))

},{"_process":24}],24:[function(require,module,exports){
function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var e=setTimeout(cleanUpNextTick);draining=!0;for(var n=queue.length;n;){for(currentQueue=queue,queue=[];++queueIndex<n;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,n=queue.length}currentQueue=null,draining=!1,clearTimeout(e)}}function Item(e,n){this.fun=e,this.array=n}function noop(){}var process=module.exports={},queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];queue.push(new Item(e,n)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}],25:[function(require,module,exports){
module.exports=require("./lib/_stream_duplex.js");
},{"./lib/_stream_duplex.js":26}],26:[function(require,module,exports){
"use strict";function Duplex(e){return this instanceof Duplex?(Readable.call(this,e),Writable.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(e)}function onend(){this.allowHalfOpen||this._writableState.ended||processNextTick(onEndNT,this)}function onEndNT(e){e.end()}function forEach(e,t){for(var r=0,i=e.length;i>r;r++)t(e[r],r)}var objectKeys=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};module.exports=Duplex;var processNextTick=require("process-nextick-args"),util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}
},{"./_stream_readable":28,"./_stream_writable":30,"core-util-is":6,"inherits":10,"process-nextick-args":23}],27:[function(require,module,exports){
"use strict";function PassThrough(r){return this instanceof PassThrough?void Transform.call(this,r):new PassThrough(r)}module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(r,s,i){i(null,r)};
},{"./_stream_transform":29,"core-util-is":6,"inherits":10}],28:[function(require,module,exports){
(function (process){
"use strict";function ReadableState(e,t){Duplex=Duplex||require("./_stream_duplex"),e=e||{},this.objectMode=!!e.objectMode,t instanceof Duplex&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(e.encoding),this.encoding=e.encoding)}function Readable(e){return Duplex=Duplex||require("./_stream_duplex"),this instanceof Readable?(this._readableState=new ReadableState(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),void Stream.call(this)):new Readable(e)}function readableAddChunk(e,t,r,n,a){var i=chunkInvalid(t,r);if(i)e.emit("error",i);else if(null===r)t.reading=!1,onEofChunk(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!a){var d=new Error("stream.push() after EOF");e.emit("error",d)}else if(t.endEmitted&&a){var d=new Error("stream.unshift() after end event");e.emit("error",d)}else!t.decoder||a||n||(r=t.decoder.write(r)),a||(t.reading=!1),t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,a?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&emitReadable(e)),maybeReadMore(e,t);else a||(t.reading=!1);return needMoreData(t)}function needMoreData(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function computeNewHighWaterMark(e){return e>=MAX_HWM?e=MAX_HWM:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function howMuchToRead(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:0>=e?0:(e>t.highWaterMark&&(t.highWaterMark=computeNewHighWaterMark(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function chunkInvalid(e,t){var r=null;return Buffer.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function onEofChunk(e,t){if(!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,emitReadable(e)}}function emitReadable(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(debug("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?processNextTick(emitReadable_,e):emitReadable_(e))}function emitReadable_(e){debug("emit readable"),e.emit("readable"),flow(e)}function maybeReadMore(e,t){t.readingMore||(t.readingMore=!0,processNextTick(maybeReadMore_,e,t))}function maybeReadMore_(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(debug("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function pipeOnDrain(e){return function(){var t=e._readableState;debug("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&EElistenerCount(e,"data")&&(t.flowing=!0,flow(e))}}function nReadingNextTick(e){debug("readable nexttick read 0"),e.read(0)}function resume(e,t){t.resumeScheduled||(t.resumeScheduled=!0,processNextTick(resume_,e,t))}function resume_(e,t){t.reading||(debug("resume read 0"),e.read(0)),t.resumeScheduled=!1,e.emit("resume"),flow(e),t.flowing&&!t.reading&&e.read(0)}function flow(e){var t=e._readableState;if(debug("flow",t.flowing),t.flowing)do var r=e.read();while(null!==r&&t.flowing)}function fromList(e,t){var r,n=t.buffer,a=t.length,i=!!t.decoder,d=!!t.objectMode;if(0===n.length)return null;if(0===a)r=null;else if(d)r=n.shift();else if(!e||e>=a)r=i?n.join(""):1===n.length?n[0]:Buffer.concat(n,a),n.length=0;else if(e<n[0].length){var o=n[0];r=o.slice(0,e),n[0]=o.slice(e)}else if(e===n[0].length)r=n.shift();else{r=i?"":new Buffer(e);for(var l=0,u=0,s=n.length;s>u&&e>l;u++){var o=n[0],h=Math.min(e-l,o.length);i?r+=o.slice(0,h):o.copy(r,l,0,h),h<o.length?n[0]=o.slice(h):n.shift(),l+=h}}return r}function endReadable(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,processNextTick(endReadableNT,t,e))}function endReadableNT(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function forEach(e,t){for(var r=0,n=e.length;n>r;r++)t(e[r],r)}function indexOf(e,t){for(var r=0,n=e.length;n>r;r++)if(e[r]===t)return r;return-1}module.exports=Readable;var processNextTick=require("process-nextick-args"),isArray=require("isarray"),Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events"),EElistenerCount=function(e,t){return e.listeners(t).length},Stream;!function(){try{Stream=require("stream")}catch(e){}finally{Stream||(Stream=require("events").EventEmitter)}}();var Buffer=require("buffer").Buffer,util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util"),debug;debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){};var StringDecoder;util.inherits(Readable,Stream);var Duplex,Duplex;Readable.prototype.push=function(e,t){var r=this._readableState;return r.objectMode||"string"!=typeof e||(t=t||r.defaultEncoding,t!==r.encoding&&(e=new Buffer(e,t),t="")),readableAddChunk(this,r,e,t,!1)},Readable.prototype.unshift=function(e){var t=this._readableState;return readableAddChunk(this,t,e,"",!0)},Readable.prototype.isPaused=function(){return this._readableState.flowing===!1},Readable.prototype.setEncoding=function(e){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(e),this._readableState.encoding=e,this};var MAX_HWM=8388608;Readable.prototype.read=function(e){debug("read",e);var t=this._readableState,r=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return debug("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?endReadable(this):emitReadable(this),null;if(e=howMuchToRead(e,t),0===e&&t.ended)return 0===t.length&&endReadable(this),null;var n=t.needReadable;debug("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&(n=!0,debug("length less than watermark",n)),(t.ended||t.reading)&&(n=!1,debug("reading or ended",n)),n&&(debug("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),n&&!t.reading&&(e=howMuchToRead(r,t));var a;return a=e>0?fromList(e,t):null,null===a&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),r!==e&&t.ended&&0===t.length&&endReadable(this),null!==a&&this.emit("data",a),a},Readable.prototype._read=function(e){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(e,t){function r(e){debug("onunpipe"),e===s&&a()}function n(){debug("onend"),e.end()}function a(){debug("cleanup"),e.removeListener("close",o),e.removeListener("finish",l),e.removeListener("drain",c),e.removeListener("error",d),e.removeListener("unpipe",r),s.removeListener("end",n),s.removeListener("end",a),s.removeListener("data",i),b=!0,!h.awaitDrain||e._writableState&&!e._writableState.needDrain||c()}function i(t){debug("ondata");var r=e.write(t);!1===r&&(1!==h.pipesCount||h.pipes[0]!==e||1!==s.listenerCount("data")||b||(debug("false write response, pause",s._readableState.awaitDrain),s._readableState.awaitDrain++),s.pause())}function d(t){debug("onerror",t),u(),e.removeListener("error",d),0===EElistenerCount(e,"error")&&e.emit("error",t)}function o(){e.removeListener("finish",l),u()}function l(){debug("onfinish"),e.removeListener("close",o),u()}function u(){debug("unpipe"),s.unpipe(e)}var s=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1,debug("pipe count=%d opts=%j",h.pipesCount,t);var f=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,p=f?n:a;h.endEmitted?processNextTick(p):s.once("end",p),e.on("unpipe",r);var c=pipeOnDrain(s);e.on("drain",c);var b=!1;return s.on("data",i),e._events&&e._events.error?isArray(e._events.error)?e._events.error.unshift(d):e._events.error=[d,e._events.error]:e.on("error",d),e.once("close",o),e.once("finish",l),e.emit("pipe",s),h.flowing||(debug("pipe resume"),s.resume()),e},Readable.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;n>a;a++)r[a].emit("unpipe",this);return this}var a=indexOf(t.pipes,e);return-1===a?this:(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},Readable.prototype.on=function(e,t){var r=Stream.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&this.readable){var n=this._readableState;n.readableListening||(n.readableListening=!0,n.emittedReadable=!1,n.needReadable=!0,n.reading?n.length&&emitReadable(this,n):processNextTick(nReadingNextTick,this))}return r},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var e=this._readableState;return e.flowing||(debug("resume"),e.flowing=!0,resume(this,e)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;e.on("end",function(){if(debug("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(a){if(debug("wrapped data"),t.decoder&&(a=t.decoder.write(a)),(!t.objectMode||null!==a&&void 0!==a)&&(t.objectMode||a&&a.length)){var i=n.push(a);i||(r=!0,e.pause())}});for(var a in e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));var i=["error","close","destroy","pause","resume"];return forEach(i,function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){debug("wrapped _read",t),r&&(r=!1,e.resume())},n},Readable._fromList=fromList;
}).call(this,require('_process'))

},{"./_stream_duplex":26,"_process":24,"buffer":4,"core-util-is":6,"events":8,"inherits":10,"isarray":12,"process-nextick-args":23,"stream":35,"string_decoder/":36,"util":3}],29:[function(require,module,exports){
"use strict";function TransformState(r){this.afterTransform=function(t,n){return afterTransform(r,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(r,t,n){var e=r._transformState;e.transforming=!1;var a=e.writecb;if(!a)return r.emit("error",new Error("no writecb in Transform class"));e.writechunk=null,e.writecb=null,null!==n&&void 0!==n&&r.push(n),a&&a(t);var i=r._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&r._read(i.highWaterMark)}function Transform(r){if(!(this instanceof Transform))return new Transform(r);Duplex.call(this,r),this._transformState=new TransformState(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,r&&("function"==typeof r.transform&&(this._transform=r.transform),"function"==typeof r.flush&&(this._flush=r.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(r){done(t,r)}):done(t)})}function done(r,t){if(t)return r.emit("error",t);var n=r._writableState,e=r._transformState;if(n.length)throw new Error("calling transform done when ws.length != 0");if(e.transforming)throw new Error("calling transform done when still transforming");return r.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(r,t){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,r,t)},Transform.prototype._transform=function(r,t,n){throw new Error("not implemented")},Transform.prototype._write=function(r,t,n){var e=this._transformState;if(e.writecb=n,e.writechunk=r,e.writeencoding=t,!e.transforming){var a=this._readableState;(e.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},Transform.prototype._read=function(r){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0};
},{"./_stream_duplex":26,"core-util-is":6,"inherits":10}],30:[function(require,module,exports){
"use strict";function nop(){}function WriteReq(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}function WritableState(e,t){Duplex=Duplex||require("./_stream_duplex"),e=e||{},this.objectMode=!!e.objectMode,t instanceof Duplex&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var n=e.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){onwrite(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function Writable(e){return Duplex=Duplex||require("./_stream_duplex"),this instanceof Writable||this instanceof Duplex?(this._writableState=new WritableState(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),void Stream.call(this)):new Writable(e)}function writeAfterEnd(e,t){var r=new Error("write after end");e.emit("error",r),processNextTick(t,r)}function validChunk(e,t,r,i){var n=!0;if(!Buffer.isBuffer(r)&&"string"!=typeof r&&null!==r&&void 0!==r&&!t.objectMode){var f=new TypeError("Invalid non-string/buffer chunk");e.emit("error",f),processNextTick(i,f),n=!1}return n}function decodeChunk(e,t,r){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=new Buffer(t,r)),t}function writeOrBuffer(e,t,r,i,n){r=decodeChunk(t,r,i),Buffer.isBuffer(r)&&(i="buffer");var f=t.objectMode?1:r.length;t.length+=f;var o=t.length<t.highWaterMark;if(o||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest=new WriteReq(r,i,n),u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest}else doWrite(e,t,!1,f,r,i,n);return o}function doWrite(e,t,r,i,n,f,o){t.writelen=i,t.writecb=o,t.writing=!0,t.sync=!0,r?e._writev(n,t.onwrite):e._write(n,f,t.onwrite),t.sync=!1}function onwriteError(e,t,r,i,n){--t.pendingcb,r?processNextTick(n,i):n(i),e._writableState.errorEmitted=!0,e.emit("error",i)}function onwriteStateUpdate(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function onwrite(e,t){var r=e._writableState,i=r.sync,n=r.writecb;if(onwriteStateUpdate(r),t)onwriteError(e,r,i,t,n);else{var f=needFinish(r);f||r.corked||r.bufferProcessing||!r.bufferedRequest||clearBuffer(e,r),i?processNextTick(afterWrite,e,r,f,n):afterWrite(e,r,f,n)}}function afterWrite(e,t,r,i){r||onwriteDrain(e,t),t.pendingcb--,i(),finishMaybe(e,t)}function onwriteDrain(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function clearBuffer(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){for(var i=[],n=[];r;)n.push(r.callback),i.push(r),r=r.next;t.pendingcb++,t.lastBufferedRequest=null,doWrite(e,t,!0,t.length,i,"",function(e){for(var r=0;r<n.length;r++)t.pendingcb--,n[r](e)})}else{for(;r;){var f=r.chunk,o=r.encoding,u=r.callback,s=t.objectMode?1:f.length;if(doWrite(e,t,!1,s,f,o,u),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function needFinish(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function prefinish(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function finishMaybe(e,t){var r=needFinish(t);return r&&(0===t.pendingcb?(prefinish(e,t),t.finished=!0,e.emit("finish")):prefinish(e,t)),r}function endWritable(e,t,r){t.ending=!0,finishMaybe(e,t),r&&(t.finished?processNextTick(r):e.once("finish",r)),t.ended=!0}module.exports=Writable;var processNextTick=require("process-nextick-args"),Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")},Stream;!function(){try{Stream=require("stream")}catch(e){}finally{Stream||(Stream=require("events").EventEmitter)}}();var Buffer=require("buffer").Buffer;util.inherits(Writable,Stream);var Duplex;WritableState.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var Duplex;Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(e,t,r){var i=this._writableState,n=!1;return"function"==typeof t&&(r=t,t=null),Buffer.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=nop),i.ended?writeAfterEnd(this,r):validChunk(this,i,e,r)&&(i.pendingcb++,n=writeOrBuffer(this,i,e,t,r)),n},Writable.prototype.cork=function(){var e=this._writableState;e.corked++},Writable.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||clearBuffer(this,e))},Writable.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);this._writableState.defaultEncoding=e},Writable.prototype._write=function(e,t,r){r(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(e,t,r){var i=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||endWritable(this,i,r)};
},{"./_stream_duplex":26,"buffer":4,"core-util-is":6,"events":8,"inherits":10,"process-nextick-args":23,"stream":35,"util-deprecate":37}],31:[function(require,module,exports){
module.exports=require("./lib/_stream_passthrough.js");
},{"./lib/_stream_passthrough.js":27}],32:[function(require,module,exports){
var Stream=function(){try{return require("stream")}catch(r){}}();exports=module.exports=require("./lib/_stream_readable.js"),exports.Stream=Stream||exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js");
},{"./lib/_stream_duplex.js":26,"./lib/_stream_passthrough.js":27,"./lib/_stream_readable.js":28,"./lib/_stream_transform.js":29,"./lib/_stream_writable.js":30,"stream":35}],33:[function(require,module,exports){
module.exports=require("./lib/_stream_transform.js");
},{"./lib/_stream_transform.js":29}],34:[function(require,module,exports){
module.exports=require("./lib/_stream_writable.js");
},{"./lib/_stream_writable.js":30}],35:[function(require,module,exports){
function Stream(){EE.call(this)}module.exports=Stream;var EE=require("events").EventEmitter,inherits=require("inherits");inherits(Stream,EE),Stream.Readable=require("readable-stream/readable.js"),Stream.Writable=require("readable-stream/writable.js"),Stream.Duplex=require("readable-stream/duplex.js"),Stream.Transform=require("readable-stream/transform.js"),Stream.PassThrough=require("readable-stream/passthrough.js"),Stream.Stream=Stream,Stream.prototype.pipe=function(e,r){function t(r){e.writable&&!1===e.write(r)&&m.pause&&m.pause()}function n(){m.readable&&m.resume&&m.resume()}function a(){u||(u=!0,e.end())}function o(){u||(u=!0,"function"==typeof e.destroy&&e.destroy())}function i(e){if(s(),0===EE.listenerCount(this,"error"))throw e}function s(){m.removeListener("data",t),e.removeListener("drain",n),m.removeListener("end",a),m.removeListener("close",o),m.removeListener("error",i),e.removeListener("error",i),m.removeListener("end",s),m.removeListener("close",s),e.removeListener("close",s)}var m=this;m.on("data",t),e.on("drain",n),e._isStdio||r&&r.end===!1||(m.on("end",a),m.on("close",o));var u=!1;return m.on("error",i),e.on("error",i),m.on("end",s),m.on("close",s),e.on("close",s),e.emit("pipe",m),e};
},{"events":8,"inherits":10,"readable-stream/duplex.js":25,"readable-stream/passthrough.js":31,"readable-stream/readable.js":32,"readable-stream/transform.js":33,"readable-stream/writable.js":34}],36:[function(require,module,exports){
function assertEncoding(e){if(e&&!isBufferEncoding(e))throw new Error("Unknown encoding: "+e)}function passThroughWrite(e){return e.toString(this.encoding)}function utf16DetectIncompleteChar(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var Buffer=require("buffer").Buffer,isBufferEncoding=Buffer.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";e=e.slice(r,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var h=t.charCodeAt(t.length-1);if(!(h>=55296&&56319>=h)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,h=t.charCodeAt(i);if(h>=55296&&56319>=h){var c=this.surrogateSize;return this.charLength+=c,this.charReceived+=c,this.charBuffer.copy(this.charBuffer,c,0,c),e.copy(this.charBuffer,0,0,c),t.substring(0,i)}return t},StringDecoder.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(2>=t&&r>>4==14){this.charLength=3;break}if(3>=t&&r>>3==30){this.charLength=4;break}}this.charReceived=t},StringDecoder.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,h=this.charBuffer,i=this.encoding;t+=h.slice(0,r).toString(i)}return t};
},{"buffer":4}],37:[function(require,module,exports){
(function (global){
function deprecate(r,e){function o(){if(!t){if(config("throwDeprecation"))throw new Error(e);config("traceDeprecation")?console.trace(e):console.warn(e),t=!0}return r.apply(this,arguments)}if(config("noDeprecation"))return r;var t=!1;return o}function config(r){try{if(!global.localStorage)return!1}catch(e){return!1}var o=global.localStorage[r];return null==o?!1:"true"===String(o).toLowerCase()}module.exports=deprecate;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],38:[function(require,module,exports){
module.exports=function(o){return o&&"object"==typeof o&&"function"==typeof o.copy&&"function"==typeof o.fill&&"function"==typeof o.readUInt8};
},{}],39:[function(require,module,exports){
(function (process,global){
function inspect(e,r){var t={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),isBoolean(r)?t.showHidden=r:r&&exports._extend(t,r),isUndefined(t.showHidden)&&(t.showHidden=!1),isUndefined(t.depth)&&(t.depth=2),isUndefined(t.colors)&&(t.colors=!1),isUndefined(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=stylizeWithColor),formatValue(t,e,t.depth)}function stylizeWithColor(e,r){var t=inspect.styles[r];return t?"["+inspect.colors[t][0]+"m"+e+"["+inspect.colors[t][1]+"m":e}function stylizeNoColor(e,r){return e}function arrayToHash(e){var r={};return e.forEach(function(e,t){r[e]=!0}),r}function formatValue(e,r,t){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(t,e);return isString(n)||(n=formatValue(e,n,t)),n}var i=formatPrimitive(e,r);if(i)return i;var o=Object.keys(r),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),isError(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r);if(0===o.length){if(isFunction(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var c="",a=!1,l=["{","}"];if(isArray(r)&&(a=!0,l=["[","]"]),isFunction(r)){var p=r.name?": "+r.name:"";c=" [Function"+p+"]"}if(isRegExp(r)&&(c=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(c=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(c=" "+formatError(r)),0===o.length&&(!a||0==r.length))return l[0]+c+l[1];if(0>t)return isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);var f;return f=a?formatArray(e,r,t,s,o):o.map(function(n){return formatProperty(e,r,t,s,n,a)}),e.seen.pop(),reduceToSingleString(f,c,l)}function formatPrimitive(e,r){if(isUndefined(r))return e.stylize("undefined","undefined");if(isString(r)){var t="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return isNumber(r)?e.stylize(""+r,"number"):isBoolean(r)?e.stylize(""+r,"boolean"):isNull(r)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,r,t,n,i){for(var o=[],s=0,u=r.length;u>s;++s)hasOwnProperty(r,String(s))?o.push(formatProperty(e,r,t,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(e,r,t,n,i,!0))}),o}function formatProperty(e,r,t,n,i,o){var s,u,c;if(c=Object.getOwnPropertyDescriptor(r,i)||{value:r[i]},c.get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),hasOwnProperty(n,i)||(s="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=isNull(t)?formatValue(e,c.value,null):formatValue(e,c.value,t-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return u;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function reduceToSingleString(e,r,t){var n=0,i=e.reduce(function(e,r){return n++,r.indexOf("\n")>=0&&n++,e+r.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?t[0]+(""===r?"":r+"\n ")+" "+e.join(",\n  ")+" "+t[1]:t[0]+r+" "+e.join(", ")+" "+t[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return 10>e?"0"+e.toString(10):e.toString(10)}function timestamp(){var e=new Date,r=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],r].join(" ")}function hasOwnProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)}var formatRegExp=/%[sdj%]/g;exports.format=function(e){if(!isString(e)){for(var r=[],t=0;t<arguments.length;t++)r.push(inspect(arguments[t]));return r.join(" ")}for(var t=1,n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e){if("%%"===e)return"%";if(t>=i)return e;switch(e){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(r){return"[Circular]"}default:return e}}),s=n[t];i>t;s=n[++t])o+=isNull(s)||!isObject(s)?" "+s:" "+inspect(s);return o},exports.deprecate=function(e,r){function t(){if(!n){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),n=!0}return e.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(e,r).apply(this,arguments)};if(process.noDeprecation===!0)return e;var n=!1;return t};var debugs={},debugEnviron;exports.debuglog=function(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){var r=process.pid;debugs[e]=function(){var t=exports.format.apply(exports,arguments);console.error("%s %d: %s",e,r,t)}}else debugs[e]=function(){};return debugs[e]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(e,r){if(!r||!isObject(r))return e;for(var t=Object.keys(r),n=t.length;n--;)e[t[n]]=r[t[n]];return e};
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./support/isBuffer":38,"_process":24,"inherits":10}],40:[function(require,module,exports){
function DOMParser(t){this.options=t||{locator:{}}}function buildErrorHandler(t,e,n){function r(e){var r=t[e];!r&&i&&(r=2==t.length?function(n){t(e,n)}:t),o[e]=r&&function(t){r("[xmldom "+e+"]	"+t+_locator(n))}||function(){}}if(!t){if(e instanceof DOMHandler)return e;t=e}var o={},i=t instanceof Function;return n=n||{},r("warning"),r("error"),r("fatalError"),o}function DOMHandler(){this.cdata=!1}function position(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function _locator(t){return t?"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]":void 0}function _toString(t,e,n){return"string"==typeof t?t.substr(e,n):t.length>=e+n||e?new java.lang.String(t,e,n)+"":t}function appendElement(t,e){t.currentElement?t.currentElement.appendChild(e):t.document.appendChild(e)}if(DOMParser.prototype.parseFromString=function(t,e){var n=this.options,r=new XMLReader,o=n.domBuilder||new DOMHandler,i=n.errorHandler,a=n.locator,c=n.xmlns||{},l={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return a&&o.setDocumentLocator(a),r.errorHandler=buildErrorHandler(i,o,a),r.domBuilder=n.domBuilder||o,/\/x?html?$/.test(e)&&(l.nbsp=" ",l.copy="©",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",t?r.parse(t,c,l):r.errorHandler.error("invalid document source"),o.document},DOMHandler.prototype={startDocument:function(){this.document=(new DOMImplementation).createDocument(null,null,null),this.locator&&(this.document.documentURI=this.locator.systemId)},startElement:function(t,e,n,r){var o=this.document,i=o.createElementNS(t,n||e),a=r.length;appendElement(this,i),this.currentElement=i,this.locator&&position(this.locator,i);for(var c=0;a>c;c++){var t=r.getURI(c),l=r.getValue(c),n=r.getQName(c),s=o.createAttributeNS(t,n);s.getOffset&&position(s.getOffset(1),s),s.value=s.nodeValue=l,i.setAttributeNode(s)}},endElement:function(t,e,n){var r=this.currentElement;r.tagName;this.currentElement=r.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var n=this.document.createProcessingInstruction(t,e);this.locator&&position(this.locator,n),appendElement(this,n)},ignorableWhitespace:function(t,e,n){},characters:function(t,e,n){if(t=_toString.apply(this,arguments),this.currentElement&&t){if(this.cdata){var r=this.document.createCDATASection(t);this.currentElement.appendChild(r)}else{var r=this.document.createTextNode(t);this.currentElement.appendChild(r)}this.locator&&position(this.locator,r)}},skippedEntity:function(t){},endDocument:function(){this.document.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,n){t=_toString.apply(this,arguments);var r=this.document.createComment(t);this.locator&&position(this.locator,r),appendElement(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,n){var r=this.document.implementation;if(r&&r.createDocumentType){var o=r.createDocumentType(t,e,n);this.locator&&position(this.locator,o),appendElement(this,o)}},warning:function(t){console.warn("[xmldom warning]	"+t,_locator(this.locator))},error:function(t){console.error("[xmldom error]	"+t,_locator(this.locator))},fatalError:function(t){throw console.error("[xmldom fatalError]	"+t,_locator(this.locator)),t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){DOMHandler.prototype[t]=function(){return null}}),"function"==typeof require){var XMLReader=require("./sax").XMLReader,DOMImplementation=exports.DOMImplementation=require("./dom").DOMImplementation;exports.XMLSerializer=require("./dom").XMLSerializer,exports.DOMParser=DOMParser}
},{"./dom":41,"./sax":42}],41:[function(require,module,exports){
function copy(e,t){for(var n in e)t[n]=e[n]}function _extends(e,t){function n(){}var o=e.prototype;if(Object.create){var i=Object.create(t.prototype);o.__proto__=i}o instanceof t||(n.prototype=t.prototype,n=new n,copy(o,n),e.prototype=o=n),o.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),o.constructor=e)}function DOMException(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,ExceptionMessage[e]),this.message=ExceptionMessage[e],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return n.code=e,t&&(this.message=this.message+": "+t),n}function NodeList(){}function LiveNodeList(e,t){this._node=e,this._refresh=t,_updateLiveList(this)}function _updateLiveList(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var n=e._refresh(e._node);__set__(e,"length",n.length),copy(n,e),e._inc=t}}function NamedNodeMap(){}function _findNodeIndex(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function _addNamedNode(e,t,n,o){if(o?t[_findNodeIndex(t,o)]=n:t[t.length++]=n,e){n.ownerElement=e;var i=e.ownerDocument;i&&(o&&_onRemoveAttribute(i,e,o),_onAddAttribute(i,e,n))}}function _removeNamedNode(e,t,n){var o=_findNodeIndex(t,n);if(!(o>=0))throw DOMException(NOT_FOUND_ERR,new Error);for(var i=t.length-1;i>o;)t[o]=t[++o];if(t.length=i,e){var r=e.ownerDocument;r&&(_onRemoveAttribute(r,e,n),n.ownerElement=null)}}function DOMImplementation(e){if(this._features={},e)for(var t in e)this._features=e[t]}function Node(){}function _xmlEncoder(e){return"<"==e&&"&lt;"||">"==e&&"&gt;"||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function _visitNode(e,t){if(t(e))return!0;if(e=e.firstChild)do if(_visitNode(e,t))return!0;while(e=e.nextSibling)}function Document(){}function _onAddAttribute(e,t,n){e&&e._inc++;var o=n.namespaceURI;"http://www.w3.org/2000/xmlns/"==o&&(t._nsMap[n.prefix?n.localName:""]=n.value)}function _onRemoveAttribute(e,t,n,o){e&&e._inc++;var i=n.namespaceURI;"http://www.w3.org/2000/xmlns/"==i&&delete t._nsMap[n.prefix?n.localName:""]}function _onUpdateChild(e,t,n){if(e&&e._inc){e._inc++;var o=t.childNodes;if(n)o[o.length++]=n;else{for(var i=t.firstChild,r=0;i;)o[r++]=i,i=i.nextSibling;o.length=r}}}function _removeChild(e,t){var n=t.previousSibling,o=t.nextSibling;return n?n.nextSibling=o:e.firstChild=o,o?o.previousSibling=n:e.lastChild=n,_onUpdateChild(e.ownerDocument,e),t}function _insertBefore(e,t,n){var o=t.parentNode;if(o&&o.removeChild(t),t.nodeType===DOCUMENT_FRAGMENT_NODE){var i=t.firstChild;if(null==i)return t;var r=t.lastChild}else i=r=t;var a=n?n.previousSibling:e.lastChild;i.previousSibling=a,r.nextSibling=n,a?a.nextSibling=i:e.firstChild=i,null==n?e.lastChild=r:n.previousSibling=r;do i.parentNode=e;while(i!==r&&(i=i.nextSibling));return _onUpdateChild(e.ownerDocument||e,e),t.nodeType==DOCUMENT_FRAGMENT_NODE&&(t.firstChild=t.lastChild=null),t}function _appendSingleChild(e,t){var n=t.parentNode;if(n){var o=e.lastChild;n.removeChild(t);var o=e.lastChild}var o=e.lastChild;return t.parentNode=e,t.previousSibling=o,t.nextSibling=null,o?o.nextSibling=t:e.firstChild=t,e.lastChild=t,_onUpdateChild(e.ownerDocument,e,t),t}function Element(){this._nsMap={}}function Attr(){}function CharacterData(){}function Text(){}function Comment(){}function CDATASection(){}function DocumentType(){}function Notation(){}function Entity(){}function EntityReference(){}function DocumentFragment(){}function ProcessingInstruction(){}function XMLSerializer(){}function serializeToString(e,t,n,o){switch(e.nodeType){case ELEMENT_NODE:var i=e.attributes,r=i.length,a=e.firstChild,s=e.tagName;o=htmlns===e.namespaceURI||o,t.push("<",s),n&&t.sort.apply(i,n);for(var u=0;r>u;u++)serializeToString(i.item(u),t,n,o);if(a||o&&!/^(?:meta|link|img|br|hr|input|button)$/i.test(s)){if(t.push(">"),o&&/^script$/i.test(s))a&&t.push(a.data);else for(;a;)serializeToString(a,t,n,o),a=a.nextSibling;t.push("</",s,">")}else t.push("/>");return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(var a=e.firstChild;a;)serializeToString(a,t,n,o),a=a.nextSibling;return;case ATTRIBUTE_NODE:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return t.push(e.data.replace(/[<&]/g,_xmlEncoder));case CDATA_SECTION_NODE:return t.push("<![CDATA[",e.data,"]]>");case COMMENT_NODE:return t.push("<!--",e.data,"-->");case DOCUMENT_TYPE_NODE:var d=e.publicId,c=e.systemId;if(t.push("<!DOCTYPE ",e.name),d)t.push(' PUBLIC "',d),c&&"."!=c&&t.push('" "',c),t.push('">');else if(c&&"."!=c)t.push(' SYSTEM "',c,'">');else{var N=e.internalSubset;N&&t.push(" [",N,"]"),t.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return t.push("<?",e.target," ",e.data,"?>");case ENTITY_REFERENCE_NODE:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function importNode(e,t,n){var o;switch(t.nodeType){case ELEMENT_NODE:o=t.cloneNode(!1),o.ownerDocument=e;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:n=!0}if(o||(o=t.cloneNode(!1)),o.ownerDocument=e,o.parentNode=null,n)for(var i=t.firstChild;i;)o.appendChild(importNode(e,i,n)),i=i.nextSibling;return o}function cloneNode(e,t,n){var o=new t.constructor;for(var i in t){var r=t[i];"object"!=typeof r&&r!=o[i]&&(o[i]=r)}switch(t.childNodes&&(o.childNodes=new NodeList),o.ownerDocument=e,o.nodeType){case ELEMENT_NODE:var a=t.attributes,s=o.attributes=new NamedNodeMap,u=a.length;s._ownerElement=o;for(var d=0;u>d;d++)o.setAttributeNode(cloneNode(e,a.item(d),!0));break;case ATTRIBUTE_NODE:n=!0}if(n)for(var c=t.firstChild;c;)o.appendChild(cloneNode(e,c,n)),c=c.nextSibling;return o}function __set__(e,t,n){e[t]=n}function getTextContent(e){switch(e.nodeType){case 1:case 11:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(getTextContent(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}var htmlns="http://www.w3.org/1999/xhtml",NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={},INDEX_SIZE_ERR=ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1),DOMSTRING_SIZE_ERR=ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2),HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3),WRONG_DOCUMENT_ERR=ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4),INVALID_CHARACTER_ERR=ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5),NO_DATA_ALLOWED_ERR=ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6),NO_MODIFICATION_ALLOWED_ERR=ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7),NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8),NOT_SUPPORTED_ERR=ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9),INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10),INVALID_STATE_ERR=ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11),SYNTAX_ERR=ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12),INVALID_MODIFICATION_ERR=ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13),NAMESPACE_ERR=ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14),INVALID_ACCESS_ERR=ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);DOMException.prototype=Error.prototype,copy(ExceptionCode,DOMException),NodeList.prototype={length:0,item:function(e){return this[e]||null},toString:function(){for(var e=[],t=0;t<this.length;t++)serializeToString(this[t],e);return e.join("")}},LiveNodeList.prototype.item=function(e){return _updateLiveList(this),this[e]},_extends(LiveNodeList,NodeList),NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);var n=this.getNamedItem(e.nodeName);return _addNamedNode(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);return t=this.getNamedItemNS(e.namespaceURI,e.localName),_addNamedNode(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return _removeNamedNode(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return _removeNamedNode(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var o=this[n];if(o.localName==t&&o.namespaceURI==e)return o}return null}},DOMImplementation.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!(!n||t&&!(t in n))},createDocument:function(e,t,n){var o=new Document;if(o.implementation=this,o.childNodes=new NodeList,o.doctype=n,n&&o.appendChild(n),t){var i=o.createElementNS(e,t);o.appendChild(i)}return o},createDocumentType:function(e,t,n){var o=new DocumentType;return o.name=e,o.nodeName=e,o.publicId=t,o.systemId=n,o}},Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return _insertBefore(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return _removeChild(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return cloneNode(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==TEXT_NODE&&e.nodeType==TEXT_NODE?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var o in n)if(n[o]==e)return o;t=2==t.nodeType?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=2==t.nodeType?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){var t=this.lookupPrefix(e);return null==t}},copy(NodeType,Node),copy(NodeType,Node.prototype),Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==DOCUMENT_FRAGMENT_NODE){for(var n=e.firstChild;n;){var o=n.nextSibling;this.insertBefore(n,t),n=o}return e}return null==this.documentElement&&1==e.nodeType&&(this.documentElement=e),_insertBefore(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),_removeChild(this,e)},importNode:function(e,t){return importNode(this,e,t)},getElementById:function(e){var t=null;return _visitNode(this.documentElement,function(n){return 1==n.nodeType&&n.getAttribute("id")==e?(t=n,!0):void 0}),t},createElement:function(e){var t=new Element;t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new NodeList;var n=t.attributes=new NamedNodeMap;return n._ownerElement=t,t},createDocumentFragment:function(){var e=new DocumentFragment;return e.ownerDocument=this,e.childNodes=new NodeList,e},createTextNode:function(e){var t=new Text;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new Comment;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new CDATASection;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new ProcessingInstruction;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new Attr;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new EntityReference;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new Element,o=t.split(":"),i=n.attributes=new NamedNodeMap;return n.childNodes=new NodeList,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==o.length?(n.prefix=o[0],n.localName=o[1]):n.localName=t,i._ownerElement=n,n},createAttributeNS:function(e,t){var n=new Attr,o=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==o.length?(n.prefix=o[0],n.localName=o[1]):n.localName=t,n}},_extends(Document,Node),Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(e,null):_appendSingleChild(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var o=this.ownerDocument.createAttributeNS(e,t);o.value=o.nodeValue=""+n,this.setAttributeNode(o)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new LiveNodeList(this,function(t){var n=[];return _visitNode(t,function(o){o===t||o.nodeType!=ELEMENT_NODE||"*"!==e&&o.tagName!=e||n.push(o)}),n})},getElementsByTagNameNS:function(e,t){return new LiveNodeList(this,function(n){var o=[];return _visitNode(n,function(i){i===n||i.nodeType!==ELEMENT_NODE||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||o.push(i)}),o})}},Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends(Element,Node),Attr.prototype.nodeType=ATTRIBUTE_NODE,_extends(Attr,Node),CharacterData.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(ExceptionMessage[3])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){var o=this.data.substring(0,e),i=this.data.substring(e+t);n=o+n+i,this.nodeValue=this.data=n,this.length=n.length}},_extends(CharacterData,Node),Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var o=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(o,this.nextSibling),o}},_extends(Text,CharacterData),Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE},_extends(Comment,CharacterData),CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE},_extends(CDATASection,CharacterData),DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE,_extends(DocumentType,Node),Notation.prototype.nodeType=NOTATION_NODE,_extends(Notation,Node),Entity.prototype.nodeType=ENTITY_NODE,_extends(Entity,Node),EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE,_extends(EntityReference,Node),DocumentFragment.prototype.nodeName="#document-fragment",DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE,_extends(DocumentFragment,Node),ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE,_extends(ProcessingInstruction,Node),XMLSerializer.prototype.serializeToString=function(e,t){return e.toString(t)},Node.prototype.toString=function(e){var t=[];return serializeToString(this,t,e),t.join("")};try{Object.defineProperty&&(Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node.prototype,"textContent",{get:function(){return getTextContent(this)},set:function(e){switch(this.nodeType){case 1:case 11:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=value,this.nodeValue=e}}}),__set__=function(e,t,n){e["$$"+t]=n})}catch(e){}"function"==typeof require&&(exports.DOMImplementation=DOMImplementation,exports.XMLSerializer=XMLSerializer);
},{}],42:[function(require,module,exports){
function XMLReader(){}function parse(e,t,r,a,n){function s(e){if(e>65535){e-=65536;var t=55296+(e>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}function i(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?s(parseInt(t.substr(1).replace("x","0x"))):(n.error("entity not found:"+e),e)}function c(t){if(t>S){var r=e.substring(S,t).replace(/&#?\w+;/g,i);m&&u(S),a.characters(r,0,t-S),S=t}}function u(t,r){for(;t>=l&&(r=f.exec(e));)o=r.index,l=o+r[0].length,m.lineNumber++;m.columnNumber=t-o+1}for(var o=0,l=0,f=/.+(?:\r\n?|\n)|.*$/g,m=a.locator,p=[{currentNSMap:t}],d={},S=0;;){try{var _=e.indexOf("<",S);if(0>_){if(!e.substr(S).match(/^\s*$/)){var h=a.document,g=h.createTextNode(e.substr(S));h.appendChild(g),a.currentElement=g}return}switch(_>S&&c(_),e.charAt(_+1)){case"/":var w=e.indexOf(">",_+3),b=e.substring(_+2,w),v=p.pop(),x=v.localNSMap;if(v.tagName!=b&&n.fatalError("end tag name: "+b+" is not match the current start tagName:"+v.tagName),a.endElement(v.uri,v.localName,b),x)for(var T in x)a.endPrefixMapping(T);w++;break;case"?":m&&u(_),w=parseInstruction(e,_,a);break;case"!":m&&u(_),w=parseDCC(e,_,a,n);break;default:m&&u(_);var N=new ElementAttributes,w=parseElementStartPart(e,_,N,i,n),E=N.length;if(m){if(E)for(var A=0;E>A;A++){var C=N[A];u(C.offset),C.offset=copyLocator(m,{})}u(w)}!N.closed&&fixSelfClosed(e,w,N.tagName,d)&&(N.closed=!0,r.nbsp||n.warning("unclosed xml attribute")),appendElement(N,a,p),"http://www.w3.org/1999/xhtml"!==N.uri||N.closed?w++:w=parseHtmlSpecialContent(e,w,N.tagName,i,a)}}catch(F){n.error("element parse error: "+F),w=-1}w>S?S=w:c(Math.max(_,S)+1)}}function copyLocator(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function parseElementStartPart(e,t,r,a,n){for(var s,i,c=++t,u=S_TAG;;){var o=e.charAt(c);switch(o){case"=":if(u===S_ATTR)s=e.slice(t,c),u=S_EQ;else{if(u!==S_ATTR_S)throw new Error("attribute equal must after attrName");u=S_EQ}break;case"'":case'"':if(u===S_EQ){if(t=c+1,c=e.indexOf(o,t),!(c>0))throw new Error("attribute value no end '"+o+"' match");i=e.slice(t,c).replace(/&#?\w+;/g,a),r.add(s,i,t-1),u=S_E}else{if(u!=S_V)throw new Error('attribute value must after "="');i=e.slice(t,c).replace(/&#?\w+;/g,a),r.add(s,i,t),n.warning('attribute "'+s+'" missed start quot('+o+")!!"),t=c+1,u=S_E}break;case"/":switch(u){case S_TAG:r.setTagName(e.slice(t,c));case S_E:case S_S:case S_C:u=S_C,r.closed=!0;case S_V:case S_ATTR:case S_ATTR_S:break;default:throw new Error("attribute invalid close char('/')")}break;case"":n.error("unexpected end of input");case">":switch(u){case S_TAG:r.setTagName(e.slice(t,c));case S_E:case S_S:case S_C:break;case S_V:case S_ATTR:i=e.slice(t,c),"/"===i.slice(-1)&&(r.closed=!0,i=i.slice(0,-1));case S_ATTR_S:u===S_ATTR_S&&(i=s),u==S_V?(n.warning('attribute "'+i+'" missed quot(")!!'),r.add(s,i.replace(/&#?\w+;/g,a),t)):(n.warning('attribute "'+i+'" missed value!! "'+i+'" instead!!'),r.add(i,i,t));break;case S_EQ:throw new Error("attribute value missed!!")}return c;case"":o=" ";default:if(" ">=o)switch(u){case S_TAG:r.setTagName(e.slice(t,c)),u=S_S;break;case S_ATTR:s=e.slice(t,c),u=S_ATTR_S;break;case S_V:var i=e.slice(t,c).replace(/&#?\w+;/g,a);n.warning('attribute "'+i+'" missed quot(")!!'),r.add(s,i,t);case S_E:u=S_S}else switch(u){case S_ATTR_S:n.warning('attribute "'+s+'" missed value!! "'+s+'" instead!!'),r.add(s,s,t),t=c,u=S_ATTR;break;case S_E:n.warning('attribute space is required"'+s+'"!!');case S_S:u=S_ATTR,t=c;break;case S_EQ:u=S_V,t=c;break;case S_C:throw new Error("elements closed character '/' and '>' must be connected to")}}c++}}function appendElement(e,t,r){for(var a=e.tagName,n=null,s=r[r.length-1].currentNSMap,i=e.length;i--;){var c=e[i],u=c.qName,o=c.value,l=u.indexOf(":");if(l>0)var f=c.prefix=u.slice(0,l),m=u.slice(l+1),p="xmlns"===f&&m;else m=u,f=null,p="xmlns"===u&&"";c.localName=m,p!==!1&&(null==n&&(n={},_copy(s,s={})),s[p]=n[p]=o,c.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(p,o))}for(var i=e.length;i--;){c=e[i];var f=c.prefix;f&&("xml"===f&&(c.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==f&&(c.uri=s[f]))}var l=a.indexOf(":");l>0?(f=e.prefix=a.slice(0,l),m=e.localName=a.slice(l+1)):(f=null,m=e.localName=a);var d=e.uri=s[f||""];if(t.startElement(d,m,a,e),e.closed){if(t.endElement(d,m,a),n)for(f in n)t.endPrefixMapping(f)}else e.currentNSMap=s,e.localNSMap=n,r.push(e)}function parseHtmlSpecialContent(e,t,r,a,n){if(/^(?:script|textarea)$/i.test(r)){var s=e.indexOf("</"+r+">",t),i=e.substring(t+1,s);if(/[&<]/.test(i))return/^script$/i.test(r)?(n.characters(i,0,i.length),s):(i=i.replace(/&#?\w+;/g,a),n.characters(i,0,i.length),s)}return t+1}function fixSelfClosed(e,t,r,a){var n=a[r];return null==n&&(n=a[r]=e.lastIndexOf("</"+r+">")),t>n}function _copy(e,t){for(var r in e)t[r]=e[r]}function parseDCC(e,t,r,a){var n=e.charAt(t+2);switch(n){case"-":if("-"===e.charAt(t+3)){var s=e.indexOf("-->",t+4);return s>t?(r.comment(e,t+4,s-t-4),s+3):(a.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==e.substr(t+3,6)){var s=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,s-t-9),r.endCDATA(),s+3}var i=split(e,t),c=i.length;if(c>1&&/!doctype/i.test(i[0][0])){var u=i[1][0],o=c>3&&/^public$/i.test(i[2][0])&&i[3][0],l=c>4&&i[4][0],f=i[c-1];return r.startDTD(u,o&&o.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),f.index+f[0].length}}return-1}function parseInstruction(e,t,r){var a=e.indexOf("?>",t);if(a){var n=e.substring(t,a).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(n){n[0].length;return r.processingInstruction(n[1],n[2]),a+2}return-1}return-1}function ElementAttributes(e){}function _set_proto_(e,t){return e.__proto__=t,e}function split(e,t){var r,a=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=t,n.exec(e);r=n.exec(e);)if(a.push(r),r[1])return a}var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"·̀-ͯ\\u203F-⁀]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_S=2,S_EQ=3,S_V=4,S_E=5,S_S=6,S_C=7;XMLReader.prototype={parse:function(e,t,r){var a=this.domBuilder;a.startDocument(),_copy(t,t={}),parse(e,t,r,a,this.errorHandler),a.endDocument()}},ElementAttributes.prototype={setTagName:function(e){if(!tagNamePattern.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,r){if(!tagNamePattern.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:r}},length:0,getLocalName:function(e){return this[e].localName},getOffset:function(e){return this[e].offset},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},_set_proto_({},_set_proto_.prototype)instanceof _set_proto_||(_set_proto_=function(e,t){function r(){}r.prototype=t,r=new r;for(t in e)r[t]=e[t];return r}),"function"==typeof require&&(exports.XMLReader=XMLReader);
},{}],"rdflib":[function(require,module,exports){
!function(e,t){if("undefined"!=typeof tabulator&&tabulator.isExtension&&(tabulator.isExtension=!1),"undefined"!=typeof r)throw new Error("Internal error: RDF libray has already been loaded: $rdf already exists");var r={};if(void 0!==r.log)throw new Error("Internal Error: $rdf.log already defined,  util.js: "+r.log);r.log={debug:function(e){},warn:function(e){},info:function(e){},error:function(e){},success:function(e){},msg:function(e){}},r.Util={output:function(e){var t=document.createElement("div");t.textContent=e,document.body.appendChild(t)},callbackify:function(e,t){e.callbacks={};for(var r=t.length-1;r>=0;r--)e.callbacks[t[r]]=[];e.addHook=function(t){e.callbacks[t]||(e.callbacks[t]=[])},e.addCallback=function(t,r){e.callbacks[t].push(r)},e.removeCallback=function(t,r){for(var n=0;n<e.callbacks[t].length;n++)if(e.callbacks[t][n].name===r)return e.callbacks[t].splice(n,1),!0;return!1},e.insertCallback=function(t,r){e.callbacks[t].unshift(r)},e.fireCallbacks=function(t,r){var n,i=[],o=[],s=e.callbacks[t].length;for(n=s-1;n>=0;n--)e.callbacks[t][n].apply(e,r)&&i.push(e.callbacks[t][n]);for(n=i.length-1;n>=0;n--)o.push(i[n]);for(n=s;n<e.callbacks[t].length;n++)o.push(e.callbacks[t][n]);e.callbacks[t]=o}},XMLHTTPFactory:function(){var e;if("undefined"!=typeof tabulator&&tabulator.isExtension)return Components.classes["@mozilla.org/xmlextras/xmlhttprequest;1"].createInstance().QueryInterface(Components.interfaces.nsIXMLHttpRequest);if("undefined"!=typeof window&&"XMLHttpRequest"in window)return new(e=window.XMLHttpRequest);if("undefined"!=typeof module&&module&&module.exports)return new(e=require("xmlhttprequest").XMLHttpRequest);if(!window.ActiveXObject)return!1;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){return new ActiveXObject("Microsoft.XMLHTTP")}},DOMParserFactory:function(){return tabulator&&tabulator.isExtension?Components.classes["@mozilla.org/xmlextras/domparser;1"].getService(Components.interfaces.nsIDOMParser):window.DOMParser?new DOMParser:window.ActiveXObject?new ActiveXObject("Microsoft.XMLDOM"):!1},getHTTPHeaders:function(e){for(var t,r=e.getAllResponseHeaders().split("\n"),n={},i=0;i<r.length;i++)if(r[i].length>0){var o=r[i].split(": ");"undefined"==typeof o[1]?n[t]+="\n"+o[0]:(t=o[0].toLowerCase(),n[t]=o[1])}return n},dtstamp:function(){var e=new Date,t=e.getYear()+1900,r=e.getMonth()+1,n=e.getDate(),i=e.getUTCHours(),o=e.getUTCMinutes(),s=e.getSeconds();return 10>r&&(r="0"+r),10>n&&(n="0"+n),10>i&&(i="0"+i),10>o&&(o="0"+o),10>s&&(s="0"+s),t+"-"+r+"-"+n+"T"+i+":"+o+":"+s+"Z"},enablePrivilege:"undefined"!=typeof netscape&&"undefined"!=typeof netscape.security.PrivilegeManager&&netscape.security.PrivilegeManager.enablePrivilege||function(){},disablePrivilege:"undefined"!=typeof netscape&&"undefined"!=typeof netscape.security.PrivilegeManager&&netscape.security.PrivilegeManager.disablePrivilege||function(){},RDFArrayRemove:function(e,t){for(var r=0;r<e.length;r++)if(e[r].subject.sameTerm(t.subject)&&e[r].predicate.sameTerm(t.predicate)&&e[r].object.sameTerm(t.object)&&e[r].why.sameTerm(t.why))return void e.splice(r,1);throw new Error("RDFArrayRemove: Array did not contain "+t+" "+t.why)},string_startswith:function(e,t){return e.slice(0,t.length)===t},AJAR_handleNewTerm:function(e,t,n){var i=null;if("undefined"!=typeof e.fetcher&&(i=e.fetcher,"symbol"===t.termType)){var o,s=r.Util.uri.docpart(t.uri);if(t.uri.indexOf("#")<0){if(r.Util.string_startswith(t.uri,"http://dbpedia.org/resource/Category:"))return;r.Util.string_startswith(t.uri,"http://purl.org/dc/elements/1.1/")||r.Util.string_startswith(t.uri,"http://purl.org/dc/terms/")?o="http://dublincore.org/2005/06/13/dcq":r.Util.string_startswith(t.uri,"http://xmlns.com/wot/0.1/")?o="http://xmlns.com/wot/0.1/index.rdf":r.Util.string_startswith(t.uri,"http://web.resource.org/cc/")&&(o="http://web.resource.org/cc/schema.rdf")}o&&(s=o),i&&"unrequested"!==i.getState(s)||(o&&r.log.warn("Assuming server still broken, faking redirect of <"+t.uri+"> to <"+s+">"),i.requestURI(s,n))}},ArrayIndexOf:function(e,t,r){r||(r=0);var n=e.length;for(0>r&&(r=n+r);n>r;r++)if(e[r]===t)return r;return-1}},r.Util.variablesIn=function(e){for(var t=0;t<e.statements.length;t++){var n=e.statatements[t],i={};n.subject instanceof r.Variable&&(i[n.subject.toNT()]=!0),n.predicate instanceof r.Variable&&(i[n.predicate.toNT()]=!0),n.object instanceof r.Variable&&(i[n.object.toNT()]=!0)}return i},r.Util.heavyCompare=function(e,t,r){var n=function(e){return"bnode"===e.termType?null:e},i=function(t){var i=r.statementsMatching(e).map(function(e){return""+n(e.subject)+" "+n(e.predicate)+" "+n(e.object)}).concat(r.statementsMatching(void 0,void 0,e).map(function(e){return""+n(e.subject)+" "+n(e.predicate)+" "+n(e.object)}));return i.sort(),i.join("\n")};return"bnode"===e.termType||"bnode"===t.termType?0===e.compareTerm(t)?0:i(e)>i(t)?1:i(e)<i(t)?-1:e.compareTerm(t):e.compareTerm(t)},r.Util.heavyCompareSPO=function(e,t,n){var i=r.Util.heavyCompare,o=i(e.subject,t.subject,n);return o?o:(o=i(e.predicate,t.predicate,n),o?o:i(e.object,t.object,n))},r.Util.parseXML=function(e,t){var r;if(t=t||{},"undefined"!=typeof tabulator&&tabulator.isExtension)r=Components.classes["@mozilla.org/xmlextras/domparser;1"].getService(Components.interfaces.nsIDOMParser);else{if("undefined"!=typeof module&&module&&module.exports){var n=require("xmldom").DOMParser,i=(new n).parseFromString(e,t.contentType||"text/html");return i}r="undefined"!=typeof window&&window.DOMParser?new window.DOMParser:new n}return r.parseFromString(e,"application/xml")},r.Util.string={template:function(e,t){for(var r=e.split("%s"),n="",i=0;i<t.length;i++)t[i]+="",n+=r[i]+t[i];return n+r.slice(t.length).join()}};var r,n,o,a,l,h={}.hasOwnProperty;if("undefined"!=typeof r&&null!==r||(r={}),null==r.Util&&(r.Util={}),r.uri=function(){function e(){}return e.join=function(e,t){var r,n,i,o,s,a,l;if(n=t.indexOf("#"),n>0&&(t=t.slice(0,n)),0===e.length)return t;if(0===e.indexOf("#"))return t+e;if(s=e.indexOf(":"),s>=0)return e;if(r=t.indexOf(":"),0===t.length)return e;if(0>r)return alert("Invalid base: "+t+" in join with given: "+e),e;if(i=t.slice(0,+r+1||9e9),0===e.indexOf("//"))return i+e;if(t.indexOf("//",r)===r+1){if(o=t.indexOf("/",r+3),0>o)return t.length-r-3>0?t+"/"+e:i+e}else if(o=t.indexOf("/",r+1),0>o)return t.length-r-1>0?t+"/"+e:i+e;if(0===e.indexOf("/"))return t.slice(0,o)+e;if(l=t.slice(o),a=l.lastIndexOf("/"),0>a)return i+e;for(a>=0&&a<l.length-1&&(l=l.slice(0,+a+1||9e9)),l+=e;l.match(/[^\/]*\/\.\.\//);)l=l.replace(/[^\/]*\/\.\.\//,"");return l=l.replace(/\.\//g,""),l=l.replace(/\/\.$/,"/"),t.slice(0,o)+l},e.commonHost=new RegExp("^[-_a-zA-Z0-9.]+:(//[^/]*)?/[^/]*$"),e.hostpart=function(e){var t;return t=/[^\/]*\/\/([^\/]*)\//.exec(e),t?t[1]:""},e.refTo=function(e,t){var n,i,o,s,a,l,h,c,u,d,p,f,m;if(!e)return t;if(e===t)return"";for(i=c=0,a=t.length;a>c&&(n=t[i],n===e[i]);i=++c);if(e.slice(0,i).match(r.Util.uri.commonHost)&&(o=t.indexOf("//"),0>o&&(o=-2),s=t.indexOf("/",o+2),"/"!==t[s+1]&&"/"!==e[s+1]&&t.slice(0,s)===e.slice(0,s)))return t.slice(s);if("#"===t[i]&&e.length===i)return t.slice(i);for(;i>0&&"/"!==t[i-1];)i--;if(3>i)return t;if(e.indexOf("//",i-2)>0||t.indexOf("//",i-2)>0)return t;if(e.indexOf(":",i)>0)return t;for(h=0,p=e.slice(i),u=0,l=p.length;l>u;u++)n=p[u],"/"===n&&h++;if(0===h&&i<t.length&&"#"===t[i])return"./"+t.slice(i);if(0===h&&i===t.length)return"./";if(m="",h>0)for(j=d=1,f=h;f>=1?f>=d:d>=f;j=f>=1?++d:--d)m+="../";return m+t.slice(i)},e.docpart=function(e){var t;return t=e.indexOf("#"),0>t?e:e.slice(0,t)},e.document=function(t){return r.sym(e.docpart(t.uri))},e.protocol=function(e){var t;return t=e.indexOf(":"),0>t?null:e.slice(0,t)},e}(),r.Util.uri=r.uri,null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)){null==(n=module.exports).Util&&(n.Util={}),a=r.Util;for(o in a)h.call(a,o)&&(l=a[o],module.exports.Util[o]=l);module.exports.uri=r.uri}var r,o,l,c=function(e,t){function r(){this.constructor=e}for(var n in t)h.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},h={}.hasOwnProperty,u=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};if("undefined"!=typeof r&&null!==r||(r={}),r.Node=function(){function e(){}return e.prototype.substitute=function(e){return this},e}(),r.Empty=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return c(t,e),t.prototype.termType="empty",t.prototype.toString=function(){return"()"},t.prototype.toNT=t.prototype.toString,t}(r.Node),r.NamedNode=function(e){function t(e){this.uri=e}return c(t,e),t.prototype.termType="symbol",t.prototype.toString=function(){return"<"+this.uri+">"},t.prototype.toNT=t.prototype.toString,t.prototype.doc=function(){return this.uri.indexOf("#")<0?this:new r.NamedNode(this.uri.split("#")[0])},t.prototype.dir=function(){var e=this.uri.split("#")[0],t=e.slice(0,-1).lastIndexOf("/"),n=e.indexOf("//");return n>=0&&n+2>t||0>t?null:new r.NamedNode(e.slice(0,t+1))},t.prototype.sameTerm=function(e){return e?this.termType===e.termType&&this.uri===e.uri:!1},t.prototype.compareTerm=function(e){return this.classOrder<e.classOrder?-1:this.classOrder>e.classOrder?1:this.uri<e.uri?-1:this.uri>e.uri?1:0},t.prototype.XSDboolean=new t("http://www.w3.org/2001/XMLSchema#boolean"),t.prototype.XSDdecimal=new t("http://www.w3.org/2001/XMLSchema#decimal"),t.prototype.XSDfloat=new t("http://www.w3.org/2001/XMLSchema#float"),t.prototype.XSDinteger=new t("http://www.w3.org/2001/XMLSchema#integer"),t.prototype.XSDdateTime=new t("http://www.w3.org/2001/XMLSchema#dateTime"),t.prototype.integer=new t("http://www.w3.org/2001/XMLSchema#integer"),t}(r.Node),null!=r.NextId?r.log.error("Attempt to re-zero existing blank node id counter at "+r.NextId):r.NextId=0,r.NTAnonymousNodePrefix="_:n",r.BlankNode=function(e){function t(e){this.id=r.NextId++,this.value=e||this.id.toString()}return c(t,e),t.prototype.termType="bnode",t.prototype.toNT=function(){return r.NTAnonymousNodePrefix+this.id},t.prototype.toString=t.prototype.toNT,t.prototype.sameTerm=function(e){return e?this.termType===e.termType&&this.id===e.id:!1},t.prototype.compareTerm=function(e){return this.classOrder<e.classOrder?-1:this.classOrder>e.classOrder?1:this.id<e.id?-1:this.id>e.id?1:0},t}(r.Node),r.Literal=function(e){function t(e,t,r){this.value=e,this.lang=t,this.datatype=r,this.lang||(this.lang=void 0),this.datatype||(this.datatype=void 0)}return c(t,e),t.prototype.termType="literal",t.prototype.toString=function(){return""+this.value},t.prototype.toNT=function(){var e;if(e=this.value,typeof e===!1){if("number"==typeof e)return""+e;throw Error("Value of RDF literal is not string: "+e)}return e=e.replace(/\\/g,"\\\\"),e=e.replace(/\"/g,'\\"'),e=e.replace(/\n/g,"\\n"),e='"'+e+'"',this.datatype&&(e+="^^"+this.datatype.toNT()),this.lang&&(e+="@"+this.lang),e},t.prototype.sameTerm=function(e){return e?this.termType===e.termType&&this.value===e.value&&this.lang===e.lang&&(!this.datatype&&!e.datatype||this.datatype&&this.datatype.sameTerm(e.datatype)):!1},t.prototype.compareTerm=function(e){return this.classOrder<e.classOrder?-1:this.classOrder>e.classOrder?1:this.value<e.value?-1:this.value>e.value?1:0},t}(r.Node),r.Collection=function(e){function t(e){var t,n,i;if(this.id=r.NextId++,this.elements=[],this.closed=!1,"undefined"!=typeof e)for(t=0,n=e.length;n>t;t++)i=e[t],this.elements.push(r.term(i))}return c(t,e),t.prototype.termType="collection",t.prototype.toNT=function(){return r.NTAnonymousNodePrefix+this.id},t.prototype.toString=function(){return"("+this.elements.join(" ")+")"},t.prototype.substitute=function(e){var t;return new r.Collection(function(){var r,n,i,o;for(i=this.elements,o=[],r=0,n=i.length;n>r;r++)t=i[r],o.push(t.substitute(e));return o}).call(this)},t.prototype.append=function(e){return this.elements.push(e)},t.prototype.unshift=function(e){return this.elements.unshift(e)},t.prototype.shift=function(){return this.elements.shift()},t.prototype.close=function(){return this.closed=!0,this.closed},t}(r.Node),r.Collection.prototype.sameTerm=r.BlankNode.prototype.sameTerm,r.Collection.prototype.compareTerm=r.BlankNode.prototype.compareTerm,r.term=function(e){var t,n,i,o,s,a,l;switch(typeof e){case"object":if(e instanceof Date)return t=function(e){return(""+(100+e)).slice(1,3)},a=""+e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z",new r.Literal(a,void 0,r.NamedNode.prototype.XSDdateTime);if(e instanceof Array){for(l=new r.Collection,o=0,s=e.length;s>o;o++)i=e[o],l.append(r.term(i));return l}return e;case"string":return new r.Literal(e);case"number":return n=(""+e).indexOf("e")>=0?r.NamedNode.prototype.XSDfloat:(""+e).indexOf(".")>=0?r.NamedNode.prototype.XSDdecimal:r.NamedNode.prototype.XSDinteger,new r.Literal(""+e,void 0,n);case"boolean":return new r.Literal(e?"1":"0",void 0,r.NamedNode.prototype.XSDboolean);case"undefined":return}throw new Error("Can't make term from "+e+" of type "+typeof e)},r.Statement=function(){function e(e,t,n,i){this.subject=r.term(e),this.predicate=r.term(t),this.object=r.term(n),null!=i&&(this.why=i)}return e.prototype.toNT=function(){return[this.subject.toNT(),this.predicate.toNT(),this.object.toNT()].join(" ")+" ."},e.prototype.toString=e.prototype.toNT,e.prototype.substitute=function(e){return new r.Statement(this.subject.substitute(e),this.predicate.substitute(e),this.object.substitute(e),this.why)},e}(),r.st=function(e,t,n,i){return new r.Statement(e,t,n,i)},r.Formula=function(e){function t(){this.statements=[],this.constraints=[],this.initBindings=[],this.optional=[]}return c(t,e),t.prototype.termType="formula",t.prototype.toNT=function(){return"{"+this.statements.join("\n")+"}"},t.prototype.toString=t.prototype.toNT,t.prototype.add=function(e,t,n,i){return this.statements.push(new r.Statement(e,t,n,i))},t.prototype.addStatement=function(e){return this.statements.push(e)},t.prototype.substitute=function(e){var t,n,i,o,s;for(t=new r.Formula,o=this.statements,n=0,i=o.length;i>n;n++)s=o[n],t.addStatement(s.substitute(e));return t},t.prototype.sym=function(e,t){if(t)throw new Error("This feature (kb.sym with 2 args) is removed. Do not assume prefix mappings.");return new r.NamedNode(e)},t.prototype.literal=function(e,t,n){return new r.Literal(""+e,t,n)},t.prototype.bnode=function(e){return new r.BlankNode(e)},t.prototype.formula=function(){return new r.Formula},t.prototype.collection=function(){return new r.Collection},t.prototype.list=function(e){var t,n,i,o;if(o=new r.Collection,e)for(n=0,i=e.length;i>n;n++)t=e[n],o.append(t);return o},t.prototype.variable=function(e){return new r.Variable(e)},t.prototype.ns=function(e){return function(t){return new r.NamedNode(e+(null!=t?t:""))}},t.prototype.fromNT=function(e){var t,n,i,o;switch(e[0]){case"<":return r.sym(e.slice(1,-1));case'"':if(i=void 0,t=void 0,n=e.lastIndexOf('"'),n<e.length-1)if("@"===e[n+1])i=e.slice(n+2);else{if("^^"!==e.slice(n+1,n+3))throw new Error("Can't convert string from NT: "+e);t=r.fromNT(e.slice(n+3))}return e=e.slice(1,n),e=e.replace(/\\"/g,'"'),e=e.replace(/\\n/g,"\n"),e=e.replace(/\\\\/g,"\\"),r.lit(e,i,t);case"_":return o=new r.BlankNode,o.id=parseInt(e.slice(3),10),r.NextId--,o;case"?":return new r.Variable(e.slice(1))}throw new Error("Can't convert from NT: "+e)},t.prototype.sameTerm=function(e){return e?this.hashString()===e.hashString():!1},t.prototype.each=function(e,t,r,n){var i,o,s,a,l,h,c,u,d,p,f;if(p=[],f=this.statementsMatching(e,t,r,n,!1),null==e)for(o=0,a=f.length;a>o;o++)i=f[o],p.push(i.subject);else if(null==t)for(s=0,l=f.length;l>s;s++)i=f[s],p.push(i.predicate);else if(null==r)for(u=0,h=f.length;h>u;u++)i=f[u],p.push(i.object);else if(null==n)for(d=0,c=f.length;c>d;d++)i=f[d],p.push(i.why);return p},t.prototype.any=function(e,t,r,n){var i;return i=this.anyStatementMatching(e,t,r,n),null!=i?null==e?i.subject:null==t?i.predicate:null==r?i.object:void 0:void 0},t.prototype.holds=function(e,t,r,n){var i;return i=this.anyStatementMatching(e,t,r,n),null!=i},t.prototype.holdsStatement=function(e){return this.holds(e.subject,e.predicate,e.object,e.why)},t.prototype.the=function(e,t,n,i){var o;return o=this.any(e,t,n,i),null==o&&r.log.error("No value found for the() {"+e+" "+t+" "+n+"}."),o},t.prototype.whether=function(e,t,r,n){return this.statementsMatching(e,t,r,n,!1).length},t.prototype.transitiveClosure=function(e,t,r){var n,i,o,s,a,l,c,u,d,p;i={},n={};for(a in e)h.call(e,a)&&(p=e[a],n[a]=p);for(;;){if(d=function(){var e;for(e in n)if(h.call(n,e))return e}(),null==d)return i;for(u=r?this.each(void 0,t,this.fromNT(d)):this.each(this.fromNT(d),t),s=0,l=u.length;l>s;s++)o=u[s],c=o.toNT(),c in i||c in n||(n[c]=n[d]);i[d]=n[d],delete n[d]}},t.prototype.findMembersNT=function(e){var t,r,n,i,o,s,a,l,c,u,d,p,f,m,g,v,y,w,b,T,x;w={},w[e.toNT()]=!0,c={},p=this.transitiveClosure(w,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0);for(T in p)if(h.call(p,T)){for(f=this.statementsMatching(void 0,this.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),this.fromNT(T)),t=0,n=f.length;n>t;t++)b=f[t],c[b.subject.toNT()]=b;for(m=this.each(void 0,this.sym("http://www.w3.org/2000/01/rdf-schema#domain"),this.fromNT(T)),r=0,i=m.length;i>r;r++)for(u=m[r],g=this.statementsMatching(void 0,u),l=0,o=g.length;o>l;l++)b=g[l],c[b.subject.toNT()]=b;for(v=this.each(void 0,this.sym("http://www.w3.org/2000/01/rdf-schema#range"),this.fromNT(T)),d=0,s=v.length;s>d;d++)for(u=v[d],y=this.statementsMatching(void 0,u),x=0,a=y.length;a>x;x++)b=y[x],c[b.object.toNT()]=b}return c},t.prototype.NTtoURI=function(e){var t,r,n;r={};for(t in e)h.call(e,t)&&(n=e[t],"<"===t[0]&&(r[t.slice(1,-1)]=n));return r},t.prototype.findTypeURIs=function(e){return this.NTtoURI(this.findTypesNT(e))},t.prototype.findMemberURIs=function(e){return this.NTtoURI(this.findMembersNT(e))},t.prototype.findTypesNT=function(e){var t,r,n,i,o,s,a,l,h,c,u,d,p,f,m,g,v;for(u="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",v=[],d=this.statementsMatching(e,void 0,void 0),r=0,i=d.length;i>r;r++)if(g=d[r],g.predicate.uri===u)v[g.object.toNT()]=g;else for(p=this.each(g.predicate,this.sym("http://www.w3.org/2000/01/rdf-schema#domain")),n=0,o=p.length;o>n;n++)c=p[n],v[c.toNT()]=g;for(f=this.statementsMatching(void 0,void 0,e),l=0,s=f.length;s>l;l++)for(g=f[l],m=this.each(g.predicate,this.sym("http://www.w3.org/2000/01/rdf-schema#range")),h=0,a=m.length;a>h;h++)t=m[h],v[t.toNT()]=g;return this.transitiveClosure(v,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!1)},t.prototype.findSuperClassesNT=function(e){var t;return t=[],t[e.toNT()]=!0,this.transitiveClosure(t,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!1)},t.prototype.findSubClassesNT=function(e){var t;return t=[],t[e.toNT()]=!0,this.transitiveClosure(t,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0)},t.prototype.topTypeURIs=function(e){var t,r,n,i,o,s,a,l;a=[];for(n in e)if(h.call(e,n)){for(l=e[n],o=0,s=this.each(this.sym(n),this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf")),t=0,i=s.length;i>t;t++)if(r=s[t],"http://www.w3.org/2000/01/rdf-schema#Resource"!==r.uri){o++;break}o||(a[n]=l)}return a["http://www.w3.org/2000/01/rdf-schema#Resource"]&&delete a["http://www.w3.org/2000/01/rdf-schema#Resource"],a["http://www.w3.org/2002/07/owl#Thing"]&&delete a["http://www.w3.org/2002/07/owl#Thing"],a},t.prototype.bottomTypeURIs=function(e){var t,r,n,i,o,s,a,l,c;t=[];for(o in e)if(h.call(e,o)){for(c=e[o],l=this.each(void 0,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),this.sym(o)),r=!0,i=0,s=l.length;s>i;i++)if(n=l[i],a=n.uri,u.call(e,a)>=0){r=!1;break}r&&(t[o]=c)}return t},t.prototype.serialize=function(e,t,n){var i,o,s;switch(s=r.Serializer(this),s.suggestNamespaces(this.namespaces),s.setBase(e),o=n?this.statementsMatching(void 0,void 0,void 0,n):this.statements,null!=t?t:"text/n3"){case"application/rdf+xml":i=s.statementsToXML(o);break;case"text/n3":case"text/turtle":i=s.statementsToN3(o);break;default:throw new Error("serialize: Content-type "+t(NaN))}return i},t}(r.Node),r.sym=function(e){return new r.NamedNode(e)},r.lit=r.Formula.prototype.literal,r.Namespace=r.Formula.prototype.ns,r.variable=r.Formula.prototype.variable,r.Variable=function(e){function t(e){this.base="varid:",this.uri=r.Util.uri.join(e,this.base)}return c(t,e),t.prototype.termType="variable",t.prototype.toNT=function(){return this.uri.slice(0,this.base.length)===this.base?"?"+this.uri.slice(this.base.length):"?"+this.uri},t.prototype.toString=t.prototype.toNT,t.prototype.hashString=t.prototype.toNT,t.prototype.substitute=function(e){var t;return null!=(t=e[this.toNT()])?t:this},t.prototype.sameTerm=function(e){return this.termType===e.termType&&this.uri===e.uri},t}(r.Node),r.Literal.prototype.classOrder=1,r.Collection.prototype.classOrder=3,r.Formula.prototype.classOrder=4,r.NamedNode.prototype.classOrder=5,r.BlankNode.prototype.classOrder=6,r.Variable.prototype.classOrder=7,r.fromNT=r.Formula.prototype.fromNT,r.graph=function(){return new r.IndexedFormula},null!=("undefined"!=typeof module&&null!==module?module.exports:void 0))for(o in r)h.call(r,o)&&(l=r[o],module.exports[o]=l);if(r.RDFParser=function(e){var t={};t.ns={RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFS:"http://www.w3.org/2000/01/rdf-schema#"},t.nodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},this.frameFactory=function(e,n,i){return{NODE:1,ARC:2,parent:n,parser:e,store:e.store,element:i,lastChild:0,base:null,lang:null,node:null,nodeType:null,listIndex:1,rdfid:null,datatype:null,collection:!1,terminateFrame:function(){this.collection&&this.node.close()},addSymbol:function(e,t){t=r.Util.uri.join(t,this.base),this.node=this.store.sym(t),this.nodeType=e},loadTriple:function(){if(this.parent.parent.collection?this.parent.parent.node.append(this.node):this.store.add(this.parent.parent.node,this.parent.node,this.node,this.parser.why),null!=this.parent.rdfid){var e=this.store.sym(r.Util.uri.join("#"+this.parent.rdfid,this.base));this.store.add(e,this.store.sym(t.ns.RDF+"type"),this.store.sym(t.ns.RDF+"Statement"),this.parser.why),this.store.add(e,this.store.sym(t.ns.RDF+"subject"),this.parent.parent.node,this.parser.why),this.store.add(e,this.store.sym(t.ns.RDF+"predicate"),this.parent.node,this.parser.why),this.store.add(e,this.store.sym(t.ns.RDF+"object"),this.node,this.parser.why)}},isTripleToLoad:function(){return null!=this.parent&&null!=this.parent.parent&&this.nodeType===this.NODE&&this.parent.nodeType===this.ARC&&this.parent.parent.nodeType===this.NODE},addNode:function(e){this.addSymbol(this.NODE,e),this.isTripleToLoad()&&this.loadTriple()},addCollection:function(){this.nodeType=this.NODE,this.node=this.store.collection(),this.collection=!0,this.isTripleToLoad()&&this.loadTriple()},addCollectionArc:function(){this.nodeType=this.ARC},addBNode:function(e){null!=e?null!=this.parser.bnodes[e]?this.node=this.parser.bnodes[e]:this.node=this.parser.bnodes[e]=this.store.bnode():this.node=this.store.bnode(),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()},addArc:function(e){e===t.ns.RDF+"li"&&(e=t.ns.RDF+"_"+this.parent.listIndex,this.parent.listIndex++),this.addSymbol(this.ARC,e)},addLiteral:function(e){this.parent.datatype?this.node=this.store.literal(e,"",this.store.sym(this.parent.datatype)):this.node=this.store.literal(e,this.lang),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()}}},this.getAttributeNodeNS=function(e,t,r){var n=null;if(e.getAttributeNodeNS)n=e.getAttributeNodeNS(t,r);else for(var i,o,s=e.attributes,a=0;a<s.length;++a)if(i=s[a],i.namespaceURI===t&&(o=i.prefix?i.prefix+":"+r:r,o===i.nodeName)){n=i;break}return n},this.store=e,this.bnodes={},this.why=null,this.reify=!1,this.parse=function(e,r,n){var i=e.childNodes;this.cleanParser();var o;if(e.nodeType===t.nodeType.DOCUMENT){for(var s=0;s<i.length;s++)if(i[s].nodeType===t.nodeType.ELEMENT){o=i[s];break}}else{if(e.nodeType!==t.nodeType.ELEMENT)throw new Error("RDFParser: can't find root in "+r+". Halting. ");o=e}this.why=n;var a=this.frameFactory(this);return this.base=r,a.base=r,a.lang=null,this.parseDOM(this.buildFrame(a,o)),!0},this.parseDOM=function(e){for(var n,i=function(e){var t="";if(null==e.namespaceURI)throw new Error("RDF/XML syntax error: No namespace for "+e.localName+" in "+this.base);return e.namespaceURI&&(t+=e.namespaceURI),e.localName?t+=e.localName:e.nodeName&&(t+=e.nodeName.indexOf(":")>=0?e.nodeName.split(":")[1]:e.nodeName),t}.bind(this),o=!0;e.parent;){var s=e.element,a=s.attributes;if(s.nodeType===t.nodeType.TEXT||s.nodeType===t.nodeType.CDATA_SECTION)e.parent.nodeType===e.NODE&&(e.addArc(t.ns.RDF+"value"),e=this.buildFrame(e)),e.addLiteral(s.nodeValue);else if(i(s)!==t.ns.RDF+"RDF")if(e.parent&&e.parent.collection&&(e.addCollectionArc(),e=this.buildFrame(e,e.element),e.parent.element=null),e.parent&&e.parent.nodeType&&e.parent.nodeType!==e.ARC){e.addArc(i(s)),this.reify&&(n=this.getAttributeNodeNS(s,t.ns.RDF,"ID"),n&&(e.rdfid=n.nodeValue,s.removeAttributeNode(n)));var l=this.getAttributeNodeNS(s,t.ns.RDF,"parseType"),h=this.getAttributeNodeNS(s,t.ns.RDF,"datatype");if(h&&(e.datatype=h.nodeValue,s.removeAttributeNode(h)),l){var c=l.nodeValue;"Literal"===c?(e.datatype=t.ns.RDF+"XMLLiteral",e=this.buildFrame(e),e.addLiteral(s),o=!1):"Resource"===c?(e=this.buildFrame(e,e.element),e.parent.element=null,e.addBNode()):"Collection"===c&&(e=this.buildFrame(e,e.element),e.parent.element=null,e.addCollection()),s.removeAttributeNode(l)}if(0!==a.length){var u=this.getAttributeNodeNS(s,t.ns.RDF,"resource"),d=this.getAttributeNodeNS(s,t.ns.RDF,"nodeID");e=this.buildFrame(e),u?(e.addNode(u.nodeValue),s.removeAttributeNode(u)):d?(e.addBNode(d.nodeValue),s.removeAttributeNode(d)):e.addBNode();for(var p=a.length-1;p>=0;p--){var f=this.buildFrame(e);f.addArc(i(a[p])),i(a[p])===t.ns.RDF+"type"?this.buildFrame(f).addNode(a[p].nodeValue):this.buildFrame(f).addLiteral(a[p].nodeValue)}}else 0===s.childNodes.length&&this.buildFrame(e).addLiteral("")}else{var m=this.getAttributeNodeNS(s,t.ns.RDF,"about");if(n=this.getAttributeNodeNS(s,t.ns.RDF,"ID"),m&&n)throw new Error("RDFParser: "+s.nodeName+" has both rdf:id and rdf:about. Halting. Only one of these properties may be specified on a node.");if(!m&&n)e.addNode("#"+n.nodeValue),s.removeAttributeNode(n);else if(null==m&&null==n){var g=this.getAttributeNodeNS(s,t.ns.RDF,"nodeID");g?(e.addBNode(g.nodeValue),s.removeAttributeNode(g)):e.addBNode()}else e.addNode(m.nodeValue),s.removeAttributeNode(m);var v=this.getAttributeNodeNS(s,t.ns.RDF,"type");t.ns.RDF+"Description"!==i(s)&&(v={nodeValue:i(s)}),null!=v&&(this.store.add(e.node,this.store.sym(t.ns.RDF+"type"),this.store.sym(r.Util.uri.join(v.nodeValue,e.base)),this.why),v.nodeName&&s.removeAttributeNode(v));for(var y=a.length-1;y>=0;y--)this.store.add(e.node,this.store.sym(i(a[y])),this.store.literal(a[y].nodeValue,e.lang),this.why)}for(s=e.element;e.parent;){for(var w=e;null==s;)e=e.parent,s=e.element;var b=s.childNodes&&s.childNodes[e.lastChild];if(b&&o){if((b.nodeType===t.nodeType.ELEMENT||b.nodeType===t.nodeType.TEXT||b.nodeType===t.nodeType.CDATA_SECTION)&&(b.nodeType!==t.nodeType.TEXT&&b.nodeType!==t.nodeType.CDATA_SECTION||1===s.childNodes.length)){e.lastChild++,e=this.buildFrame(w,s.childNodes[e.lastChild-1]);break}e.lastChild++}else{if(e.terminateFrame(),!(e=e.parent))break;s=e.element,o=!0}}}},this.cleanParser=function(){this.bnodes={},this.why=null},this.buildFrame=function(e,n){var i=this.frameFactory(this,e,n);if(e&&(i.base=e.base,i.lang=e.lang),!n||n.nodeType===t.nodeType.TEXT||n.nodeType===t.nodeType.CDATA_SECTION)return i;var o=n.attributes,s=n.getAttributeNode("xml:base");null!=s&&(i.base=s.nodeValue,n.removeAttribute("xml:base"));var a=n.getAttributeNode("xml:lang");null!=a&&(i.lang=a.nodeValue,n.removeAttribute("xml:lang"));for(var l=o.length-1;l>=0;l--)if("xml"===o[l].nodeName.substr(0,3)){if("xmlns:"===o[l].name.slice(0,6)){var h=o[l].nodeValue;this.base&&(h=r.Util.uri.join(h,this.base)),this.store.setPrefixForURI(o[l].name.slice(6),h)}n.removeAttributeNode(o[l])}return i}},r.N3Parser=function(){function e(e){return encodeURI(e)}function t(e,t,r,i,o,s,a,l){return new n(e,t,r,i,o,s,a,l)}function n(e,t,r,n,i,o,s,a){"undefined"==typeof t&&(t=null),"undefined"==typeof r&&(r=""),"undefined"==typeof n&&(n=null),"undefined"==typeof i&&(i=""),"undefined"==typeof o&&(o=null),"undefined"==typeof s&&(s=""),"undefined"==typeof a&&(a=null),this._bindings=new c([]),this._flags=s,""!=r&&(g(r.indexOf(":")>=0,"Document URI not absolute: "+r),this._bindings[""]=r+"#"),this._store=e,i&&e.setGenPrefix(i),this._thisDoc=r,this.source=e.sym(r),this.lines=0,this.statementCount=0,this.startOfLine=0,this.previousLine=0,this._genPrefix=i,this.keywords=new h(["a","this","bind","has","is","of","true","false"]),this.keywordsSet=0,this._anonymousNodes=new c([]),this._variables=new c([]),this._parentVariables=new c([]),this._reason=a,this._reason2=null,b&&(this._reason2=why_BecauseOfData(e.sym(r),this._reason)),n?this._baseURI=n:r?this._baseURI=r:this._baseURI=null,g(!this._baseURI||this._baseURI.indexOf(":")>=0),this._genPrefix||(this._thisDoc?this._genPrefix=this._thisDoc+"#_g":this._genPrefix=RDFSink_uniqueURI()),null==t?this._thisDoc?this._formula=e.formula(r+"#_formula"):this._formula=e.formula():this._formula=t,this._context=this._formula,this._parentContext=null}function i(e,t,r,n,i){this._str=r.encode("utf-8"),this._str=r,this._i=n,this._why=i,this.lines=t,this._uri=e}function o(e,t,r,n,i){return"Line "+(t+1)+" of <"+e+">: Bad syntax: "+i+'\nat: "'+d(r,n,n+30)+'"'}var s={encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},decode:function(e){for(var t="",r=0;r<e.length;){var n=e.charCodeAt(r);128>n?(t+=String.fromCharCode(n),r++):n>191&&224>n?(t+=String.fromCharCode((31&n)<<6|63&e.charCodeAt(r+1)),r+=2):(t+=String.fromCharCode((15&n)<<12|(63&e.charCodeAt(r+1))<<6|63&e.charCodeAt(r+2)),r+=3)}return t}},a="http://www.w3.org/2000/10/swap/log#",l=function(e){return e},h=function(e){return e},c=function(e){if(e.length>0)throw"missing.js: oops nnonempty dict not imp";return[]},u=function(e){return e.length},d=function(e,t,r){if("undefined"==typeof e.slice)throw"@@ mising.js: No .slice function for "+e+" of type "+typeof e;return"undefined"==typeof r||null==r?e.slice(t):e.slice(t,r)},p=Error("dummy error stop iteration"),f=function(e){return this.last=0,this.li=e,this.next=function(){if(this.last==this.li.length)throw p;return this.li[this.last++]},this},m=function(e,t){return e.indexOf(t)},g=function(e,t){if(!e){if(t)throw"python Assertion failed: "+t;throw"(python) Assertion failed."}},v=function(e){return String.fromCharCode(e)};String.prototype.encode=function(e){if("utf-8"!=e)throw"UTF8_converter: can only do utf-8";return s.encode(this)},String.prototype.decode=function(e){if("utf-8"!=e)throw"UTF8_converter: can only do utf-8";return this};var y=function(e,t){return r.Util.uri.join(t,e)},w=null,b=0,T=0,x=function(e){},N="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",R="http://www.w3.org/2002/07/owl#sameAs",I="#",k="http://www.w3.org/2001/XMLSchema#integer",D="http://www.w3.org/2001/XMLSchema#double",C="http://www.w3.org/2001/XMLSchema#decimal",_="http://www.w3.org/2001/XMLSchema#date",S="http://www.w3.org/2001/XMLSchema#dateTime",F="	\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~",O=F+":",U=(new RegExp("^[ \\t]*(#[^\\n]*)?\\r?\\n","g"),new RegExp("^[ \\t]*(#[^\\n]*)?$","g"),new RegExp("^[ \\t]*","g"),new RegExp("^[-+]?[0-9]+","g"),new RegExp("^([-+]?[0-9]+)(\\.[0-9]+)?(e[-+]?[0-9]+)?","g")),M=new RegExp("^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9](T[0-9][0-9]:[0-9][0-9](:[0-9][0-9](\\.[0-9]*)?)?)?Z?"),E=(new RegExp("^[0-9]+","g"),
new RegExp('[\\\\\\r\\n\\"]',"g")),L=new RegExp("^[a-zA-Z0-9]+(-[a-zA-Z0-9]+)?","g");return n.prototype.here=function(e){return this._genPrefix+"_L"+this.lines+"C"+(e-this.startOfLine+1)},n.prototype.formula=function(){return this._formula},n.prototype.loadStream=function(e){return this.loadBuf(e.read())},n.prototype.loadBuf=function(e){return this.startDoc(),this.feed(e),this.endDoc()},n.prototype.feed=function(e){for(var t=e.decode("utf-8"),r=0;r>=0;){var n=this.skipSpace(t,r);if(0>n)return;var r=this.directiveOrStatement(t,n);if(0>r)throw o(this._thisDoc,this.lines,t,n,"expected directive or statement")}},n.prototype.directiveOrStatement=function(e,t){var r=this.skipSpace(e,t);if(0>r)return r;var n=this.directive(e,r);if(n>=0)return this.checkDot(e,n);var n=this.statement(e,r);return n>=0?this.checkDot(e,n):n},n.prototype.tok=function(e,t,n){if("@"==d(t,n,n+1))var n=n+1;else if(r.Util.ArrayIndexOf(this.keywords,e)<0)return-1;var i=n+u(e);return d(t,n,i)==e&&F.indexOf(t.charAt(i))>=0?i:-1},n.prototype.directive=function(t,n){var i=this.skipSpace(t,n);if(0>i)return i;var s=new h([]),i=this.tok("bind",t,n);if(i>0)throw o(this._thisDoc,this.lines,t,n,"keyword bind is obsolete: use @prefix");var i=this.tok("keywords",t,n);if(i>0){var n=this.commaSeparatedList(t,i,s,!1);if(0>n)throw o(this._thisDoc,this.lines,t,n,"'@keywords' needs comma separated list of words");return this.setKeywords(d(s,null,null)),T>80&&x("Keywords ",this.keywords),n}var i=this.tok("forAll",t,n);if(i>0){var n=this.commaSeparatedList(t,i,s,!0);if(0>n)throw o(this._thisDoc,this.lines,t,n,"Bad variable list after @forAll");var a=new f(s);try{for(;;){var l=a.next();(r.Util.ArrayIndexOf(this._variables,l)<0||r.Util.ArrayIndexOf(this._parentVariables,l)>=0)&&(this._variables[l]=this._context.newUniversal(l))}}catch(c){if(c!=p)throw c}return n}var i=this.tok("forSome",t,n);if(i>0){var n=this.commaSeparatedList(t,i,s,this.uri_ref2);if(0>n)throw o(this._thisDoc,this.lines,t,n,"Bad variable list after @forSome");var a=new f(s);try{for(;;){var l=a.next();this._context.declareExistential(l)}}catch(c){if(c!=p)throw c}return n}var i=this.tok("prefix",t,n);if(i>=0){var u=new h([]),n=this.qname(t,i,u);if(0>n)throw o(this._thisDoc,this.lines,t,i,"expected qname after @prefix");var i=this.uri_ref2(t,n,u);if(0>i)throw o(this._thisDoc,this.lines,t,n,"expected <uriref> after @prefix _qname_");var m=u[1].uri;if(this._baseURI)var m=y(this._baseURI,m);else g(m.indexOf(":")>=0,"With no base URI, cannot handle relative URI for NS");return g(m.indexOf(":")>=0),this._bindings[u[0][0]]=m,this.bind(u[0][0],e(m)),i}var i=this.tok("base",t,n);if(i>=0){var u=new h([]),n=this.uri_ref2(t,i,u);if(0>n)throw o(this._thisDoc,this.lines,t,i,"expected <uri> after @base ");var m=u[0].uri;if(!this._baseURI)throw o(this._thisDoc,this.lines,t,i,"With no previous base URI, cannot use relative URI in @base  <"+m+">");var m=y(this._baseURI,m);return g(m.indexOf(":")>=0),this._baseURI=m,n}return-1},n.prototype.bind=function(e,t){""==e||this._store.setPrefixForURI(e,t)},n.prototype.setKeywords=function(e){null==e?this.keywordsSet=0:(this.keywords=e,this.keywordsSet=1)},n.prototype.startDoc=function(){},n.prototype.endDoc=function(){return this._formula},n.prototype.makeStatement=function(e){e[0].add(e[2],e[1],e[3],this.source),this.statementCount+=1},n.prototype.statement=function(e,t){var r=new h([]),t=this.object(e,t,r);if(0>t)return t;var n=this.property_list(e,t,r[0]);if(0>n)throw o(this._thisDoc,this.lines,e,t,"expected propertylist");return n},n.prototype.subject=function(e,t,r){return this.item(e,t,r)},n.prototype.verb=function(e,t,r){var n=this.skipSpace(e,t);if(0>n)return n;var i=new h([]),n=this.tok("has",e,t);if(n>=0){var t=this.prop(e,n,i);if(0>t)throw o(this._thisDoc,this.lines,e,n,"expected property after 'has'");return r.push(new l(["->",i[0]])),t}var n=this.tok("is",e,t);if(n>=0){var t=this.prop(e,n,i);if(0>t)throw o(this._thisDoc,this.lines,e,n,"expected <property> after 'is'");var n=this.skipSpace(e,t);if(0>n)throw o(this._thisDoc,this.lines,e,t,"End of file found, expected property after 'is'");var t=n,n=this.tok("of",e,t);if(0>n)throw o(this._thisDoc,this.lines,e,t,"expected 'of' after 'is' <prop>");return r.push(new l(["<-",i[0]])),n}var n=this.tok("a",e,t);if(n>=0)return r.push(new l(["->",this._store.sym(N)])),n;if("<="==d(e,t,t+2))return r.push(new l(["<-",this._store.sym(a+"implies")])),t+2;if("="==d(e,t,t+1))return">"==d(e,t+1,t+2)?(r.push(new l(["->",this._store.sym(a+"implies")])),t+2):(r.push(new l(["->",this._store.sym(R)])),t+1);if(":="==d(e,t,t+2))return r.push(new l(["->",a+"becomes"])),t+2;var n=this.prop(e,t,i);if(n>=0)return r.push(new l(["->",i[0]])),n;if(">-"==d(e,t,t+2)||"<-"==d(e,t,t+2))throw o(this._thisDoc,this.lines,e,n,">- ... -> syntax is obsolete.");return-1},n.prototype.prop=function(e,t,r){return this.item(e,t,r)},n.prototype.item=function(e,t,r){return this.path(e,t,r)},n.prototype.blankNode=function(e){return this._context.bnode(e,this._reason2)},n.prototype.path=function(e,t,r){var n=this.nodeOrLiteral(e,t,r);if(0>n)return n;for(;"!^.".indexOf(d(e,n,n+1))>=0;){var i=d(e,n,n+1);if("."==i){var s=d(e,n+1,n+2);if(!s||O.indexOf(s)>=0&&":?<[{(".indexOf(s)<0)break}var a=r.pop(),h=this.blankNode(this.here(n)),n=this.node(e,n+1,r);if(0>n)throw o(this._thisDoc,this.lines,e,n,"EOF found in middle of path syntax");var c=r.pop();"^"==i?this.makeStatement(new l([this._context,c,h,a])):this.makeStatement(new l([this._context,c,a,h])),r.push(h)}return n},n.prototype.anonymousNode=function(e){var t=this._anonymousNodes[e];if(t)return t;var t=this._store.bnode(this._context,this._reason2);return this._anonymousNodes[e]=t,t},n.prototype.node=function(e,t,r,n){"undefined"==typeof n&&(n=null);var i=n,s=this.skipSpace(e,t);if(0>s)return s;var t=s,a=d(e,t,t+1);if("["==a){var m=this.here(t),s=this.skipSpace(e,t+1);if(0>s)throw o(this._thisDoc,this.lines,e,t,"EOF after '['");if("="==d(e,s,s+1)){var t=s+1,g=new h([]),s=this.objectList(e,t,g);if(!(s>=0))throw o(this._thisDoc,this.lines,e,t,"objectList expected after [= ");var i=g[0];if(u(g)>1){var v=new f(g);try{for(;;){var y=v.next();this.makeStatement(new l([this._context,this._store.sym(R),i,y]))}}catch(b){if(b!=p)throw b}}var s=this.skipSpace(e,s);if(0>s)throw o(this._thisDoc,this.lines,e,t,"EOF when objectList expected after [ = ");if(";"==d(e,s,s+1))var s=s+1}if(null==i)var i=this.blankNode(m);var t=this.property_list(e,s,i);if(0>t)throw o(this._thisDoc,this.lines,e,s,"property_list expected");var s=this.skipSpace(e,t);if(0>s)throw o(this._thisDoc,this.lines,e,t,"EOF when ']' expected after [ <propertyList>");if("]"!=d(e,s,s+1))throw o(this._thisDoc,this.lines,e,s,"']' expected");return r.push(i),s+1}if("{"==a){var T=d(e,t+1,t+2);if("$"==T){t+=1;for(var s=t+1,x=new h([]),N=!0;;){var t=this.skipSpace(e,s);if(0>t)throw o(this._thisDoc,this.lines,e,t,"needed '$}', found end.");if("$}"==d(e,t,t+2)){var s=t+2;break}if(N)var N=!1;else{if(","!=d(e,t,t+1))throw o(this._thisDoc,this.lines,e,t,"expected: ','");t+=1}var I=new h([]),s=this.item(e,t,I);if(0>s)throw o(this._thisDoc,this.lines,e,t,"expected item in set or '$}'");x.push(I[0])}return r.push(this._store.newSet(x,this._context)),s}var s=t+1,k=this._parentContext;this._parentContext=this._context;var D=this._anonymousNodes,C=this._parentVariables;this._parentVariables=this._variables,this._anonymousNodes=new c([]),this._variables=this._variables.slice();var _=this._reason2;if(this._reason2=w,null==i)var i=this._store.formula();for(this._context=i;;){var t=this.skipSpace(e,s);if(0>t)throw o(this._thisDoc,this.lines,e,t,"needed '}', found end.");if("}"==d(e,t,t+1)){var s=t+1;break}var s=this.directiveOrStatement(e,t);if(0>s)throw o(this._thisDoc,this.lines,e,t,"expected statement or '}'")}return this._anonymousNodes=D,this._variables=this._parentVariables,this._parentVariables=C,this._context=this._parentContext,this._reason2=_,this._parentContext=k,r.push(i.close()),s}if("("==a){var S=this._store.list,T=d(e,t+1,t+2);if("$"==T){var S=this._store.newSet;t+=1}for(var s=t+1,x=new h([]);;){var t=this.skipSpace(e,s);if(0>t)throw o(this._thisDoc,this.lines,e,t,"needed ')', found end.");if(")"==d(e,t,t+1)){var s=t+1;break}var I=new h([]),s=this.item(e,t,I);if(0>s)throw o(this._thisDoc,this.lines,e,t,"expected item in list or ')'");x.push(I[0])}return r.push(S(x,this._context)),s}var s=this.tok("this",e,t);if(s>=0)throw o(this._thisDoc,this.lines,e,t,"Keyword 'this' was ancient N3. Now use @forSome and @forAll keywords.");var s=this.tok("true",e,t);if(s>=0)return r.push(!0),s;var s=this.tok("false",e,t);if(s>=0)return r.push(!1),s;if(null==i){var s=this.uri_ref2(e,t,r);if(s>=0)return s}return-1},n.prototype.property_list=function(e,t,r){for(;;){var n=this.skipSpace(e,t);if(0>n)throw o(this._thisDoc,this.lines,e,t,"EOF found when expected verb in property list");if(":-"!=d(e,n,n+2)){var t=n,i=new h([]),n=this.verb(e,t,i);if(0>=n)return t;var s=new h([]),t=this.objectList(e,n,s);if(0>t)throw o(this._thisDoc,this.lines,e,n,"objectList expected");var a=new f(s);try{for(;;){var c=a.next(),u=i[0],m=u[0],g=u[1];"->"==m?this.makeStatement(new l([this._context,g,r,c])):this.makeStatement(new l([this._context,g,c,r]))}}catch(v){if(v!=p)throw v}var n=this.skipSpace(e,t);if(0>n)throw o(this._thisDoc,this.lines,e,n,"EOF found in list of objects");if(";"!=d(e,t,t+1))return t;var t=t+1}else{var t=n+2,y=new h([]),n=this.node(e,t,y,r);if(0>n)throw o(this._thisDoc,this.lines,e,t,"bad {} or () or [] node after :- ");var t=n}}},n.prototype.commaSeparatedList=function(e,t,r,n){var i=this.skipSpace(e,t);if(0>i)throw o(this._thisDoc,this.lines,e,i,"EOF found expecting comma sep list");if("."==e.charAt(i))return t;if(n)var i=this.uri_ref2(e,i,r);else var i=this.bareWord(e,i,r);if(0>i)return-1;for(;;){var t=this.skipSpace(e,i);if(0>t)return t;var s=d(e,t,t+1);if(","!=s)return"."!=s?-1:t;if(n)var i=this.uri_ref2(e,t+1,r);else var i=this.bareWord(e,t+1,r);if(0>i)throw o(this._thisDoc,this.lines,e,i,"bad list content")}},n.prototype.objectList=function(e,t,r){var t=this.object(e,t,r);if(0>t)return-1;for(;;){var n=this.skipSpace(e,t);if(0>n)throw o(this._thisDoc,this.lines,e,n,"EOF found after object");if(","!=d(e,n,n+1))return n;var t=this.object(e,n+1,r);if(0>t)return t}},n.prototype.checkDot=function(e,t){var r=this.skipSpace(e,t);if(0>r)return r;if("."==d(e,r,r+1))return r+1;if("}"==d(e,r,r+1))return r;if("]"==d(e,r,r+1))return r;throw o(this._thisDoc,this.lines,e,r,"expected '.' or '}' or ']' at end of statement")},n.prototype.uri_ref2=function(e,t,n){var i=new h([]),s=this.qname(e,t,i);if(s>=0){var a=i[0],l=a[0],c=a[1];if(null==l){g(0,"not used?");var p=this._baseURI+I}else{var p=this._bindings[l];if(!p){if("_"==l)return n.push(this.anonymousNode(c)),s;throw o(this._thisDoc,this.lines,e,t,"Prefix "+l+" not bound.")}}var f=this._store.sym(p+c);return r.Util.ArrayIndexOf(this._variables,f)>=0?n.push(this._variables[f]):n.push(f),s}var t=this.skipSpace(e,t);if(0>t)return-1;if("?"==e.charAt(t)){var m=new h([]),s=this.variable(e,t,m);return s>0?(n.push(m[0]),s):-1}if("<"==e.charAt(t)){for(var t=t+1,v=t;t<u(e);){if(">"==e.charAt(t)){var w=d(e,v,t);if(this._baseURI)var w=y(this._baseURI,w);else g(w.indexOf(":")>=0,"With no base URI, cannot deal with relative URIs");if("#"==d(e,t-1,t)&&"#"!=d(w,-1,null))var w=w+"#";var f=this._store.sym(w);return r.Util.ArrayIndexOf(this._variables,f)>=0?n.push(this._variables[f]):n.push(f),t+1}var t=t+1}throw o(this._thisDoc,this.lines,e,s,"unterminated URI reference")}if(this.keywordsSet){var m=new h([]),s=this.bareWord(e,t,m);if(0>s)return-1;if(r.Util.ArrayIndexOf(this.keywords,m[0])>=0)throw o(this._thisDoc,this.lines,e,t,'Keyword "'+m[0]+'" not allowed here.');return n.push(this._store.sym(this._bindings[""]+m[0])),s}return-1},n.prototype.skipSpace=function(e,t){for(var r=" \n\r	\f\x0B            ​\u2028\u2029　",n=t?t:0;n<e.length;n++){var i=e.charAt(n);if(r.indexOf(i)<0){if("#"!==e.charAt(n))return n;for(;;n++){if(n===e.length)return-1;if("\n"===e.charAt(n)){this.lines=this.lines+1;break}}}else"\n"===e.charAt(n)&&(this.lines=this.lines+1)}return-1},n.prototype.variable=function(e,t,r){var n=this.skipSpace(e,t);if(0>n)return-1;if("?"!=d(e,n,n+1))return-1;var n=n+1,t=n;if("0123456789-".indexOf(e.charAt(n))>=0)throw o(this._thisDoc,this.lines,e,n,"Varible name can't start with '"+e.charAt(n)+"s'");for(;t<u(e)&&O.indexOf(e.charAt(t))<0;)var t=t+1;if(null==this._parentContext)throw o(this._thisDoc,this.lines,e,n,"Can't use ?xxx syntax for variable in outermost level: "+d(e,n-1,t));return r.push(this._store.variable(d(e,n,t))),t},n.prototype.bareWord=function(e,t,r){var n=this.skipSpace(e,t);if(0>n)return-1;var i=e.charAt(n);if("0123456789-".indexOf(i)>=0)return-1;if(O.indexOf(i)>=0)return-1;for(var t=n;t<u(e)&&O.indexOf(e.charAt(t))<0;)var t=t+1;return r.push(d(e,n,t)),t},n.prototype.qname=function(e,t,n){var t=this.skipSpace(e,t);if(0>t)return-1;var i=e.charAt(t);if("0123456789-+".indexOf(i)>=0)return-1;if(O.indexOf(i)<0)for(var o=i,t=t+1;t<u(e);){var i=e.charAt(t);if(!(O.indexOf(i)<0))break;var o=o+i,t=t+1}else var o="";if(t<u(e)&&":"==e.charAt(t)){for(var s=o,t=t+1,o="";t<u(e);){var i=e.charAt(t);if(!(O.indexOf(i)<0))break;var o=o+i,t=t+1}return n.push(new l([s,o])),t}return o&&this.keywordsSet&&r.Util.ArrayIndexOf(this.keywords,o)<0?(n.push(new l(["",o])),t):-1},n.prototype.object=function(e,t,r){var n=this.subject(e,t,r);if(n>=0)return n;var n=this.skipSpace(e,t);if(0>n)return-1;var t=n;if('"'==e.charAt(t)){if('"""'==d(e,t,t+3))var i='"""';else var i='"';var t=t+u(i),o=this.strconst(e,t,i),n=o[0],s=o[1];return r.push(this._store.literal(s)),x("New string const ",s,n),n}return-1},n.prototype.nodeOrLiteral=function(e,t,r){var n=this.node(e,t,r);if(n>=0)return n;var n=this.skipSpace(e,t);if(0>n)return-1;var t=n,i=e.charAt(t);if("-+0987654321".indexOf(i)>=0){M.lastIndex=0;var s=M.exec(e.slice(t));if(null!=s){var a=s[0];n=t+a.length,a.indexOf("T")>=0?r.push(this._store.literal(a,void 0,this._store.sym(S))):r.push(this._store.literal(a,void 0,this._store.sym(_)))}else{U.lastIndex=0;var s=U.exec(e.slice(t));if(null==s)throw o(this._thisDoc,this.lines,e,t,"Bad number or date syntax");n=t+U.lastIndex;var a=d(e,t,n);a.indexOf("e")>=0?r.push(this._store.literal(parseFloat(a),void 0,this._store.sym(D))):d(e,t,n).indexOf(".")>=0?r.push(this._store.literal(parseFloat(a),void 0,this._store.sym(C))):r.push(this._store.literal(parseInt(a),void 0,this._store.sym(k)))}return n}if('"'==e.charAt(t)){if('"""'==d(e,t,t+3))var l='"""';else var l='"';var t=t+u(l),c=null,p=this.strconst(e,t,l),n=p[0],f=p[1],m=null;if("@"==d(e,n,n+1)){L.lastIndex=0;var s=L.exec(e.slice(n+1));if(null==s)throw o(this._thisDoc,startline,e,t,"Bad language code syntax on string literal, after @");var t=L.lastIndex+n+1,m=d(e,n+1,t),n=t}if("^^"==d(e,n,n+2))var g=new h([]),n=this.uri_ref2(e,n+2,g),c=g[0];return r.push(this._store.literal(f,m,c)),n}return-1},n.prototype.strconst=function(e,t,r){for(var n=t,i="",s=this.lines;n<u(e);){var t=n+u(r);if(d(e,n,t)==r)return new l([t,i]);if('"'!=e.charAt(n)){E.lastIndex=0;var a=E.exec(e.slice(n));if(!a)throw o(this._thisDoc,s,e,n,"Closing quote missing in string at ^ in "+d(e,n-20,n)+"^"+d(e,n,n+20));var t=n+E.lastIndex-1,i=i+d(e,n,t),h=e.charAt(t);if('"'!=h)if("\r"!=h){if("\n"==h){if('"'==r)throw o(this._thisDoc,s,e,t,"newline found in string literal");this.lines=this.lines+1;var i=i+h,n=t+1;this.previousLine=this.startOfLine,this.startOfLine=n}else if("\\"==h){var n=t+1,h=d(e,n,n+1);if(!h)throw o(this._thisDoc,s,e,t,"unterminated string literal (2)");var c=m('abfrtvn\\"',h);if(c>=0)var p='a\b\f\r	\x0B\n\\"'.charAt(c),i=i+p,n=n+1;else if("u"==h)var f=this.uEscape(e,n+1,s),n=f[0],h=f[1],i=i+h;else{if("U"!=h)throw o(this._thisDoc,this.lines,e,t,"bad escape");var f=this.UEscape(e,n+1,s),n=f[0],h=f[1],i=i+h}}}else var n=t+1;else var n=t}else var i=i+'"',n=n+1}throw o(this._thisDoc,this.lines,e,t,"unterminated string literal")},n.prototype.uEscape=function(e,t,r){for(var n=t,i=0,s=0;4>i;){var a=d(e,n,n+1),h=a.toLowerCase(),n=n+1;if(""==h)throw o(this._thisDoc,r,e,t,"unterminated string literal(3)");var c=m("0123456789abcdef",h);if(0>c)throw o(this._thisDoc,r,e,t,"bad string literal hex escape");var s=16*s+c,i=i+1}var u=String.fromCharCode(s);return new l([n,u])},n.prototype.UEscape=function(e,t,r){for(var n=t,i=0,s="\\U";8>i;){var a=d(e,n,n+1),h=a.toLowerCase(),n=n+1;if(""==h)throw o(this._thisDoc,r,e,t,"unterminated string literal(3)");var c=m("0123456789abcdef",h);if(0>c)throw o(this._thisDoc,r,e,t,"bad string literal hex escape");var s=s+h,i=i+1}var u=v("0x"+d(s,2,10)-0);return new l([n,u])},i.prototype.toString=function(){var e=this._str,t=this._i,r=0;if(t>60)var n="...",r=t-60;else var n="";if(u(e)-t>60)var i="...";else var i="";return'Line %i of <%s>: Bad syntax (%s) at ^ in:\n"%s%s^%s%s"'%new l([this.lines+1,this._uri,this._why,n,d(e,r,t),d(e,t,t+60),i])},t}(),r.IndexedFormula=function(){var e="http://www.w3.org/2002/07/owl#";return r.Literal.prototype.hashString=r.Literal.prototype.toNT,r.NamedNode.prototype.hashString=r.NamedNode.prototype.toNT,r.BlankNode.prototype.hashString=r.BlankNode.prototype.toNT,r.Collection.prototype.hashString=r.Collection.prototype.toNT,r.IndexedFormula=function(t){function n(e,t,r,n,i){e.typeCallback&&e.typeCallback(e,n,i);var o=e.classActions[n.hashString()],s=!1;if(o)for(var a=0;a<o.length;a++)s=s||o[a](e,t,r,n,i);return s}function i(e,t,r,n){var i=e.any(void 0,r,n);return i?(e.equate(i,t),!0):!1}function o(e,t,r,n){var i=e.any(t,r,void 0);return i?(e.equate(i,n),!0):!1}this.statements=[],this.optional=[],this.propertyActions=[],this.classActions=[],this.redirections=[],this.aliases=[],this.HTTPRedirects=[],this.subjectIndex=[],this.predicateIndex=[],this.objectIndex=[],this.whyIndex=[],this.index=[this.subjectIndex,this.predicateIndex,this.objectIndex,this.whyIndex],this.namespaces={},void 0===t&&(t=["sameAs","InverseFunctionalProperty","FunctionalProperty"]),this.propertyActions["<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>"]=[n],r.Util.ArrayIndexOf(t,"sameAs")>=0&&(this.propertyActions["<http://www.w3.org/2002/07/owl#sameAs>"]=[function(e,t,r,n,i){return e.equate(t,n),!0}]),r.Util.ArrayIndexOf(t,"InverseFunctionalProperty")>=0&&(this.classActions["<"+e+"InverseFunctionalProperty>"]=[function(e,t,r,n,o){return e.newPropertyAction(t,i)}]),r.Util.ArrayIndexOf(t,"FunctionalProperty")>=0&&(this.classActions["<"+e+"FunctionalProperty>"]=[function(e,t,r,n,i){return e.newPropertyAction(t,o)}])},r.IndexedFormula.prototype=new r.Formula,r.IndexedFormula.prototype.constructor=r.IndexedFormula,r.IndexedFormula.SuperClass=r.Formula,r.IndexedFormula.prototype.newPropertyAction=function(e,t){var r=e.hashString();this.propertyActions[r]||(this.propertyActions[r]=[]),this.propertyActions[r].push(t);for(var n=this.statementsMatching(void 0,e,void 0),i=!1,o=0;o<n.length;o++)i=i||t(this,n[o].subject,e,n[o].object);return i},r.IndexedFormula.prototype.setPrefixForURI=function(e,t){"tab"===e&&this.namespaces.tab||"ns"!==e.slice(0,2)&&"default"!==e.slice(0,7)&&(this.namespaces[e]=t)},r.IndexedFormula.prototype.register=function(e,t){this.namespaces[e]=t},r.IndexedFormula.prototype.equate=function(e,t){e=this.canon(e),t=this.canon(t);var r=e.compareTerm(t);return r?0>r?this.replaceWith(t,e):this.replaceWith(e,t):!0},r.IndexedFormula.prototype.replaceWith=function(e,t){for(var r=e.hashString(),n=t.hashString(),i=function(e){var t=e[r];if(t){var i=e[n];i?e[n]=t.concat(i):e[n]=t,delete e[r]}},o=0;4>o;o++)i(this.index[o]);if(this.redirections[r]=t,e.uri){if(this.aliases[n]||(this.aliases[n]=[]),this.aliases[n].push(e),this.aliases[r])for(o=0;o<this.aliases[r].length;o++)this.redirections[this.aliases[r][o].hashString()]=t,this.aliases[n].push(this.aliases[r][o]);this.add(t,this.sym("http://www.w3.org/2007/ont/link#uri"),e.uri),this.fetcher&&this.fetcher.nowKnownAs(e,t)}return i(this.classActions),i(this.propertyActions),!0},r.IndexedFormula.prototype.canon=function(e){if(!e)return e;var t=this.redirections[e.hashString()];return t?t:e},r.IndexedFormula.prototype.sameThings=function(e,t){if(e.sameTerm(t))return!0;var r=this.canon(e);if(!r)return!1;var n=this.canon(t);return n?r.uri===n.uri:!1},r.IndexedFormula.prototype.uris=function(e){var t=this.canon(e),r=this.aliases[t.hashString()];if(!t.uri)return[];var n=[t.uri];if(r)for(var i=0;i<r.length;i++)n.push(r[i].uri);return n},r.IndexedFormula.prototype.add=function(e,t,n,i){var o;if(1===arguments.length){if(e instanceof Array)for(o=0;o<e.length;o++)this.add(e[o]);else e instanceof r.Statement?this.add(e.subject,e.predicate,e.object,e.why):e instanceof r.IndexedFormula&&this.add(e.statements);return this}var s,a;i||(i=this.fetcher?this.fetcher.appNode:this.sym("chrome:theSession")),e=r.term(e),t=r.term(t),n=r.term(n),i=r.term(i),this.predicateCallback&&this.predicateCallback(this,t,i);var l=this.canon(t).hashString();s=this.propertyActions[l];var h=!1;if(s)for(o=0;o<s.length;o++)h=h||s[o](this,e,t,n,i);var c=[this.canon(e).hashString(),l,this.canon(n).hashString(),this.canon(i).hashString()];for(a=new r.Statement(e,t,n,i),o=0;4>o;o++){var u=this.index[o],d=c[o];u[d]||(u[d]=[]),u[d].push(a)}return this.statements.push(a),a},r.IndexedFormula.prototype.mentionsURI=function(e){var t="<"+e+">";return!!this.subjectIndex[t]||!!this.objectIndex[t]||!!this.predicateIndex[t]},r.IndexedFormula.prototype.nextSymbol=function(e){for(var t=0;;t++){var r=e.uri+"#n"+t;if(!this.mentionsURI(r))return this.sym(r)}},r.IndexedFormula.prototype.anyStatementMatching=function(e,t,r,n){var i=this.statementsMatching(e,t,r,n,!0);if(i&&0!==i.length)return i[0]},r.IndexedFormula.prototype.statementsMatching=function(e,t,n,i,o){var s,a,l=[e,t,n,i],h=[],c=[],u=[],d=[];for(s=0;4>s;s++)h[s]=this.canon(r.term(l[s])),h[s]?(d.push(s),c[s]=h[s].hashString()):u.push(s);if(0===d.length)return this.statements;if(1===d.length)return s=d[0],a=this.index[s][c[s]],a&&o&&a.length>1&&(a=a.slice(0,1)),a=a||[];var p,f,m=1e10;for(f=0;f<d.length;f++){if(s=d[f],a=this.index[s][c[s]],!a)return[];a.length<m&&(m=a.length,p=f)}for(var g=d[p],v=this.index[g][c[g]],y=d.slice(0,p).concat(d.slice(p+1)),w=[],b=["subject","predicate","object","why"],T=0;T<v.length;T++){var x=v[T];for(f=0;f<y.length;f++)if(s=y[f],!this.canon(x[b[s]]).sameTerm(h[s])){x=null;break}if(null!=x&&(w.push(x),o))break}return w},r.IndexedFormula.prototype.removeDocument=function(e){for(var t=this.statementsMatching(void 0,void 0,void 0,e).slice(),r=0;r<t.length;r++)this.removeStatement(t[r]);return this},r.IndexedFormula.prototype.remove=function(e){if(e instanceof Array){for(var t=0;t<e.length;t++)this.remove(e[t]);return this}if(e instanceof r.IndexedFormula)return this.remove(e.statements);var n=this.statementsMatching(e.subject,e.predicate,e.object,e.why);if(!n.length)throw new Error("Statement to be removed is not on store: "+e);return this.removeStatement(n[0]),this},r.IndexedFormula.prototype.removeMatches=function(e,t,r,n){return this.removeStatements(this.staementsMatching(e,t,r,n)),this},r.IndexedFormula.prototype.removeStatements=function(e){for(var t=0;t<e.length;t++)this.remove(e[t]);return this},r.IndexedFormula.prototype.removeStatement=function(e){for(var t=[e.subject,e.predicate,e.object,e.why],n=0;4>n;n++){var i=this.canon(t[n]),o=i.hashString();this.index[n][o]&&r.Util.RDFArrayRemove(this.index[n][o],e)}return r.Util.RDFArrayRemove(this.statements,e),this},r.IndexedFormula.prototype.checkStatementList=function(e,t){for(var r,n=["subject","predicate","object","why"],i=" found in "+n[t]+" index.",o=0;o<e.length;o++){r=e[o];for(var s=[r.subject,r.predicate,r.object,r.why],a=function(e,t){for(var r=0;r<e.length;r++)if(e[r].subject.sameTerm(t.subject)&&e[r].predicate.sameTerm(t.predicate)&&e[r].object.sameTerm(t.object)&&e[r].why.sameTerm(t.why))return!0},l=0;4>l;l++){var h=this.canon(s[l]),c=h.hashString();if(!this.index[l][c])throw new Error("No "+name[l]+" index for statement "+r+"@"+r.why+i);if(!a(this.index[l][c],r))throw new Error("Index for "+name[l]+" does not have statement "+r+"@"+r.why+i)}if(!a(this.statements,r))throw new Error("Statement list does not statement "+r+"@"+r.why+i)}},r.IndexedFormula.prototype.check=function(){this.checkStatementList(this.statements);for(var e=0;4>e;e++){var t=this.index[e];for(var r in t)t.hasOwnProperty(r)&&this.checkStatementList(t[r],e)}},r.IndexedFormula.prototype.removeMany=function(e,t,r,n,i){for(var o=this.statementsMatching(e,t,r,n,!1),s=[],a=0;a<o.length;a++)s.push(o[a]);for(i&&(s=s.slice(0,i)),a=0;a<s.length;a++)this.remove(s[a])},r.IndexedFormula.prototype.copyTo=function(e,t,n){n||(n=[]);var i=this.statementsMatching(e);-1!==r.Util.ArrayIndexOf(n,"two-direction")&&i.concat(this.statementsMatching(void 0,void 0,e));for(var o=0;o<i.length;o++){var s=i[o];switch(s.object.termType){case"symbol":this.add(t,s.predicate,s.object);break;case"literal":case"bnode":case"collection":this.add(t,s.predicate,s.object.copy(this))}-1!==r.Util.ArrayIndexOf(n,"delete")&&this.remove(s)}},r.Literal.prototype.copy=function(){return new r.Literal(this.value,this.lang,this.datatype)},r.BlankNode.prototype.copy=function(e){var t=new r.BlankNode;return e.copyTo(this,t),t},r.IndexedFormula.prototype.newUniversal=function(e){var t=this.sym(e);return this._universalVariables||(this._universalVariables=[]),this._universalVariables.push(t),t},r.IndexedFormula.prototype.newExistential=function(e){if(!e)return this.bnode();var t=this.sym(e);return this.declareExistential(t)},r.IndexedFormula.prototype.declareExistential=function(e){return this._existentialVariables||(this._existentialVariables=[]),this._existentialVariables.push(e),e},r.IndexedFormula.prototype.formula=function(e){return new r.IndexedFormula(e)},r.IndexedFormula.prototype.close=function(){return this},r.IndexedFormula.prototype.hashString=r.IndexedFormula.prototype.toNT,r.IndexedFormula}(),"undefined"==typeof d)var d={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};r.RDFaProcessor=function(e,t){this.options=t||{},this.kb=e,this.target=t.target||{graph:{subjects:{},prefixes:{},terms:{}}},console.log("base URI "+this.options.base);t.mode||"html";this.inXHTMLMode=!1,this.inHTMLMode=!1,this.theOne="_:"+(new Date).getTime(),this.language=null,this.vocabulary=null,this.blankCounter=0,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}],this.inXHTMLMode=!1,this.absURIRE=/[\w\_\-]+:\S+/,this.finishedHandlers=[],this.init()},r.RDFaProcessor.prototype.newBlankNode=function(){return this.blankCounter++,"_:"+this.blankCounter},r.RDFaProcessor.XMLLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral",r.RDFaProcessor.HTMLLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#HTML",r.RDFaProcessor.PlainLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral",r.RDFaProcessor.objectURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#object",r.RDFaProcessor.typeURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",r.RDFaProcessor.nameChar="[-A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�က0-F.0-9·̀-ͯ‿-⁀]",r.RDFaProcessor.nameStartChar="[A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣一-龥〇〡-〩_]",r.RDFaProcessor.NCNAME=new RegExp("^"+r.RDFaProcessor.nameStartChar+r.RDFaProcessor.nameChar+"*$"),r.RDFaProcessor.trim=function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},r.RDFaProcessor.prototype.tokenize=function(e){return r.RDFaProcessor.trim(e).split(/\s+/)},r.RDFaProcessor.prototype.parseSafeCURIEOrCURIEOrURI=function(e,t,n){return e=r.RDFaProcessor.trim(e),"["==e.charAt(0)&&"]"==e.charAt(e.length-1)?(e=e.substring(1,e.length-1),e=e.trim(e),0==e.length?null:"_:"==e?this.theOne:this.parseCURIE(e,t,n)):this.parseCURIEOrURI(e,t,n)},r.RDFaProcessor.prototype.parseCURIE=function(e,t,n){var i=e.indexOf(":");if(i>=0){var o=e.substring(0,i);if(""==o){var s=t[""];return s?s+e.substring(i+1):null}if("_"==o)return"_:"+e.substring(i+1);if(r.RDFaProcessor.NCNAME.test(o)){var s=t[o];if(s)return s+e.substring(i+1)}}return null},r.RDFaProcessor.prototype.parseCURIEOrURI=function(e,t,r){var n=this.parseCURIE(e,t,r);return n?n:this.resolveAndNormalize(r,e)},r.RDFaProcessor.prototype.parsePredicate=function(e,t,r,n,i,o){if(""==e)return null;var s=this.parseTermOrCURIEOrAbsURI(e,t,o?null:r,n,i);return s&&0==s.indexOf("_:")?null:s},r.RDFaProcessor.prototype.parseTermOrCURIEOrURI=function(e,t,n,i,o){e=r.RDFaProcessor.trim(e);var s=this.parseCURIE(e,i,o);if(s)return s;var a=n[e];if(a)return a;var l=e.toLowerCase();return(a=n[l])?a:t&&!this.absURIRE.exec(e)?t+e:this.resolveAndNormalize(o,e)},r.RDFaProcessor.prototype.parseTermOrCURIEOrAbsURI=function(e,t,n,i,o){e=r.RDFaProcessor.trim(e);var s=this.parseCURIE(e,i,o);if(s)return s;if(n){if(t&&!this.absURIRE.exec(e))return t+e;var a=n[e];if(a)return a;var l=e.toLowerCase();if(a=n[l])return a}return this.absURIRE.exec(e)?this.resolveAndNormalize(o,e):null},r.RDFaProcessor.prototype.parsePrefixMappings=function(e,t){for(var n=this.tokenize(e),i=null,o=0;o<n.length;o++)":"==n[o][n[o].length-1]?i=n[o].substring(0,n[o].length-1):i&&(t[i]=this.options.base?r.uri.join(n[o],this.options.base):n[o],i=null)},r.RDFaProcessor.prototype.copyMappings=function(e){var t={};for(var r in e)t[r]=e[r];return t},r.RDFaProcessor.prototype.ancestorPath=function(e){for(var t="";e&&e.nodeType!=d.DOCUMENT_NODE;)t="/"+e.localName+t,e=e.parentNode;return t},r.RDFaProcessor.prototype.setContext=function(e){"html"==e.localName&&"XHTML+RDFa 1.1"==e.getAttribute("version")?this.setXHTMLContext():"html"==e.localName||"http://www.w3.org/1999/xhtml"==e.namespaceURI?"undefined"!=typeof document&&document.doctype?"-//W3C//DTD XHTML+RDFa 1.0//EN"==document.doctype.publicId&&"http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd"==document.doctype.systemId?(console.log("WARNING: RDF 1.0 is not supported.  Defaulting to HTML5 mode."),this.setHTMLContext()):"-//W3C//DTD XHTML+RDFa 1.1//EN"==document.doctype.publicId&&"http://www.w3.org/MarkUp/DTD/xhtml-rdfa-2.dtd"==document.doctype.systemId?this.setXHTMLContext():this.setHTMLContext():this.setHTMLContext():this.setXMLContext()},r.RDFaProcessor.prototype.setInitialContext=function(){this.vocabulary=null,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}]},r.RDFaProcessor.prototype.setXMLContext=function(){this.setInitialContext(),this.inXHTMLMode=!1,this.inHTMLMode=!1},r.RDFaProcessor.prototype.setHTMLContext=function(){this.setInitialContext(),this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"},{namespaceURI:null,localName:"lang"}],this.inXHTMLMode=!1,this.inHTMLMode=!0},r.RDFaProcessor.prototype.setXHTMLContext=function(){this.setInitialContext(),this.inXHTMLMode=!0,this.inHTMLMode=!1,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"},{namespaceURI:null,localName:"lang"}],this.target.graph.terms.alternate="http://www.w3.org/1999/xhtml/vocab#alternate",this.target.graph.terms.appendix="http://www.w3.org/1999/xhtml/vocab#appendix",this.target.graph.terms.bookmark="http://www.w3.org/1999/xhtml/vocab#bookmark",this.target.graph.terms.cite="http://www.w3.org/1999/xhtml/vocab#cite",this.target.graph.terms.chapter="http://www.w3.org/1999/xhtml/vocab#chapter",this.target.graph.terms.contents="http://www.w3.org/1999/xhtml/vocab#contents",this.target.graph.terms.copyright="http://www.w3.org/1999/xhtml/vocab#copyright",
this.target.graph.terms.first="http://www.w3.org/1999/xhtml/vocab#first",this.target.graph.terms.glossary="http://www.w3.org/1999/xhtml/vocab#glossary",this.target.graph.terms.help="http://www.w3.org/1999/xhtml/vocab#help",this.target.graph.terms.icon="http://www.w3.org/1999/xhtml/vocab#icon",this.target.graph.terms.index="http://www.w3.org/1999/xhtml/vocab#index",this.target.graph.terms.last="http://www.w3.org/1999/xhtml/vocab#last",this.target.graph.terms.license="http://www.w3.org/1999/xhtml/vocab#license",this.target.graph.terms.meta="http://www.w3.org/1999/xhtml/vocab#meta",this.target.graph.terms.next="http://www.w3.org/1999/xhtml/vocab#next",this.target.graph.terms.prev="http://www.w3.org/1999/xhtml/vocab#prev",this.target.graph.terms.previous="http://www.w3.org/1999/xhtml/vocab#previous",this.target.graph.terms.section="http://www.w3.org/1999/xhtml/vocab#section",this.target.graph.terms.stylesheet="http://www.w3.org/1999/xhtml/vocab#stylesheet",this.target.graph.terms.subsection="http://www.w3.org/1999/xhtml/vocab#subsection",this.target.graph.terms.start="http://www.w3.org/1999/xhtml/vocab#start",this.target.graph.terms.top="http://www.w3.org/1999/xhtml/vocab#top",this.target.graph.terms.up="http://www.w3.org/1999/xhtml/vocab#up",this.target.graph.terms.p3pv1="http://www.w3.org/1999/xhtml/vocab#p3pv1",this.target.graph.terms.related="http://www.w3.org/1999/xhtml/vocab#related",this.target.graph.terms.role="http://www.w3.org/1999/xhtml/vocab#role",this.target.graph.terms.transformation="http://www.w3.org/1999/xhtml/vocab#transformation"},r.RDFaProcessor.prototype.init=function(){},r.RDFaProcessor.prototype.newSubjectOrigin=function(e,t){console.log("@@@@ newSubjectOrigin @@ what should this do? ")},r.RDFaProcessor.prototype.addTriple=function(e,t,n,i){function o(e){if(console.log("convert term "+typeof e),"string"==typeof e)return console.log("    string is "+e),console.log("    sym is "+r.sym(e)),r.sym(e);if("undefined"!=typeof e){switch(console.log("    type is "+e.type),i.type){case r.RDFaProcessor.objectURI:return r.sym(e.value);case r.RDFaProcessor.PlainLiteralURI:return r.term(e.value)}throw"internal type "+e.type}}var s,a,l,h;s="undefined"==typeof t?r.sym(this.options.base):o(t),l=o(n),a=o(i),h=r.sym(this.options.base),console.log("Adding { "+s+" "+l+" "+a+" "+h+" }"),this.kb.add(s,l,a,h)},r.RDFaProcessor.prototype.resolveAndNormalize=function(e,t){return r.uri.join(e,t)},r.RDFaProcessor.prototype.parseURI=function(e){return e},r.RDFaProcessor.dateTimeTypes=[{pattern:/-?P(?:[0-9]+Y)?(?:[0-9]+M)?(?:[0-9]+D)?(?:T(?:[0-9]+H)?(?:[0-9]+M)?(?:[0-9]+(?:\.[0-9]+)?S)?)?/,type:"http://www.w3.org/2001/XMLSchema#duration"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]-[0-9][0-9]T(?:[0-1][0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9](?:\.[0-9]+)?(?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#dateTime"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]-[0-9][0-9](?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#date"},{pattern:/(?:[0-1][0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9](?:\.[0-9]+)?(?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#time"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]/,type:"http://www.w3.org/2001/XMLSchema#gYearMonth"},{pattern:/-?[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9]/,type:"http://www.w3.org/2001/XMLSchema#gYear"}],r.RDFaProcessor.deriveDateTimeType=function(e){for(var t=0;t<r.RDFaProcessor.dateTimeTypes.length;t++){var n=r.RDFaProcessor.dateTimeTypes[t].pattern.exec(e);if(n&&n[0].length==e.length)return r.RDFaProcessor.dateTimeTypes[t].type}return null},r.RDFaProcessor.prototype.process=function(e,t){console.log("node.baseURI 0 "+e.baseURI);var n;e.nodeType==d.DOCUMENT_NODE?(n=e.baseURI,e=e.documentElement,e.baseURI=n,this.setContext(e)):e.parentNode.nodeType==d.DOCUMENT_NODE&&this.setContext(e);var i=[],o=function(e){return e.split("#")[0]};for(console.log("node.baseURI 1 "+e.baseURI),i.push({current:e,context:this.push(null,o(e.baseURI))});i.length>0;){var s=i.shift();if(s.parent){if(s.context.parent&&s.context.parent.listMapping==s.listMapping)continue;for(var a in s.listMapping){var l=s.listMapping[a];if(0!=l.length){for(var h=[],c=0;c<l.length;c++)h.push(this.newBlankNode());for(var c=0;c<h.length;c++)this.addTriple(s.parent,h[c],"http://www.w3.org/1999/02/22-rdf-syntax-ns#first",l[c]),this.addTriple(s.parent,h[c],"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",{type:r.RDFaProcessor.objectURI,value:c+1<h.length?h[c+1]:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"});this.addTriple(s.parent,s.subject,a,{type:r.RDFaProcessor.objectURI,value:h[0]})}else this.addTriple(s.parent,s.subject,a,{type:r.RDFaProcessor.objectURI,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"})}}else{var u=s.current,p=s.context,f=!1,m=null,g=null,v=null,y=p.prefixes,w=!1,b=[],T=p.listMapping,x=!p.parent,N=p.language,R=p.vocabulary,n=this.parseURI(o(u.baseURI));u.item=null;var I=u.getAttributeNode("vocab");if(I){var k=r.RDFaProcessor.trim(I.value);if(k.length>0){R=k;var D=n.spec;this.addTriple(u,D,"http://www.w3.org/ns/rdfa#usesVocabulary",{type:r.RDFaProcessor.objectURI,value:R})}else R=this.vocabulary}for(var c=0;c<u.attributes.length;c++){var C=u.attributes[c];if("x"==C.nodeName.charAt(0)&&0==C.nodeName.indexOf("xmlns:")){w||(y=this.copyMappings(y),w=!0);var _=C.nodeName.substring(6),S=r.RDFaProcessor.trim(C.value);y[_]=this.options.base?r.uri.join(S,this.options.base):S}}var F=u.getAttributeNode("prefix");F&&(w||(y=this.copyMappings(y),w=!0),this.parsePrefixMappings(F.value,y));for(var O=null,c=0;!O&&c<this.langAttributes.length;c++)O=u.getAttributeNodeNS(this.langAttributes[c].namespaceURI,this.langAttributes[c].localName);if(O){var k=r.RDFaProcessor.trim(O.value);N=k.length>0?k:null}var U=u.getAttributeNode("rel"),M=u.getAttributeNode("rev"),E=u.getAttributeNode("typeof"),L=u.getAttributeNode("property"),A=u.getAttributeNode("datatype"),P=this.inHTMLMode?u.getAttributeNode("datetime"):null,j=u.getAttributeNode("content"),q=u.getAttributeNode("about"),H=u.getAttributeNode("src"),X=u.getAttributeNode("resource"),B=u.getAttributeNode("href"),W=u.getAttributeNode("inlist"),z=[];if(U)for(var V=this.tokenize(U.value),c=0;c<V.length;c++){var a=this.parsePredicate(V[c],R,p.terms,y,n,this.inHTMLMode&&null!=L);a&&z.push(a)}var Q=[];if(M)for(var V=this.tokenize(M.value),c=0;c<V.length;c++){var a=this.parsePredicate(V[c],R,p.terms,y,n,this.inHTMLMode&&null!=L);a&&Q.push(a)}!this.inHTMLMode||null==U&&null==M||null==L||(0==z.length&&(U=null),0==Q.length&&(M=null)),U||M?(q&&(m=this.parseSafeCURIEOrCURIEOrURI(q.value,y,n)),E&&(v=m),m||(u.parentNode.nodeType==d.DOCUMENT_NODE?(console.log("kjkhk current.baseURI "+u.baseURI),m=o(u.baseURI)):p.parentObject&&(console.log("zxcv current.baseURI "+u.parentNode.baseURI),m=o(u.parentNode.baseURI)==p.parentObject?o(u.baseURI):p.parentObject)),X&&(g=this.parseSafeCURIEOrCURIEOrURI(X.value,y,n)),g||(B?g=this.resolveAndNormalize(n,encodeURI(B.value)):H?g=this.resolveAndNormalize(n,encodeURI(H.value)):!E||q||this.inXHTMLMode&&("head"==u.localName||"body"==u.localName)||(g=this.newBlankNode())),!E||q||!this.inXHTMLMode||"head"!=u.localName&&"body"!=u.localName?E&&!q&&(v=g):v=m):!L||j||A?(q&&(m=this.parseSafeCURIEOrCURIEOrURI(q.value,y,n)),!m&&X&&(m=this.parseSafeCURIEOrCURIEOrURI(X.value,y,n)),!m&&B&&(m=this.resolveAndNormalize(n,encodeURI(B.value))),!m&&H&&(m=this.resolveAndNormalize(n,encodeURI(H.value))),m||(u.parentNode.nodeType==d.DOCUMENT_NODE?m=o(u.baseURI):!this.inXHTMLMode&&!this.inHTMLMode||"head"!=u.localName&&"body"!=u.localName?E?m=this.newBlankNode():p.parentObject&&(m=o(u.parentNode.baseURI)==p.parentObject?o(u.baseURI):p.parentObject,L||(f=!0)):m=o(u.parentNode.baseURI)==p.parentObject?o(u.baseURI):p.parentObject),E&&(v=m)):(q&&(m=this.parseSafeCURIEOrCURIEOrURI(q.value,y,n),E&&(v=m)),m||u.parentNode.nodeType!=d.DOCUMENT_NODE?!m&&p.parentObject&&(m=o(u.parentNode.baseURI)==p.parentObject?o(u.baseURI):p.parentObject):(m=o(u.baseURI),E&&(v=m)),E&&!v&&(X&&(v=this.parseSafeCURIEOrCURIEOrURI(X.value,y,n)),!v&&B&&(v=this.resolveAndNormalize(n,encodeURI(B.value))),!v&&H&&(v=this.resolveAndNormalize(n,encodeURI(H.value))),v||!this.inXHTMLMode&&!this.inHTMLMode||"head"!=u.localName&&"body"!=u.localName||(v=m),v||(v=this.newBlankNode()),g=v));if(m&&(q||X||v)){var $=m;E&&!q&&!X&&g&&($=g),console.log("Setting data attribute for "+u.localName+" for subject "+$),this.newSubjectOrigin(u,$)}if(v)for(var V=this.tokenize(E.value),c=0;c<V.length;c++){var Y=this.parseTermOrCURIEOrAbsURI(V[c],R,p.terms,y,n);Y&&this.addTriple(u,v,r.RDFaProcessor.typeURI,{type:r.RDFaProcessor.objectURI,value:Y})}if(m&&m!=p.parentObject&&(T={},x=!0),g){if(U&&W)for(var c=0;c<z.length;c++){var l=T[z[c]];l||(l=[],T[z[c]]=l),l.push({type:r.RDFaProcessor.objectURI,value:g})}else if(U)for(var c=0;c<z.length;c++)this.addTriple(u,m,z[c],{type:r.RDFaProcessor.objectURI,value:g});if(M)for(var c=0;c<Q.length;c++)this.addTriple(u,g,Q[c],{type:r.RDFaProcessor.objectURI,value:m})}else{if(m&&!g&&(U||M)&&(g=this.newBlankNode()),U&&W)for(var c=0;c<z.length;c++){var l=T[z[c]];l||(l=[],T[a]=l),b.push({predicate:z[c],list:l})}else if(U)for(var c=0;c<z.length;c++)b.push({predicate:z[c],forward:!0});if(M)for(var c=0;c<Q.length;c++)b.push({predicate:Q[c],forward:!1})}if(L){var G=null,Z=null;A?(G=""==A.value?r.RDFaProcessor.PlainLiteralURI:this.parseTermOrCURIEOrAbsURI(A.value,R,p.terms,y,n),Z=P&&!j?P.value:G==r.RDFaProcessor.XMLLiteralURI||G==r.RDFaProcessor.HTMLLiteralURI?null:j?j.value:u.textContent):j?(G=r.RDFaProcessor.PlainLiteralURI,Z=j.value):P?(Z=P.value,G=r.RDFaProcessor.deriveDateTimeType(Z),G||(G=r.RDFaProcessor.PlainLiteralURI)):U||M||(X&&(Z=this.parseSafeCURIEOrCURIEOrURI(X.value,y,n)),!Z&&B?Z=this.resolveAndNormalize(n,encodeURI(B.value)):!Z&&H&&(Z=this.resolveAndNormalize(n,encodeURI(H.value))),Z&&(G=r.RDFaProcessor.objectURI)),G||(E&&!q?(G=r.RDFaProcessor.objectURI,Z=v):(Z=u.textContent,this.inHTMLMode&&"time"==u.localName&&(G=r.RDFaProcessor.deriveDateTimeType(Z)),G||(G=r.RDFaProcessor.PlainLiteralURI)));for(var V=this.tokenize(L.value),c=0;c<V.length;c++){var a=this.parsePredicate(V[c],R,p.terms,y,n);if(a)if(W){var l=T[a];l||(l=[],T[a]=l),l.push(G==r.RDFaProcessor.XMLLiteralURI||G==r.RDFaProcessor.HTMLLiteralURI?{type:G,value:u.childNodes}:{type:G?G:r.RDFaProcessor.PlainLiteralURI,value:Z,language:N})}else G==r.RDFaProcessor.XMLLiteralURI||G==r.RDFaProcessor.HTMLLiteralURI?this.addTriple(u,m,a,{type:G,value:u.childNodes}):this.addTriple(u,m,a,{type:G?G:r.RDFaProcessor.PlainLiteralURI,value:Z,language:N})}}if(m&&!f)for(var c=0;c<p.incomplete.length;c++)p.incomplete[c].list?p.incomplete[c].list.push({type:r.RDFaProcessor.objectURI,value:m}):p.incomplete[c].forward?this.addTriple(u,p.subject,p.incomplete[c].predicate,{type:r.RDFaProcessor.objectURI,value:m}):this.addTriple(u,m,p.incomplete[c].predicate,{type:r.RDFaProcessor.objectURI,value:p.subject});var K=null,J=m;f?(K=this.push(p,p.subject),K.parentObject=o(u.parentNode.baseURI)==p.parentObject?o(u.baseURI):p.parentObject,K.incomplete=p.incomplete,K.language=N,K.prefixes=y,K.vocabulary=R):(K=this.push(p,m),K.parentObject=g?g:m?m:p.subject,K.prefixes=y,K.incomplete=b,g&&(J=g,T={},x=!0),K.listMapping=T,K.language=N,K.vocabulary=R),x&&(console.log("Pushing list parent "+u.localName),i.unshift({parent:u,context:p,subject:J,listMapping:T}));for(var ee=u.lastChild;ee;ee=ee.previousSibling)ee.nodeType==d.ELEMENT_NODE&&(ee.baseURI=u.baseURI,i.unshift({current:ee,context:K}))}}this.inHTMLMode&&this.copyProperties();for(var c=0;c<this.finishedHandlers.length;c++)this.finishedHandlers[c](e)},r.RDFaProcessor.prototype.copyProperties=function(){},r.RDFaProcessor.prototype.push=function(e,t){return{parent:e,subject:t?t:e?e.subject:null,parentObject:null,incomplete:[],listMapping:e?e.listMapping:{},language:e?e.language:this.language,prefixes:e?e.prefixes:this.target.graph.prefixes,terms:e?e.terms:this.target.graph.terms,vocabulary:e?e.vocabulary:this.vocabulary}},r.parseDOM_RDFa=function(e,t,n){var i=new r.RDFaProcessor(t,{base:n});e.baseURI=n,console.log(" $rdf.parseDOM_RDFa dom.baseURI = "+e.baseURI),i.process(e)},r.sparqlUpdateParser=function(e,t,n){var i,o,s,a=["INSERT","DELETE","WHERE"],l=r.Namespace("http://www.w3.org/ns/pim/patch#"),h=r.N3Parser(t,t,n,n,null,null,"",null),c={},u=function(e,t,r,n,i){return"Line "+(t+1)+" of <"+e+">: Bad syntax:\n   "+i+'\n   at: "'+r.slice(n,n+30)+'"'};i=0;var d=t.sym(n+"#query");for(c.query=d;;){var o=h.skipSpace(e,i);if(0>o)return c;if(";"===e[o]){if(i=h.skipSpace(e,o+1),0>i)return c;o=i}var p=!1;for(s=0;s<a.length;s++){var f=a[s];if(e.slice(o,o+f.length)===f){if(i=h.skipSpace(e,o+f.length),0>i)throw u(h._thisDoc,h.lines,e,o+f.length,"found EOF, needed {...} after "+f);if(("INSERT"===f||"DELETE"===f)&&"DATA"===e.slice(i,i+4)){if(o=h.skipSpace(e,i+4),0>o)throw u(h._thisDoc,h.lines,e,i+4,"needed {...} after INSERT DATA "+f);i=o}var m=[];if(o=h.node(e,i,m),0>o)throw u(h._thisDoc,h.lines,e,i,"bad syntax or EOF in {...} after "+f);c[f.toLowerCase()]=m[0],t.add(d,l(f.toLowerCase()),m[0]),p=!0,i=o}}if(!p&&"@prefix"===e.slice(o,o+7)){var i=h.directive(e,o);if(0>i)throw u(h._thisDoc,h.lines,e,i,"bad syntax or EOF after @prefix ");i=h.checkDot(e,i),p=!0}if(!p)throw u(h._thisDoc,h.lines,e,o,"Unknown syntax at start of statememt: '"+e.slice(o).slice(0,20)+"'")}},r.IndexedFormula.prototype.applyPatch=function(e,t,n){var i=this,o=function(r){if(e["delete"]){var o=e["delete"];s&&(o=o.substitute(s)),o=o.statements;var a=[],l=o.map(function(e){var r=i.statementsMatching(e.subject,e.predicate,e.object,t);return 0===r.length?(a.push(e),null):r[0]});if(a.length)return n("Couldn't find to delete: "+a[0]);l.map(function(e){i.remove(e)})}if(e.insert){var o=e.insert;s&&(o=o.substitute(s)),o=o.statements,o.map(function(e){e.why=t,i.add(e.subject,e.predicate,e.object,e.why)})}r()},s=null;if(e.where){var a=new r.Query("patch");a.pat=e.where,a.pat.statements.map(function(e){e.why=t});var l=[];i.query(a,function(e){l.push(e)},i.fetcher,function(){return 0==l.length?n("No match found to be patched:"+e.where):l.length>1?n("Patch ambiguous. No patch done."):(s=l[0],void o(n))})}else o(n)},r.Query=function(e,t){this.pat=new r.IndexedFormula,this.vars=[],this.name=e,this.id=t},r.QuerySource=function(){this.queries=[],this.listeners=[],this.addQuery=function(e){var t;for(null!==e.name&&""!==e.name||(e.name="Query #"+(this.queries.length+1)),e.id=this.queries.length,this.queries.push(e),t=0;t<this.listeners.length;t++)null!==this.listeners[t]&&this.listeners[t].addQuery(e)},this.removeQuery=function(e){var t;for(t=0;t<this.listeners.length;t++)null!==this.listeners[t]&&this.listeners[t].removeQuery(e);null!==this.queries[e.id]&&delete this.queries[e.id]},this.addListener=function(e){var t;for(this.listeners.push(e),t=0;t<this.queries.length;t++)null!==this.queries[t]&&e.addQuery(this.queries[t])},this.removeListener=function(e){var t;for(t=0;t<this.queries.length;t++)null!==this.queries[t]&&e.removeQuery(this.queries[t]);for(t=0;t<this.listeners.length;t++)this.listeners[t]===e&&delete this.listeners[t]}},r.Variable.prototype.isVar=1,r.BlankNode.prototype.isVar=1,r.BlankNode.prototype.isBlank=1,r.NamedNode.prototype.isVar=0,r.Literal.prototype.isVar=0,r.Formula.prototype.isVar=0,r.Collection.prototype.isVar=0,r.IndexedFormula.prototype.query=function(e,t,n,i){function o(e,t){return e.nvars!==t.nvars?e.nvars-t.nvars:e.index.length-t.index.length}var s=function(e){var t,r="";for(t in e)e.hasOwnProperty(t)&&(r+="    "+t+" -> "+e[t]);return r},a=function(e){var t,r="Bindings: ",n=e.length;for(t=0;n>t;t++)r+=s(e[t][0])+";\n	";return r},l=function(e,t,r,n){var i=r[e];if(void 0===i){if(e.isVar){var o=[];return o[e]=t,[[o,null]]}i=e}if(!i.complexType)return n.redirections[i]&&(i=n.redirections[i]),n.redirections[t]&&(t=n.redirections[t]),i.sameTerm(t)?[[[],null]]:[];if(e instanceof Array)return t instanceof Array?h(e,t,r):[];throw new Error("query.js: oops - code not written yet")},h=function(e,t,r,n){var i;if(e.length!==t.length)return[];if(!e.length)return[[[],null]];var o=l(e[0],t[0],r,n);if(0===o.length)return o;var s,a,c,u,d,p,f,m=[],g=o.length;for(s=0;g>s;s++){a=o[s][0],f=[];for(d in a)a.hasOwnProperty(d)&&(f[d]=a[d]);for(d in r)r.hasOwnProperty(d)&&(f[d]=r[d]);for(i=h(e.slice(1),t.slice(1),f,n),u=i.length,c=0;u>c;c++){p=i[c][0];for(d in a)a.hasOwnProperty(d)&&(p[d]=a[d]);m.push([p,null])}}return m},c=function(e,t){var r=t[e];return void 0===r?e:r},u=function(e,t){var r,n={};for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);for(r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n},d=function(e,t){return this.trunkBindings=t,this.originalCallback=e,this.branches=[],this};d.prototype.checkAllDone=function(){var e;for(e=0;e<this.branches.length;e++)if(!this.branches[e].done)return;r.log.debug("OPTIONAL BIDNINGS ALL DONE:"),this.doCallBacks(this.branches.length-1,this.trunkBindings)},d.prototype.doCallBacks=function(e,t){var r;if(0>e)return this.originalCallback(t);for(r=0;r<this.branches[e].results.length;r++)this.doCallBacks(e-1,u(t,this.branches[e].results[r]))};var p=function(e,t){return this.count=0,this.success=!1,this.done=!1,this.callback=e,this.onDone=t,this};p.prototype.reportMatch=function(e){this.callback(e),this.success=!0},p.prototype.reportDone=function(){this.done=!0,r.log.info("Mandatory query branch finished.***"),void 0!==this.onDone&&this.onDone()};var f=function(e){return this.count=0,this.done=!1,this.results=[],this.junction=e,e.branches.push(this),this};f.prototype.reportMatch=function(e){this.results.push(e)},f.prototype.reportDone=function(){r.log.debug("Optional branch finished - results.length = "+this.results.length),0===this.results.length&&(this.results.push({}),r.log.debug("Optional branch FAILED - that's OK.")),this.done=!0,this.junction.checkAllDone()};var m=function(e,t,r){var n,i,o,s,a;for(t.nvars=0,t.index=null,i=[t.subject,t.predicate,t.object],a=[e.subjectIndex,e.predicateIndex,e.objectIndex],s=0;3>s;s++)if(i[s].isVar&&void 0===r[i[s]])t.nvars++;else{if(n=c(i[s],r),e.redirections[n.hashString()]&&(n=e.redirections[n.hashString()]),o=a[s][n.hashString()],!o)return t.index=[],!1;(null===t.index||t.index.length>o.length)&&(t.index=o)}return null===t.index&&(t.index=e.statements),!0},g=0,v=function(e,n,i,o,a,l,h){r.log.debug("Match begins, Branch count now: "+h.count+" for "+h.pattern_debug);var c=e.fetcher?e.fetcher:null,u=n.statements;if(0===u.length){if(r.log.debug("FOUND MATCH WITH BINDINGS:"+s(i)),0===n.optional.length)h.reportMatch(i);else{r.log.debug("OPTIONAL: "+n.optional);var p,m=new d(t,i),y=[];for(p=0;p<n.optional.length;p++)y[p]=new f(m),y[p].pattern_debug=n.optional[p];for(p=0;p<n.optional.length;p++)y[p].count=y[p].count+1,v(e,n.optional[p],i,"",a,t,y[p])}return h.count--,void r.log.debug("Match ends -- success , Branch count now: "+h.count+" for "+h.pattern_debug)}var b,T,x=u.length;if(c){var N="match"+g++,R=function(t,r){var s=t.uri.split("#")[0];c.nowOrWhenFetched(s,void 0,function(r,s,c){r&&console.log("Error following link to <"+t.uri+"> in query: "+s),v(e,n,i,o,a,l,h)})};for(T=0;x>T;T++){if(b=u[T],void 0!==i[b.subject]&&i[b.subject].uri&&c&&"unrequested"===c.getState(r.Util.uri.docpart(i[b.subject].uri)))return void R(i[b.subject],N);if(void 0!==i[b.object]&&i[b.object].uri&&c&&"unrequested"===c.getState(r.Util.uri.docpart(i[b.object].uri)))return void R(i[b.object],N)}}w(e,n,i,o,a,l,h)},y=function(e,t){var r,n,i=!0;for(r in e)e.hasOwnProperty(r)&&t[r]&&(n=t[r].test,n&&!n(e[r])&&(i=!1));return i},w=function(e,t,n,i,l,c,u){var d,p,f,g,w,b,T,x=t.statements,N=x.length;for(d=0;N>d;d++)T=x[d],r.log.info("match2: item="+T+", bindingsSoFar="+s(n)),m(e,T,n);x.sort(o),T=x[0];var R=e.formula();R.optional=t.optional,R.constraints=t.constraints,R.statements=x.slice(1),r.log.debug(i+"match2 searching "+T.index.length+" for "+T+"; bindings so far="+s(n));var I,k,D,C=T.index.length,_=0;for(I=0;C>I;I++)for(D=T.index[I],k=h([T.subject,T.predicate,T.object],[D.subject,D.predicate,D.object],n,e),r.log.info(i+" From first: "+k.length+": "+a(k)),f=k.length,p=0;f>p;p++)if(w=[],b=k[p][0],y(b,t.constraints)){for(g in b)b.hasOwnProperty(g)&&(w[g]=b[g]);for(g in n)n.hasOwnProperty(g)&&(w[g]=n[g]);u.count++,_++,v(e,R,w,i+"  ",l,c,u)}else r.log.debug("Branch count CS: "+u.count);u.count--,0===_&&r.log.debug("Match2 fails completely on "+T),r.log.debug("Match2 ends, Branch count: "+u.count+" for "+u.pattern_debug),0===u.count&&(r.log.debug("Branch finished."),u.reportDone())},b=this;r.log.debug("Query on "+this.statements.length);var T=new p(t,i);T.count++,setTimeout(function(){v(b,e.pat,e.pat.initBindings,"",n,t,T)},0)},r.queryToSPARQL=function(e){function t(e){for(var t=a()+"SELECT ",r=0;r<e.vars.length;r++)t+=e.vars[r]+" ";return t+="\n"}function n(e){var t="",n=e.statements;for(var i in n)r.log.debug("Found statement: "+n),t+=a()+n[i]+"\n";return t}function i(e){var t="";for(var r in e.constraints){var n=e.constraints[r];t+=a()+"FILTER ( "+n.describe(r)+" ) \n"}return t}function o(e){for(var t="",s=0;s<e.optional.length;s++)r.log.debug("Found optional query"),t+=a()+"OPTIONAL { \n",h++,t+=n(e.optional[s]),t+=i(e.optional[s]),t+=o(e.optional[s]),h--,t+=a()+"}\n";return t}function s(e){var t=a()+"WHERE \n{ \n";return h++,t+=n(e),t+=i(e),t+=o(e),h--,t+="}"}function a(){for(var e="",t=0;h>t;t++)e+="    ";return e}function l(e){return t(e)+s(e.pat)}var h=0;return l(e)},r.SPARQLToQuery=function(e,t,n){function i(e){if(U[e])return U[e];var t=n.variable(e);return U[e]=t,t}function o(e){return"string"==typeof e&&e.match(/[^ \n\t]/)}function s(e){return"string"==typeof e&&e.match(/^[\?\$]/)}function a(e){return"string"==typeof e?e.replace(/^&lt;/,"<").replace(/&gt;$/,">"):e}function l(e){return"string"==typeof e&&e.match(/^<[^>]*>$/)}function h(e){return"string"==typeof e&&(e.match(/^_:/)||e.match(/^$/))}function c(e){return"string"==typeof e&&e.match(/:$/)}function u(e){return"string"==typeof e&&e.match(/^:|^[^_][^:]*:/)}function d(e){var t=e.split(":");return t[0]}function p(e){var t=e.split(":");return t[1]}function f(e){return l(e)?e.slice(1,e.length-1):e}function m(e){var t=-1===e.indexOf("'")?null:e.indexOf("'"),i=-1===e.indexOf('"')?null:e.indexOf('"');if(!t&&!i){var o=new Array(1);return o[0]=e,o}var s,a,l=new Array(2);if(!t||i&&t>i)s='"',a=i;else{if(i&&!(t&&i>t))return r.log.error("SQARQL QUERY OOPS!"),l;s="'",a=t}l[0]=e.slice(0,a);var h=e.slice(a+1).indexOf(s);if(-1===h)return r.log.error("SPARQL parsing error: no matching parentheses in literal "+e),e;var c;return e.slice(h+a+2).match(/^\^\^/)?(c=e.slice(h+a+2).indexOf(" "),l[1]=n.literal(e.slice(a+1,a+1+h),"",n.sym(f(e.slice(a+4+h,a+2+h+c)))),l=l.concat(m(e.slice(h+a+3+c)))):e.slice(h+a+2).match(/^@/)?(c=e.slice(h+a+2).indexOf(" "),l[1]=n.literal(e.slice(a+1,a+1+h),e.slice(a+3+h,a+2+h+c),null),l=l.concat(m(e.slice(h+a+2+c)))):(l[1]=n.literal(e.slice(a+1,a+1+h),"",null),r.log.info("Literal found: "+l[1]),l=l.concat(m(e.slice(h+a+2)))),l}function g(e){e=e.replace(/\(/g," ( ").replace(/\)/g," ) ").replace(/</g," <").replace(/>/g,"> ").replace(/{/g," { ").replace(/}/g," } ").replace(/[\t\n\r]/g," ").replace(/; /g," ; ").replace(/\. /g," . ").replace(/, /g," , "),r.log.info("New str into spaceDelimit: \n"+e);var t=[],n=e.split(" ");for(var i in n)o(n[i])&&(t=t.concat(n[i]));return t}function v(e){for(var t=e,r=0;r<t.length;r++)if("a"===t[r]&&(t[r]="<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>"),"is"===t[r]&&"of"===t[r+2]){t.splice(r,1),t.splice(r+1,1);var n=t[r-1];t[r-1]=t[r+1],t[r+1]=n}return t}function y(e){for(var t=[],o=0;o<e.length;o++)"string"==typeof e[o]?(e[o]=a(e[o]),s(e[o])?t[o]=i(e[o].slice(1)):h(e[o])?(r.log.info(e[o]+" was identified as a bnode."),t[o]=n.bnode()):l(e[o])?(r.log.info(e[o]+" was identified as a symbol."),t[o]=n.sym(f(e[o]))):u(e[o])?(r.log.info(e[o]+" was identified as a prefixed symbol"),L[d(e[o])]?t[o]=n.sym(e[o]=L[d(e[o])]+p(e[o])):(r.log.error("SPARQL error: "+e[o]+" with prefix "+d(e[o])+" does not have a correct prefix entry."),t[o]=e[o])):t[o]=e[o]):t[o]=e[o];return t}function w(e){var t=m(e),n=[];for(var i in t)n="string"==typeof t[i]?n.concat(g(t[i])):n.concat(t[i]);return n=v(n),r.log.info("SPARQL Tokens: "+n),n}function b(e,t){for(var r=0;r<t.length;r++)if("string"==typeof t[r]&&t[r].toLowerCase()===e.toLowerCase())return r;return null}function T(e,t){for(var r=[],n=0;n<t.length;n++)"string"==typeof t[n]&&t[n].toLowerCase()===e.toLowerCase()&&r.push(n);return r}function x(e,t){r.log.info("SPARQL vars: "+e);for(var n in e)if(s(e[n])){r.log.info("Added "+e[n]+" to query variables from SPARQL");var o=i(e[n].slice(1));t.vars.push(o),o.label=e[n].slice(1)}else r.log.warn("Incorrect SPARQL variable in SELECT: "+e[n])}function N(e){var t=T("PREFIX",e),n=[];for(var i in t){var o=e[t[i]+1],s=e[t[i]+2];if(c(o))if(l(s)){r.log.info("Prefix found: "+o+" -> "+s);var a=d(o),h=f(s);n[a]=h}else r.log.error("Invalid SPARQL symbol: "+s);else r.log.error("Invalid SPARQL prefix: "+o)}return n}function R(e,t,n){r.log.info("Looking for a close bracket of type "+n+" in "+e);for(var i=0,o=0;o<e.length;o++)if(e[o]===t&&i++,e[o]===n&&i--,0>i)return o;return r.log.error("Statement had no close parenthesis in SPARQL query"),0}function I(e){return this.describe=function(t){return t+" > "+e.toNT()},this.test=function(t){return t.value.match(/[0-9]+(\.[0-9]+)?([eE][+-]?[0-9]+)?/)?parseFloat(t.value)>parseFloat(e):t.toNT()>e.toNT()},this}function k(e){return this.describe=function(t){return t+" < "+e.toNT()},this.test=function(t){return t.value.match(/[0-9]+(\.[0-9]+)?([eE][+-]?[0-9]+)?/)?parseFloat(t.value)<parseFloat(e):t.toNT()<e.toNT()},this}function D(e){return this.describe=function(t){return t+" = "+e.toNT()},this.test=function(t){return e.sameTerm(t)},this}function C(e){this.describe=function(t){return"REGEXP( '"+e+"' , "+t+" )"},this.test=function(t){var r=e,n=new RegExp(r);return t.value?n.test(t.value):!1}}function _(e,t){3!==e.length||"variable"!==e[0].termType||"symbol"!==e[2].termType&&"literal"!==e[2].termType?6===e.length&&"string"==typeof e[0]&&"regexp"===e[0].toLowerCase()&&"("===e[1]&&")"===e[5]&&","===e[3]&&"variable"===e[4].termType&&"literal"===e[2].termType&&(r.log.debug("Constraint added: "+e),t.constraints[e[4]]=new C(e[2].value)):"="===e[1]?(r.log.debug("Constraint added: "+e),t.constraints[e[0]]=new D(e[2])):">"===e[1]?(r.log.debug("Constraint added: "+e),t.constraints[e[0]]=new I(e[2])):"<"===e[1]?(r.log.debug("Constraint added: "+e),t.constraints[e[0]]=new k(e[2])):r.log.warn("I don't know how to handle the constraint: "+e)}function S(e,t){r.log.debug("Optional query: "+e+" not yet implemented.");var i=n.formula();F(e,i),t.optional.push(i)}function F(e,t){var n,i=y(e);r.log.debug("WHERE: "+i);for(var o;b("OPTIONAL",i);)o=b("OPTIONAL",i),r.log.debug("OPT: "+o+" "+i[o]+" in "+i),"{"!==i[o+1]&&r.log.warn("Bad optional opening bracket in word "+o),n=R(i.slice(o+2),"{","}"),-1===n?r.log.error("No matching bracket in word "+o):(S(i.slice(o+2,o+2+n),t),o=b("OPTIONAL",i),n=R(i.slice(o+2),"{","}"),i.splice(o,n+3));for(r.log.debug("WHERE after optionals: "+i);b("FILTER",i);){var s=b("FILTER",i);"("!==i[s+1]&&r.log.warn("Bad filter opening bracket in word "+s),n=R(i.slice(s+2),"(",")"),-1===n?r.log.error("No matching bracket in word "+s):(_(i.slice(s+2,s+2+n),t),s=b("FILTER",i),n=R(i.slice(s+2),"(",")"),i.splice(s,n+3))}r.log.debug("WHERE after filters and optionals: "+i),O(i,t)}function O(e,t){var n=new Array(1);n[0]=-1;for(var i=n.concat(T(".",e)),o=[],s=0;s<i.length-1;s++)o[s]=e.slice(i[s]+1,i[s+1]);for(s in o){r.log.info("s+p+o "+s+" = "+o[s]);var a=o[s][0];o[s].splice(0,1);var l=n.concat(T(";",o[s]));l.push(o[s].length);for(var h=[],c=0;c<l.length-1;c++)h[c]=o[s].slice(l[c]+1,l[c+1]);for(s in h){r.log.info("p+o "+s+" = "+o[s]);var u=h[s][0];h[s].splice(0,1);var d=n.concat(T(",",h[s]));d.push(h[s].length);var p=[];for(c=0;c<d.length-1;c++)p[c]=h[s].slice(d[c]+1,d[c+1]);for(s in p){var f=p[s][0];r.log.info("Subj="+a+" Pred="+u+" Obj="+f),t.add(a,u,f)}}}}var U=[];r.log.info("SPARQL input: \n"+e);var M=new r.Query,E=w(e),L=N(E);L.rdf||(L.rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"),L.rdfs||(L.rdfs="http://www.w3.org/2000/01/rdf-schema#");var A=b("SELECT",E),P=b("WHERE",E);if(0>A||0>P||A>P)return r.log.error("Invalid or nonexistent SELECT and WHERE tags in SPARQL query"),!1;if(x(E.slice(A+1,P),M),F(E.slice(P+2,E.length-1),M.pat),t)return M;for(var j in M.pat.statements){var q=M.pat.statements[j];"symbol"===q.subject.termType&&r.fetcher&&r.fetcher.lookUpThing(q.subject,"sparql:"+q.subject),"symbol"===q.object.termType&&r.fetcher&&r.fetcher.lookUpThing(q.object,"sparql:"+q.object)}return M},r.SPARQLResultsInterpreter=function(e,t,n){function i(e){return"string"==typeof e&&e.match(/^:|^[^_][^:]*:/)}function o(e){var t=e.split(":");return t[0]}function s(e){var t=e.split(":");return t[1]}function a(e){if(!e.name.match(/^xmlns/))return!1;var t=e.name.replace(/^xmlns/,"").replace(/^:/,"").replace(/ /g,"");p[t]=e.value,r.log.info("Prefix: "+t+"\nValue: "+e.value)}function l(e){var t,n;return i(e)?(t=o(e),n=s(e)):(t="",n=e),p[t]?p[t]+n:void r.log.error("Incorrect SPARQL results - bad prefix")}function h(e){for(var t=e.childNodes[0],n=0;n<e.childNodes.length;n++)if(3===e.childNodes[n].nodeType){t=e.childNodes[n];break}return l(e.nodeName)===g+"uri"?kb.sym(t.nodeValue):l(e.nodeName)===g+"literal"?kb.literal(t.nodeValue):l(e.nodeName)===g+"unbound"?"unbound":(r.log.warn("Don't know how to handle xml binding term "+e),!1)}function c(e){for(var n=[],i=!1,o=0;o<e.childNodes.length;o++)if(1===e.childNodes[o].nodeType)if(l(e.childNodes[o].nodeName)===g+"binding"){for(var s=e.childNodes[o],a=makeVar(s.getAttribute("name")),c=null,u=0;u<s.childNodes.length;u++)if(1===s.childNodes[u].nodeType){c=h(s.childNodes[u]);break}if(!c)return r.log.warn("Bad binding"),!1;r.log.info("var: "+a+" binding: "+c),i=!0,"unbound"!==c&&(n[a]=c)}else r.log.warn("Bad binding node inside result");i&&t&&setTimeout(function(){t(n)},0),f.push(n)}var u,d,p=[],f=[],m=e.childNodes[0],g="http://www.w3.org/2005/sparql-results#";p[""]="";var v;if("sparql"!==m.nodeName)return void r.log.error("Bad SPARQL results XML");for(v=0;v<m.attributes.length;v++)a(m.attributes[v]);for(v=0;v<m.childNodes.length;v++)r.log.info("Type: "+m.childNodes[v].nodeType+"\nName: "+m.childNodes[v].nodeName+"\nValue: "+m.childNodes[v].nodeValue),1===m.childNodes[v].nodeType&&l(m.childNodes[v].nodeName)===g+"head"?u=m.childNodes[v]:1===m.childNodes[v].nodeType&&l(m.childNodes[v].nodeName)===g+"results"&&(d=m.childNodes[v]);if(!d&&!u)return void r.log.error("Bad SPARQL results XML");for(v=0;v<u.childNodes.length;v++)1===u.childNodes[v].nodeType&&l(u.childNodes[v].nodeName)===g+"variable"&&r.log.info("Var: "+u.childNodes[v].getAttribute("name"));for(v=0;v<d.childNodes.length;v++)l(d.childNodes[v].nodeName)===g+"result"&&(r.log.info("Result # "+v),c(d.childNodes[v]));return n&&n(),f},r.UpdateManager=function(){var e=function(e){this.store=e,this.ifps={},this.fps={},this.ns={},this.ns.link=r.Namespace("http://www.w3.org/2007/ont/link#"),this.ns.http=r.Namespace("http://www.w3.org/2007/ont/http#"),this.ns.httph=r.Namespace("http://www.w3.org/2007/ont/httph#"),this.ns.ldp=r.Namespace("http://www.w3.org/ns/ldp#"),this.ns.rdf=r.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.ns.rdfs=r.Namespace("http://www.w3.org/2000/01/rdf-schema#"),this.ns.rdf=r.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.ns.owl=r.Namespace("http://www.w3.org/2002/07/owl#"),this.patchControl=[]};return e.prototype.patchControlFor=function(e){return this.patchControl[e.uri]||(this.patchControl[e.uri]=[]),this.patchControl[e.uri]},e.prototype.editable=function(e,t){if(!e)return!1;if(t||(t=tabulator.kb),"file:///"===e.slice(0,8)){if(t.holds(t.sym(e),tabulator.ns.rdf("type"),tabulator.ns.link("MachineEditableDocument")))return"LOCALFILE";
var n=t.statementsMatching(t.sym(e),void 0,void 0);return console.log("sparql.editable: Not MachineEditableDocument file "+e+"\n"),console.log(n.map(function(e){return e.toNT()}).join("\n")),!1}var i,o=!1,s=t.each(void 0,this.ns.link("requestedURI"),r.uri.docpart(e));if(t.holds(r.sym(e),this.ns.rdf("type"),this.ns.ldp("Resource")))return"SPARQL";for(var a,l,h=0;h<s.length;h++)if(i=s[h],void 0!==i){var c=t.any(i,this.ns.link("response"));if(void 0!==i){var u=t.each(c,this.ns.httph("accept-patch"));if(u.length)for(a=0;a<u.length;a++)if(l=u[a].value.trim(),l.indexOf("application/sparql-update")>=0)return"SPARQL";var d=t.each(c,this.ns.httph("ms-author-via"));if(d.length)for(a=0;a<d.length;a++){if(l=d[a].value.trim(),l.indexOf("SPARQL")>=0)return"SPARQL";if(l.indexOf("DAV")>=0)return"DAV"}var p=t.each(c,this.ns.http("status"));if(p.length)for(a=0;a<p.length;a++)200!==p[a]&&404!==p[a]||(o=!0)}else console.log("sparql.editable: No response for "+e+"\n")}if(0===s.length)console.log("sparql.editable: No request for "+e+"\n");else if(o)return!1;console.log("sparql.editable: inconclusive for "+e+"\n")},e.prototype.anonymize=function(e){return"_:"===e.toNT().substr(0,2)&&this._mentioned(e)?"?"+e.toNT().substr(2):e.toNT()},e.prototype.anonymizeNT=function(e){return this.anonymize(e.subject)+" "+this.anonymize(e.predicate)+" "+this.anonymize(e.object)+" ."},e.prototype._statement_bnodes=function(e){return[e.subject,e.predicate,e.object].filter(function(e){return e.isBlank})},e.prototype._statement_array_bnodes=function(e){for(var t=[],r=0;r<e.length;r++)t=t.concat(this._statement_bnodes(e[r]));t.sort();for(var n=[],i=0;i<t.length;i++)0!==i&&t[i].sameTerm(t[i-1])||n.push(t[i]);return n},e.prototype._cache_ifps=function(){this.ifps={};for(var e=this.store.each(void 0,this.ns.rdf("type"),this.ns.owl("InverseFunctionalProperty")),t=0;t<e.length;t++)this.ifps[e[t].uri]=!0;for(this.fps={},e=this.store.each(void 0,this.ns.rdf("type"),this.ns.owl("FunctionalProperty")),t=0;t<e.length;t++)this.fps[e[t].uri]=!0},e.prototype._bnode_context2=function(e,t,r){for(var n,i,o=this.store.statementsMatching(void 0,void 0,e,t),s=0;s<o.length;s++)if(this.fps[o[s].predicate.uri]){if(n=o[s].subject,!n.isBlank)return[o[s]];if(r&&(i=this._bnode_context2(n,t,r-1)))return i.concat([o[s]])}for(o=this.store.statementsMatching(e,void 0,void 0,t),s=0;s<o.length;s++)if(this.ifps[o[s].predicate.uri]){if(n=o[s].object,!n.isBlank)return[o[s]];if(r&&(i=this._bnode_context2(n,t,r-1)))return i.concat([o[s]])}return null},e.prototype._bnode_context_1=function(e,t){for(var r=0;3>r;r++){var n=this._bnode_context2(e,t,r);if(null!==n)return n}throw new Error("Unable to uniquely identify bnode: "+e.toNT())},e.prototype._mentioned=function(e){return 0!==this.store.statementsMatching(e).length||0!==this.store.statementsMatching(void 0,e).length||0!==this.store.statementsMatching(void 0,void 0,e).length},e.prototype._bnode_context=function(e,t){var r=[];if(e.length){this._cache_ifps();for(var n=0;n<e.length;n++){var i=e[n];this._mentioned(i)&&(r=r.concat(this._bnode_context_1(i,t)))}}return r},e.prototype._statement_context=function(e){var t=this._statement_bnodes(e);return this._bnode_context(t,e.why)},e.prototype._context_where=function(e){var t=this;return e&&0!==e.length?"WHERE { "+e.map(function(e){return t.anonymizeNT(e)}).join("\n")+" }\n":""},e.prototype._fire=function(e,t,n){if(!e)throw new Error("No URI given for remote editing operation: "+t);console.log("sparql: sending update to <"+e+">");var i=r.Util.XMLHTTPFactory();i.options={},i.onreadystatechange=function(){if(4===i.readyState){var r=!i.status||i.status>=200&&i.status<300;r?console.log("sparql: update Ok for <"+e+">"):console.log("sparql: update failed for <"+e+"> status="+i.status+", "+i.statusText+", body length="+i.responseText.length+"\n   for query: "+t),n(e,r,i.responseText,i)}},i.open("PATCH",e,!0),i.setRequestHeader("Content-type","application/sparql-update"),i.send(t)},e.prototype.update_statement=function(e){if(!e||e.why){var t=this,r=this._statement_context(e);return{statement:e?[e.subject,e.predicate,e.object,e.why]:void 0,statementNT:e?this.anonymizeNT(e):void 0,where:t._context_where(r),set_object:function(e,r){var n=this.where;n+="DELETE DATA { "+this.statementNT+" } ;\n",n+="INSERT DATA { "+this.anonymize(this.statement[0])+" "+this.anonymize(this.statement[1])+" "+this.anonymize(e)+"  . }\n",t._fire(this.statement[3].uri,n,r)}}}},e.prototype.insert_statement=function(e,t){var r=e instanceof Array?e[0]:e,n=this._context_where(this._statement_context(r));if(e instanceof Array){for(var i="",o=0;o<e.length;o++)i+=e[o]+"\n";n+="INSERT DATA { "+i+" }\n"}else n+="INSERT DATA { "+this.anonymize(e.subject)+" "+this.anonymize(e.predicate)+" "+this.anonymize(e.object)+"  . }\n";this._fire(r.why.uri,n,t)},e.prototype.delete_statement=function(e,t){var r=e instanceof Array?e[0]:e,n=this._context_where(this._statement_context(r));if(e instanceof Array){for(var i="",o=0;o<e.length;o++)i+=e[o]+"\n";n+="DELETE DATA { "+i+" }\n"}else n+="DELETE DATA { "+this.anonymize(e.subject)+" "+this.anonymize(e.predicate)+" "+this.anonymize(e.object)+"  . }\n";this._fire(r.why.uri,n,t)},e.prototype.requestDownstreamAction=function(e,t){var r=this.patchControlFor(e);if(r.pendingUpstream){if(r.downstreamAction){if(r.downstreamAction===t)return this;throw new Error("Can't wait for > 1 differnt downstream actions")}r.downstreamAction=t}else t(e)},e.prototype.clearUpstreamCount=function(e){var t=this.patchControlFor(e);t.upstreamCount=0},e.prototype.getUpdatesVia=function(e,t){var r=t.fetcher.getHeader(e,"updates-via");return r&&r.length?r[0].trim():null},e.prototype.addDownstreamChangeListener=function(e,t){var r=this.patchControlFor(e);r.downstreamChangeListeners||(r.downstreamChangeListeners=[]),r.downstreamChangeListeners.push(t),this.setRefreshHandler(e,this.reloadAndSync)},e.prototype.reloadAndSync=function(e){var t=tabulator.sparql.patchControlFor(e);if(t.reloading)return void console.log("   Already reloading - stop");t.reloading=!0;var r=1e3,n=function(){console.log("try reload - timeout = "+r),tabulator.sparql.reload(tabulator.kb,e,function(i,o,s){if(t.reloading=!1,i){if(t.downstreamChangeListeners)for(var a=0;a<t.downstreamChangeListeners.length;a++)console.log("        Calling downstream listener "+a),t.downstreamChangeListeners[a]()}else 0===s.status?(console.log("Network error refreshing the data. Retrying in "+r/1e3),t.reloading=!0,r=2*r,setTimeout(n,r)):console.log("Error "+s.status+"refreshing the data:"+o+". Stopped"+e)})};n()},e.prototype.setRefreshHandler=function(e,t,n){var i=this.getUpdatesVia(e,t),o=n,s=this,a=this,l=1500,h=0;if(!i)return console.log("Server doies not support live updates thoughUpdates-Via :-("),!1;i=r.uri.join(i,e.uri),i=i.replace(/^http:/,"ws:").replace(/^https:/,"wss:"),console.log("Web socket URI "+i);var c=function(){var t;if("undefined"!=typeof WebSocket)t=new WebSocket(i);else if("undefined"!=typeof Services)t=Services.wm.getMostRecentWindow("navigator:browser").WebSocket(i);else{if("undefined"==typeof window||!window.WebSocket)return void console.log("Live update disabled, as WebSocket not supported by platform :-(");t=window.WebSocket(i)}t.onopen=function(){console.log("    websocket open"),l=1500,this.send("sub "+e.uri),h&&(console.log("Web socket has been down, better check for any news."),a.requestDownstreamAction(e,o))};var r=s.patchControlFor(e);r.upstreamCount=0,t.onclose=function(e){console.log("*** Websocket closed with code "+e.code+", reason '"+e.reason+"' clean = "+e.clean),l*=2,h+=1,console.log("Retrying in "+l+"ms"),setTimeout(function(){console.log("Trying websocket again"),c()},l)},t.onmessage=function(t){if(t.data&&"pub"===t.data.slice(0,3)){if(r.upstreamCount&&(r.upstreamCount-=1,r.upstreamCount>=0))return void console.log("just an echo");r.upstreamCount=0,console.log("Assume a real downstream change"),s.requestDownstreamAction(e,o)}}};return c(),!0},e.prototype.update=function(e,t,n){try{var i=this.store,o=e?e instanceof r.IndexedFormula?e.statements:e instanceof Array?e:[e]:[],s=t?t instanceof r.IndexedFormula?t.statements:t instanceof Array?t:[t]:[];if(!(o instanceof Array))throw new Error("Type Error "+typeof o+": "+o);if(!(s instanceof Array))throw new Error("Type Error "+typeof s+": "+s);if(0===o.length&&0===s.length)return n(null,!0);var a=o.length?o[0].why:s[0].why,l=this.patchControlFor(a),h=Date.now(),c=["subject","predicate","object","why"],u=["insert","delete"],d={"delete":o,insert:s};u.map(function(e){d[e].map(function(e){if(!a.sameTerm(e.why))throw new Error("update: destination "+a+" inconsistent with delete quad "+e.why);c.map(function(t){if("undefined"==typeof e[t])throw new Error("update: undefined "+t+" of statement.")})})});var p=this.editable(a.uri,i);if(!p)throw new Error("Can't make changes in uneditable "+a);var f,m,g,v;if(p.indexOf("SPARQL")>=0){var y=[];o.length&&(y=this._statement_array_bnodes(o)),s.length&&(y=y.concat(this._statement_array_bnodes(s)));var w=this._bnode_context(y,a),b=this._context_where(w),T="";if(b.length){if(o.length){for(T+="DELETE { ",f=0;f<o.length;f++)T+=this.anonymizeNT(o[f])+"\n";T+=" }\n"}if(s.length){for(T+="INSERT { ",f=0;f<s.length;f++)T+=this.anonymizeNT(s[f])+"\n";T+=" }\n"}T+=b}else{if(o.length){for(T+="DELETE DATA { ",f=0;f<o.length;f++)T+=this.anonymizeNT(o[f])+"\n";T+=" } \n"}if(s.length){for(o.length&&(T+=" ; "),T+="INSERT DATA { ",f=0;f<s.length;f++)T+=this.anonymizeNT(s[f])+"\n";T+=" }\n"}}l.pendingUpstream=l.pendingUpstream?l.pendingUpstream+1:1,"undefined"!=typeof l.upstreamCount&&(l.upstreamCount+=1),this._fire(a.uri,T,function(e,t,r,c){if(c.elapsedTime_ms=Date.now()-h,console.log("    sparql: Return "+(t?"success":"FAILURE "+c.status)+" elapsed "+c.elapsedTime_ms+"ms"),t){try{i.remove(o)}catch(u){t=!1,r="Remote Ok BUT error deleting "+o.length+" from store!!! "+u}for(var d=0;d<s.length;d++)i.add(s[d].subject,s[d].predicate,s[d].object,a)}if(n(e,t,r,c),l.pendingUpstream-=1,0===l.pendingUpstream&&l.downstreamAction){var p=l.downstreamAction;delete l.downstreamAction,console.log("delayed downstream action:"),p(a)}})}else if(p.indexOf("DAV")>=0){var x=i.any(a,this.ns.link("request"));if(!x)throw new Error("No record of our HTTP GET request for document: "+a);var N=i.any(x,this.ns.link("response"));if(!N)return null;var R=i.the(N,this.ns.httph("content-type")).value;for(m=i.statementsMatching(void 0,void 0,void 0,a).slice(),f=0;f<o.length;f++)r.Util.RDFArrayRemove(m,o[f]);for(f=0;f<s.length;f++)m.push(s[f]);switch(v=r.Serializer(i),v.suggestNamespaces(i.namespaces),v.setBase(a.uri),R){case"application/rdf+xml":g=v.statementsToXML(m);break;case"text/n3":case"text/turtle":case"application/x-turtle":case"application/n3":g=v.statementsToN3(m);break;default:throw new Error("Content-type "+R+" not supported for data write")}var I,k=i.the(N,this.ns.httph("content-location"));k&&(I=r.uri.join(k.value,I));var D=r.Util.XMLHTTPFactory();D.options={},D.onreadystatechange=function(){if(4===D.readyState){var e=!D.status||D.status>=200&&D.status<300;if(e){for(var t=0;t<o.length;t++)i.remove(o[t]);for(t=0;t<s.length;t++)i.add(s[t].subject,s[t].predicate,s[t].object,a)}n(a.uri,e,D.responseText)}},D.open("PUT",I,!0),D.setRequestHeader("Content-type",R),D.send(g)}else{if(!(p.indexOf("LOCALFILE")>=0))throw new Error("Unhandled edit method: '"+p+"' for "+a);try{for(console.log("Writing back to local file\n"),m=i.statementsMatching(void 0,void 0,void 0,a).slice(),f=0;f<o.length;f++)r.Util.RDFArrayRemove(m,o[f]);for(f=0;f<s.length;f++)m.push(s[f]);v=r.Serializer(i),v.suggestNamespaces(i.namespaces),v.setBase(a.uri);var C=a.uri.lastIndexOf(".");if(1>C)throw new Error("Rewriting file: No filename extension: "+a.uri);var _=a.uri.slice(C+1);switch(_){case"rdf":case"owl":case"xml":g=v.statementsToXML(m);break;case"n3":case"nt":case"ttl":g=v.statementsToN3(m);break;default:throw new Error("File extension ."+_+" not supported for data write")}console.log("Writing back: <<<"+g+">>>");var S=a.uri.slice(7),F=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);if(F.initWithPath(S),!F.exists())throw new Error("Rewriting file <"+a.uri+"> but it does not exist!");var O=Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);for(O.init(F,42,parseInt("0666",8),0),O.write(g,g.length),O.close(),f=0;f<o.length;f++)i.remove(o[f]);for(f=0;f<s.length;f++)i.add(s[f].subject,s[f].predicate,s[f].object,a);n(a.uri,!0,"")}catch(U){n(a.uri,!1,"Exception trying to write back file <"+a.uri+">\n"+tabulator.Util.stackString(U))}}}catch(U){n(void 0,!1,"Exception in update: "+U)}},e.prototype.put=function(e,t,n,i){var o,s=this.store;if("string"==typeof t)o=t;else{var a=r.Serializer(s);switch(a.suggestNamespaces(s.namespaces),a.setBase(e.uri),n){case"application/rdf+xml":o=a.statementsToXML(t);break;case"text/n3":case"text/turtle":case"application/x-turtle":case"application/n3":o=a.statementsToN3(t);break;default:throw new Error("Content-type "+n+" not supported for data PUT")}}var l=r.Util.XMLHTTPFactory();l.options={},l.onreadystatechange=function(){if(4===l.readyState){var r=!l.status||l.status>=200&&l.status<300;r&&"string"!=typeof t&&t.map(function(e){s.addStatement(e)}),r&&(delete s.fetcher.nonexistant[e.uri],delete s.fetcher.requested[e.uri]),i(e.uri,r,l.responseText,l)}},l.open("PUT",e.uri,!0),l.setRequestHeader("Content-type",n),l.send(o)},e.prototype.reload=function(e,t,r){var n=Date.now();e.fetcher.nowOrWhenFetched(t.uri,{force:!0,noMeta:!0,clearPreviousData:!0},function(e,i,o){if(e)if(o.onErrorWasCalled||200!==o.status)console.log("    Non-HTTP error reloading data! onErrorWasCalled="+o.onErrorWasCalled+" status: "+o.status),r(!1,"Non-HTTP error reloading data: "+i,o);else{var s=Date.now()-n;t.reloadTime_total||(t.reloadTime_total=0),t.reloadTime_count||(t.reloadTime_count=0),t.reloadTime_total+=s,t.reloadTime_count+=1,console.log("    Fetch took "+s+"ms, av. of "+t.reloadTime_count+" = "+t.reloadTime_total/t.reloadTime_count+"ms."),r(!0)}else console.log("    ERROR reloading data: "+i),r(!1,"Error reloading data: "+i,o)})},e.prototype.oldReload=function(e,t,n){var i=r.graph(),o=r.fetcher(i),s=Date.now();o.nowOrWhenFetched(t.uri,{force:!0,noMeta:!0,clearPreviousData:!0},function(r,o,a){if(r)if(a.onErrorWasCalled||200!==a.status)console.log("    Non-HTTP error reloading data! onErrorWasCalled="+a.onErrorWasCalled+" status: "+a.status),n(!1,"Non-HTTP error reloading data: "+o,a);else{var l=e.statementsMatching(void 0,void 0,void 0,t).slice(),h=i.statementsMatching(void 0,void 0,void 0,t).slice();console.log("    replacing "+l.length+" with "+h.length+" out of total statements "+e.statements.length),e.remove(l),e.add(h);var c=Date.now()-s;0===h.length&&console.log("????????????????? 0000000"),t.reloadTime_total||(t.reloadTime_total=0),t.reloadTime_count||(t.reloadTime_count=0),t.reloadTime_total+=c,t.reloadTime_count+=1,console.log("    fetch took "+c+"ms, av. of "+t.reloadTime_count+" = "+t.reloadTime_total/t.reloadTime_count+"ms."),n(!0)}else console.log("    ERROR reloading data: "+o),n(!1,"Error reloading data: "+o,a)})},e}(),r.jsonParser=function(){return{parseJSON:function(e,t,r){var n,i,o,s={},a=r.sym(t);for(var l in e){0===l.indexOf("_:")?s[l]?n=s[l]:(n=r.bnode(l),s[l]=n):n=r.sym(l);var h=e[l];for(var c in h){var u=h[c];i=r.sym(c);for(var d in u){var p=u[d];if("uri"===p.type)o=r.sym(p.value),r.add(n,i,o,a);else if("bnode"===p.type)s[p.value]?o=s[p.value]:(o=r.bnode(p.value),s[p.value]=o),r.add(n,i,o,a);else{if("literal"!==p.type)throw new Error("error: unexpected termtype: "+d.type);o=p.datatype?r.literal(p.value,void 0,r.sym(p.datatype)):p.lang?r.literal(p.value,p.lang):r.literal(p.value),r.add(n,i,o,a)}}}}}}}(),r.Serializer=function(){function t(e){return encodeURI(e)}function n(e){for(var t,r="",n=0;n<e.length;n++)t=e.charCodeAt(n),r+=t>65535?"\\U"+("00000000"+t.toString(16)).slice(-8):t>126?"\\u"+("0000"+t.toString(16)).slice(-4):e[n];return r}var o=function(e){this.flags="",this.base=null,this.prefixes=[],this.namespaces=[],this.suggestPrefix("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.suggestPrefix("xml","reserved:reservedForFutureUse"),this.namespacesUsed=[],this.keywords=["a"],this.prefixchars="abcdefghijklmnopqustuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",this.incoming=null,this.formulas=[],this.store=e};o.prototype.setBase=function(e){this.base=e},o.prototype.setFlags=function(e){this.flags=e?e:""},o.prototype.toStr=function(e){var t=e.toNT();return"formula"==e.termType&&(this.formulas[t]=e),t},o.prototype.fromStr=function(e){if("{"==e[0]){var t=this.formulas[e];return t||alert("No formula object for "+e),t}return this.store.fromNT(e)},o.prototype.suggestPrefix=function(e,t){"default"!==e.slice(0,7)&&"ns"!==e.slice(0,2)&&e&&t&&(e in this.namespaces||t in this.prefixes||(this.prefixes[t]=e,this.namespaces[e]=t))},o.prototype.suggestNamespaces=function(e){for(var t in e)this.suggestPrefix(t,e[t])},o.prototype.checkIntegrity=function(){var e,t;for(e in this.namespaces)if(this.prefixes[this.namespaces[e]]!==e)throw"Serializer integity error 1: "+e+", "+this.namespaces[e]+", "+this.prefixes[this.namespaces[e]]+"!";for(t in this.prefixes)if(this.namespaces[this.prefixes[t]]!==t)throw"Serializer integity error 2: "+t+", "+this.prefixs[t]+", "+this.namespaces[this.prefixes[t]]+"!"},o.prototype.makeUpPrefix=function(e){function t(t){return o.prototype.validPrefix.test(t)?"ns"===t?!1:t in this.namespaces?!1:(this.prefixes[e]=t,this.namespaces[t]=e,r=t,!0):!1}var r,n=e;t=t.bind(this),"#/".indexOf(n[n.length-1])>=0&&(n=n.slice(0,-1));var i=n.lastIndexOf("/");i>=0&&(n=n.slice(i+1));for(var s=0;s<n.length&&this.prefixchars.indexOf(n[s]);)s++;if(n=n.slice(0,s),n.length<6&&t(n))return r;if(t(n.slice(0,3)))return r;if(t(n.slice(0,2)))return r;if(t(n.slice(0,4)))return r;if(t(n.slice(0,1)))return r;if(t(n.slice(0,5)))return r;o.prototype.validPrefix.test(n)||(n="n");for(var s=0;;s++)if(t(n.slice(0,3)+s))return r},o.prototype.rootSubjects=function(e){for(var t={},r={},n={},i=0;i<e.length;i++){var o=e[i];[o.subject,o.predicate,o.object].map(function(e){"bnode"==e.termType&&(n[e.toNT()]=!0)});var s=e[i].object;t.hasOwnProperty(s)||(t[s]=[]),t[s].push(o.subject);var a=r[this.toStr(o.subject)];a||(a=[]),a.push(o),r[this.toStr(o.subject)]=a}var l=[];for(var h in r)if(r.hasOwnProperty(h)){var s=this.fromStr(h);"bnode"==s.termType&&t[s]&&1==t[s].length||l.push(s)}this.incoming=t;for(var c={},i=0;i<l.length;i++)c[l[i].toNT()]=!0;return{roots:l,subjects:r,rootsHash:c,incoming:t}},o.prototype.toN3=function(e){return this.statementsToN3(e.statements)},o.prototype._notQNameChars="	\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~",o.prototype._notNameChars=o.prototype._notQNameChars+":",o.prototype.statementsToN3=function(e){function t(e){for(var t=this.rootSubjects(e),r=t.roots,i=[],o=0;o<r.length;o++){var s=r[o];i.push(n(s,t))}return i}function n(e,t){return"bnode"!=e.termType||t.incoming[e]?[l(e,t)].concat([s(e,t)]).concat(["."]):a(e,t,!0).concat(["."])}function s(e,t){var r=[],n=null,i=t.subjects[this.toStr(e)];if("undefined"==typeof i)throw"Cant find statements for "+e;i.sort();for(var o=[],s=0;s<i.length;s++){var h=i[s];h.predicate.uri==n?o.push(","):(n&&(r=r.concat([o]).concat([";"]),o=[]),r.push(d[h.predicate.uri]?d[h.predicate.uri]:l(h.predicate,t))),n=h.predicate.uri,o.push(a(h.object,t))}return r=r.concat([o])}function a(e,t,r){return"bnode"==e.termType&&t.subjects[this.toStr(e)]&&(r||void 0==t.rootsHash[e.toNT()])?["["].concat(s(e,t)).concat(["]"]):l(e,t)}function l(e,r){switch(e.termType){case"formula":var n=["{"];return n=n.concat(t(e.statements)),n.concat(["}"]);case"collection":var n=["("];for(i=0;i<e.elements.length;i++)n.push([a(e.elements[i],r)]);return n.push(")"),n;default:return this.atomicTermToN3(e)}}function h(){var e="";this.defaultNamespace&&(e+="@prefix : <"+this.defaultNamespace+">.\n");for(var t in this.prefixes)this.prefixes.hasOwnProperty(t)&&this.namespacesUsed[t]&&(e+="@prefix "+this.prefixes[t]+": <"+r.uri.refTo(this.base,t)+">.\n");return e+"\n"}var c=4,u=80,d={"http://www.w3.org/2002/07/owl#sameAs":"=","http://www.w3.org/2000/10/swap/log#implies":"=>","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"a"},p=function(e){for(var t="",r=0;e>r;r++)t+=" ";return t},f=function(e){for(var t="",r=0;r<e.length;r++){var n=e[r],i="string"==typeof n?n:f(n);0!=r&&","!=i&&";"!=i&&(t+=" "),t+=i}return t},m=function(e,t){var r="",n=1e5;t||(t=0);for(var i=0;i<e.length;i++){var o=e[i];if("string"!=typeof o){var s=m(o,t+1);if(s.length<10*(u-c*t)&&s.indexOf('"""')<0){var a=f(o);a.length<u-c*t&&(o="   "+a,s="")}s&&(n=1e4),r+=s}if("string"==typeof o){if("1"==o.length&&"\n"==r.slice(-1)){if(",.;".indexOf(o)>=0){r=r.slice(0,-1)+o+"\n",n+=1;continue}if("])}".indexOf(o)>=0){r=r.slice(0,-1)+" "+o+"\n",n+=2;continue}}if(c*t+4>n)r=r.slice(0,-1)+" "+o+"\n",n+=o.length+1;else{var a=p(c*t)+o;r+=a+"\n",n=a.length}}}return r};t=t.bind(this),s=s.bind(this),a=a.bind(this),o.prototype.termToN3=l,l=l.bind(this),h=h.bind(this);var g=t(e);return h()+m(g,-1)},o.prototype.atomicTermToN3=function(e,t){switch(e.termType){case"bnode":case"variable":return e.toNT();case"literal":if(e.datatype)switch(e.datatype.uri){case"http://www.w3.org/2001/XMLSchema#integer":return e.value.toString();case"http://www.w3.org/2001/XMLSchema#boolean":return e.value?"true":"false"}var r=this.stringToN3(e.value);return e.lang?r+="@"+e.lang:e.datatype&&(r+="^^"+this.termToN3(e.datatype,t)),r;case"symbol":return this.symbolToN3(e);default:throw"Internal: atomicTermToN3 cannot handle "+e+" of termType+"+e.termType}},o.prototype.validPrefix=new RegExp(/^[a-zA-Z][a-zA-Z0-9]*$/),o.prototype.forbidden1=new RegExp(/[\\"\b\f\r\v\t\n\u0080-\uffff]/gm),o.prototype.forbidden3=new RegExp(/[\\"\b\f\r\v\u0080-\uffff]/gm),o.prototype.stringToN3=function(e,t){t||(t="e");var r,n,i="",s=0,a=0;for(e.length>20&&'"'!=e.slice(-1)&&t.indexOf("n")<0&&(e.indexOf("\n")>0||e.indexOf('"')>0)?(r='"""',n=o.prototype.forbidden3):(r='"',n=o.prototype.forbidden1),s=0;s<e.length;){n.lastIndex=0;var l=n.exec(e.slice(s));if(null==l)break;a=s+n.lastIndex-1,i+=e.slice(s,a);var h=e[a];if('"'==h&&'"""'==r&&'"""'!=e.slice(a,a+3))i+=h;else{var c='\b\f\r	\x0B\n\\"'.indexOf(h);i+=c>=0?"\\"+'bfrtvn\\"'[c]:t.indexOf("e")>=0?"\\u"+("000"+h.charCodeAt(0).toString(16).toLowerCase()).slice(-4):h}s=a+1}return r+i+e.slice(s)+r},o.prototype.symbolToN3=function(e){var i=e.uri,s=i.indexOf("#");if(0>s&&this.flags.indexOf("/")<0&&(s=i.lastIndexOf("/")),s>=0&&this.flags.indexOf("p")<0&&(0===i.indexOf("http")||0===i.indexOf("ws")||0===i.indexOf("file"))){for(var a=!0,l=s+1;l<i.length;l++)if(o.prototype._notNameChars.indexOf(i[l])>=0){a=!1;break}if(i.slice(0,s+1)==this.base+"#")return"<#"+i.slice(s+1)+">";if(a){var h=i.slice(s+1),c=i.slice(0,s+1);if(this.defaultNamespace&&this.defaultNamespace==c&&this.flags.indexOf("d")<0)return this.flags.indexOf("k")>=0&&this.keyords.indexOf(h)<0?h:":"+h;this.checkIntegrity();var u=this.prefixes[c];if(u||(u=this.makeUpPrefix(c)),u)return this.namespacesUsed[c]=!0,u+":"+h}}return i=this.flags.indexOf("r")<0&&this.base?r.uri.refTo(this.base,i):this.flags.indexOf("u")>=0?n(i):t(i),"<"+i+">"},o.prototype.writeStore=function(e){var t=this.store,r=t.fetcher,n=r&&r.appNode,i=this.store.index[3];for(s in i){var o=t.fromNT(s);n&&o.sameTerm(n)||e("\n"+this.atomicTermToN3(o)+" "+this.atomicTermToN3(t.sym("http://www.w3.org/2000/10/swap/log#semantics"))+" { "+this.statementsToN3(t.statementsMatching(void 0,void 0,void 0,o))+" }.\n")}t.statementsMatching(void 0,t.sym("http://www.w3.org/2007/ont/link#requestedURI")).map(function(r){e("\n<"+r.object.value+"> log:metadata {\n");var n=t.statementsMatching(void 0,void 0,void 0,r.subject);e(this.statementsToN3(this.statementsToN3(n))),e("}.\n")}),n&&metaSources.push(n);var a=[];metaSources.map(function(e){a=a.concat(t.statementsMatching(void 0,void 0,void 0,e))}),e(this.statementsToN3(a))},o.prototype.statementsToXML=function(t){function n(t){this.suggestPrefix("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#");for(var r=this.rootSubjects(t),n=r.roots,i=[],o=0;o<n.length;o++)e=n[o],i.push(a(e,r));return i}function i(e){return"undefined"==typeof e?"@@@undefined@@@@":e.replace(/[&<"]/g,function(e){switch(e[0]){case"&":return"&amp;";case"<":return"&lt;";case'"':return"&quot;"}})}function s(e){return i(this.base?r.Util.uri.refTo(this.base,e.uri):e.uri)}function a(e,t){var n,o,h,u,d=[],p=t.subjects[this.toStr(e)];if("undefined"==typeof p)throw"Serializing XML - Cant find statements for "+e;p.sort(function(e,t){var r=e.predicate.uri,n=t.predicate.uri;if(r.substring(0,f.length)==f||n.substring(0,f.length)==f)return r.localeCompare(n);var i=r.substring(f.length),o=n.substring(f.length),s=parseInt(i),a=parseInt(o);return isNaN(s)||isNaN(a)||s!=i||a!=o?r.localeCompare(n):s-a});for(var m=0;m<p.length;m++)if(h=p[m],"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"!=h.predicate.uri||n||"symbol"!=h.object.termType){if(u=h.predicate,u.uri.substr(0,f.length)==f){var g=u.uri.substr(f.length),v=parseInt(g);g==v.toString()&&(u=new r.NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#li"))}switch(o=c(u),h.object.termType){case"bnode":d=1==t.incoming[h.object].length?d.concat(["<"+o+">",a(h.object,t),"</"+o+">"]):d.concat(["<"+o+' rdf:nodeID="'+h.object.toNT().slice(2)+'"/>']);break;case"symbol":d=d.concat(["<"+o+' rdf:resource="'+s(h.object)+'"/>']);break;case"literal":d=d.concat(["<"+o+(h.object.datatype?' rdf:datatype="'+i(h.object.datatype.uri)+'"':"")+(h.object.lang?' xml:lang="'+h.object.lang+'"':"")+">"+i(h.object.value)+"</"+o+">"]);break;case"collection":d=d.concat(["<"+o+' rdf:parseType="Collection">',l(h.object,t),"</"+o+">"]);break;default:throw"Can't serialize object of type "+h.object.termType+" into XML"}}else n=h.object;var y=n?c(n):"rdf:Description",w="";return"bnode"==e.termType?t.incoming[e]&&1==t.incoming[e].length||(w=' rdf:nodeID="'+e.toNT().slice(2)+'"'):w=' rdf:about="'+s(e)+'"',["<"+y+w+">"].concat([d]).concat(["</"+y+">"])}function l(e,t){for(var r=[],n=0;n<e.elements.length;n++)r.push(a(e.elements[n],t));return r}function h(e,t){var r=[],n=t.subjects[this.toStr(e)];if(void 0==n)return r;n.sort();for(var o=0;o<n.length;o++){var a=n[o];switch(a.object.termType){case"bnode":r=t.rootsHash[a.object.toNT()]?r.concat(["<"+c(a.predicate)+' rdf:nodeID="'+a.object.toNT().slice(2)+'">',"</"+c(a.predicate)+">"]):r.concat(["<"+c(a.predicate)+' rdf:parseType="Resource">',h(a.object,t),"</"+c(a.predicate)+">"]);break;case"symbol":r=r.concat(["<"+c(a.predicate)+' rdf:resource="'+s(a.object)+'"/>']);break;case"literal":r=r.concat(["<"+c(a.predicate)+(a.object.datatype?' rdf:datatype="'+i(a.object.datatype.uri)+'"':"")+(a.object.lang?' xml:lang="'+a.object.lang+'"':"")+">"+i(a.object.value)+"</"+c(a.predicate)+">"]);break;case"collection":r=r.concat(["<"+c(a.predicate)+' rdf:parseType="Collection">',l(a.object,t),"</"+c(a.predicate)+">"]);break;default:throw"Can't serialize object of type "+a.object.termType+" into XML"}}return r}function c(e){var t=e.uri,r=t.indexOf("#");if(0>r&&this.flags.indexOf("/")<0&&(r=t.lastIndexOf("/")),0>r)throw"Cannot make qname out of <"+t+">";for(var n=r+1;n<t.length;n++)if(o.prototype._notNameChars.indexOf(t[n])>=0)throw'Invalid character "'+t[n]+'" cannot be in XML qname for URI: '+t;var i=t.slice(r+1),s=t.slice(0,r+1);if(this.defaultNamespace&&this.defaultNamespace==s&&this.flags.indexOf("d")<0)return i;var a=this.prefixes[s];return a||(a=this.makeUpPrefix(s)),p[s]=!0,a+":"+i}var u=4,d=80,p=[];p["http://www.w3.org/1999/02/22-rdf-syntax-ns#"]=!0;var f="http://www.w3.org/1999/02/22-rdf-syntax-ns#_",m=function(e){for(var t="",r=0;e>r;r++)t+=" ";return t},g=function(e){for(var t="",r=0;r<e.length;r++){var n=e[r],i="string"==typeof n?n:g(n);t+=i}return t},v=function(e,t){var r="",n=1e5;t||(t=0);for(var i=0;i<e.length;i++){var o=e[i];if("string"!=typeof o){var s=v(o,t+1);if(s.length<10*(d-u*t)&&s.indexOf('"""')<0){var a=g(o);a.length<d-u*t&&(o="   "+a,s="")}s&&(n=1e4),r+=s}if("string"==typeof o)if(u*t+4>n)r=r.slice(0,-1)+" "+o+"\n",n+=o.length+1;else{var a=m(u*t)+o;r+=a+"\n",n=a.length}}return r};n=n.bind(this),s=s.bind(this),a=a.bind(this),h=h.bind(this),c=c.bind(this);var y=n(t),w="<rdf:RDF";this.defaultNamespace&&(w+=' xmlns="'+i(this.defaultNamespace)+'"');for(var b in p)p.hasOwnProperty(b)&&(w+="\n xmlns:"+this.prefixes[b]+'="'+i(b)+'"');w+=">";var T=[w,y,"</rdf:RDF>"];return v(T,-1)};var a=function(e){return new o(e)};return a}();var r,o,l,p=function(e,t){return function(){return e.apply(t,arguments)}},h={}.hasOwnProperty;if("undefined"!=typeof r&&null!==r||(r={}),r.UpdatesSocket=function(){function e(e,t){var r;this.parent=e,this.via=t,this.subscribe=p(this.subscribe,this),this.onError=p(this.onError,this),this.onMessage=p(this.onMessage,this),this.onClose=p(this.onClose,this),this.onOpen=p(this.onOpen,this),this._subscribe=p(this._subscribe,this),this._send=p(this._send,this),this.connected=!1,this.pending={},this.subscribed={},this.socket={};try{this.socket=new WebSocket(t),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onmessage=this.onMessage,this.socket.onerror=this.onError}catch(n){r=n,this.onError(r)}}return e.prototype._decode=function(e){var t,r,n,i,o,s,a;i={},o=function(){var r,n,i,o;for(i=e.split("&"),o=[],r=0,n=i.length;n>r;r++)t=i[r],o.push(t.split("="));return o}();for(r in o)t=o[r],s=[decodeURIComponent(t[0]),decodeURIComponent(t[1])],n=s[0],a=s[1],null==i[n]&&(i[n]=[]),i[n].push(a);return i},e.prototype._send=function(e,t,r){var n,i;return i=[e,t,r].join(" "),"function"==typeof(n=this.socket).send?n.send(i):void 0},e.prototype._subscribe=function(e){return this._send("sub",e,""),this.subscribed[e]=!0,this.subscribed[e]},e.prototype.onOpen=function(e){var t,r;this.connected=!0,t=[];for(r in this.pending)delete this.pending[r],t.push(this._subscribe(r));return t},e.prototype.onClose=function(e){var t;this.connected=!1;for(t in this.subscribed)this.pending[t]=!0;return this.subscribed={},this.subscribed},e.prototype.onMessage=function(e){var t,r;return r=e.data.split(" "),"ping"===r[0]?"function"==typeof(t=this.socket).send?t.send("pong "+r.slice(1).join(" ")):void 0:"pub"===r[0]?this.parent.onUpdate(r[1],this._decode(r[2])):void 0},e.prototype.onError=function(e){throw new Error("onError"+e)},e.prototype.subscribe=function(e){return this.connected?this._subscribe(e):(this.pending[e]=!0,this.pending[e])},e}(),r.UpdatesVia=function(){function e(e){this.fetcher=e,this.onUpdate=p(this.onUpdate,this),this.onHeaders=p(this.onHeaders,this),this.register=p(this.register,this),this.graph={},this.via={},this.fetcher.addCallback("headers",this.onHeaders)}return e.prototype.register=function(e,t){return null==this.via[e]&&(this.via[e]=new r.UpdatesSocket(this,e)),this.via[e].subscribe(t)},e.prototype.onHeaders=function(e){var t,r,n;return null==e.headers?!0:"undefined"==typeof WebSocket||null===WebSocket?!0:(t=e.headers.etag,n=e.headers["updates-via"],r=e.uri,t&&n&&(this.graph[r]={etag:t,via:n},this.register(n,r)),!0)},e.prototype.onUpdate=function(e,t){return this.fetcher.refresh(r.sym(e))},e}(),null!=("undefined"!=typeof module&&null!==module?module.exports:void 0))for(o in r)h.call(r,o)&&(l=r[o],module.exports[o]=l);var f=require("async"),m=require("jsonld"),g=require("n3");r.Fetcher=function(e,t,n){this.store=e,this.thisURI="http://dig.csail.mit.edu/2005/ajar/ajaw/rdf/sources.js#SourceFetcher",this.timeout=t||3e4,this.async=null!=n?n:!0,this.appNode=this.store.bnode(),this.store.fetcher=this,this.requested={},this.redirectedTo={},this.fetchCallbacks={},this.nonexistant={},this.lookedUp={},this.handlers=[],this.mediatypes={};var i=this,o=this.store,s={};s.link=r.Namespace("http://www.w3.org/2007/ont/link#"),s.http=r.Namespace("http://www.w3.org/2007/ont/http#"),s.httph=r.Namespace("http://www.w3.org/2007/ont/httph#"),s.rdf=r.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),
s.rdfs=r.Namespace("http://www.w3.org/2000/01/rdf-schema#"),s.dc=r.Namespace("http://purl.org/dc/elements/1.1/"),i.mediatypes["image/*"]={q:.9},r.Fetcher.crossSiteProxy=function(e){return r.Fetcher.crossSiteProxyTemplate?r.Fetcher.crossSiteProxyTemplate.replace("{uri}",encodeURIComponent(e)):void 0},r.Fetcher.RDFXMLHandler=function(e){e&&(this.dom=e[0]),this.handlerFactory=function(e){e.handle=function(t){var n=i.store;this.dom||(this.dom=r.Util.parseXML(e.responseText));var o=this.dom.documentElement;if("parsererror"===o.nodeName)throw i.failFetch(e,"Badly formed XML in "+e.resource.uri),new Error("Badly formed XML in "+e.resource.uri);var a=new r.RDFParser(n);try{a.parse(this.dom,e.original.uri,e.original)}catch(l){i.addStatus(e.req,"Syntax error parsing RDF/XML! "+l),console.log("Syntax error parsing RDF/XML! "+l)}e.options.noMeta||n.add(e.original,s.rdf("type"),s.link("RDFDocument"),i.appNode),t()}}},r.Fetcher.RDFXMLHandler.toString=function(){return"RDFXMLHandler"},r.Fetcher.RDFXMLHandler.register=function(e){e.mediatypes["application/rdf+xml"]={}},r.Fetcher.RDFXMLHandler.pattern=new RegExp("application/rdf\\+xml"),r.Fetcher.XHTMLHandler=function(e){e&&(this.dom=e[0]),this.handlerFactory=function(e){e.handle=function(t){var n,o;this.dom||(this.dom=r.Util.parseXML(e.responseText));var a=i.store,l=this.dom.getElementsByTagName("title");l.length>0&&a.add(e.resource,s.dc("title"),a.literal(l[0].textContent),e.resource);for(var h=this.dom.getElementsByTagName("link"),c=h.length-1;c>=0;c--)n=h[c].getAttribute("rel"),o=!1,n||(n=h[c].getAttribute("rev"),o=!0),n&&i.linkData(e,n,h[c].getAttribute("href"),e.resource,o);for(var u=this.dom.getElementsByTagName("script"),d=0;d<u.length;d++){var p=u[d].getAttribute("type");r.parsable[p]&&r.parse(u[d].textContent,a,e.original.uri,p)}e.options.noMeta||a.add(e.resource,s.rdf("type"),s.link("WebPage"),i.appNode),e.options.doRDFa&&r.parseDOM_RDFa&&r.parseDOM_RDFa(this.dom,a,e.original),t()}}},r.Fetcher.XHTMLHandler.toString=function(){return"XHTMLHandler"},r.Fetcher.XHTMLHandler.register=function(e){e.mediatypes["application/xhtml+xml"]={}},r.Fetcher.XHTMLHandler.pattern=new RegExp("application/xhtml"),r.Fetcher.XMLHandler=function(){this.handlerFactory=function(e){e.handle=function(t){for(var n=r.Util.parseXML(e.responseText),o=0;o<n.childNodes.length;o++)if(1===n.childNodes[o].nodeType){var s=n.childNodes[o].namespaceURI;if(s&&s===s.rdf)return i.addStatus(e.req,"Has XML root element in the RDF namespace, so assume RDF/XML."),void i.switchHandler("RDFXMLHandler",e,t,[n]);break}if(n.doctype&&"html"===n.doctype.name&&n.doctype.publicId.match(/^-\/\/W3C\/\/DTD XHTML/)&&n.doctype.systemId.match(/http:\/\/www.w3.org\/TR\/xhtml/))return i.addStatus(e.req,"Has XHTML DOCTYPE. Switching to XHTML Handler.\n"),void i.switchHandler("XHTMLHandler",e,t);var a=n.getElementsByTagName("html")[0];if(a){var l=a.getAttribute("xmlns");if(l&&l.match(/^http:\/\/www.w3.org\/1999\/xhtml/))return i.addStatus(e.req,"Has a default namespace for XHTML. Switching to XHTMLHandler.\n"),void i.switchHandler("XHTMLHandler",e,t)}i.failFetch(e,"Unsupported dialect of XML: not RDF or XHTML namespace, etc.\n"+e.responseText.slice(0,80))}}},r.Fetcher.XMLHandler.toString=function(){return"XMLHandler"},r.Fetcher.XMLHandler.register=function(e){e.mediatypes["text/xml"]={q:.2},e.mediatypes["application/xml"]={q:.2}},r.Fetcher.XMLHandler.pattern=new RegExp("(text|application)/(.*)xml"),r.Fetcher.HTMLHandler=function(){this.handlerFactory=function(e){e.handle=function(t){var r=e.responseText;if(r.match(/\s*<\?xml\s+version\s*=[^<>]+\?>/))return i.addStatus(e.req,"Has an XML declaration. We'll assume it's XHTML as the content-type was text/html.\n"),void i.switchHandler("XHTMLHandler",e,t);if(r.match(/.*<!DOCTYPE\s+html[^<]+-\/\/W3C\/\/DTD XHTML[^<]+http:\/\/www.w3.org\/TR\/xhtml[^<]+>/))return i.addStatus(e.req,"Has XHTML DOCTYPE. Switching to XHTMLHandler.\n"),void i.switchHandler("XHTMLHandler",e,t);if(r.match(/[^(<html)]*<html\s+[^<]*xmlns=['"]http:\/\/www.w3.org\/1999\/xhtml["'][^<]*>/))return i.addStatus(e.req,"Has default namespace for XHTML, so switching to XHTMLHandler.\n"),void i.switchHandler("XHTMLHandler",e,t);var n=new RegExp("<title>([\\s\\S]+?)</title>","im").exec(r);if(n){var o=i.store;return o.add(e.resource,s.dc("title"),o.literal(n[1]),e.resource),o.add(e.resource,s.rdf("type"),s.link("WebPage"),i.appNode),void t()}i.addStatus(e.req,"non-XML HTML document, not parsed for data."),i.doneFetch(e)}}},r.Fetcher.HTMLHandler.toString=function(){return"HTMLHandler"},r.Fetcher.HTMLHandler.register=function(e){e.mediatypes["text/html"]={q:.3}},r.Fetcher.HTMLHandler.pattern=new RegExp("text/html"),r.Fetcher.TextHandler=function(){this.handlerFactory=function(e){e.handle=function(t){var r=e.responseText;return r.match(/\s*<\?xml\s+version\s*=[^<>]+\?>/)?(i.addStatus(e.req,"Warning: "+e.resource+" has an XML declaration. We'll assume it's XML but its content-type wasn't XML.\n"),void i.switchHandler("XMLHandler",e,t)):r.slice(0,500).match(/xmlns:/)?(i.addStatus(e.req,"May have an XML namespace. We'll assume it's XML but its content-type wasn't XML.\n"),void i.switchHandler("XMLHandler",e,t)):(i.addStatus(e.req,"Plain text document, no known RDF semantics."),void i.doneFetch(e))}}},r.Fetcher.TextHandler.toString=function(){return"TextHandler"},r.Fetcher.TextHandler.register=function(e){e.mediatypes["text/plain"]={q:.1}},r.Fetcher.TextHandler.pattern=new RegExp("text/plain"),r.Fetcher.N3Handler=function(){this.handlerFactory=function(e){e.handle=function(t){console.log("web.js: Parsing as N3 "+e.resource.uri+" base: "+e.original.uri);var n=r.N3Parser(o,o,e.original.uri,e.original.uri,null,null,"",null);try{n.loadBuf(e.responseText)}catch(a){var l="Error trying to parse "+e.resource+" as Notation3:\n"+a+":\n"+a.stack;return void i.failFetch(e,l)}i.addStatus(e.req,"N3 parsed: "+n.statementCount+" triples in "+n.lines+" lines."),i.store.add(e.original,s.rdf("type"),s.link("RDFDocument"),i.appNode);[e.original.uri];i.doneFetch(e)}}},r.Fetcher.N3Handler.toString=function(){return"N3Handler"},r.Fetcher.N3Handler.register=function(e){e.mediatypes["text/n3"]={q:"1.0"},e.mediatypes["application/x-turtle"]={q:1},e.mediatypes["text/turtle"]={q:1}},r.Fetcher.N3Handler.pattern=new RegExp("(application|text)/(x-)?(rdf\\+)?(n3|turtle)"),r.Util.callbackify(this,["request","recv","headers","load","fail","refresh","retract","done"]),this.addHandler=function(e){i.handlers.push(e),e.register(i)},this.switchHandler=function(e,t,n,o){for(var s=null,a=0;a<this.handlers.length;a++)""+this.handlers[a]===e&&(s=this.handlers[a]);if(!s)throw new Error("web.js: switchHandler: name="+e+" , this.handlers ="+this.handlers+"\nswitchHandler: switching to "+s+"; sf="+i+"; typeof $rdf.Fetcher="+typeof r.Fetcher+";\n	 $rdf.Fetcher.HTMLHandler="+r.Fetcher.HTMLHandler+"\n\n	sf.handlers="+i.handlers+"\n");new s(o).handlerFactory(t),t.handle(n)},this.addStatus=function(e,t){var n=new Date;t="["+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+"."+n.getMilliseconds()+"] "+t;var i=this.store,o=i.the(e,s.link("status"));o&&o.append?o.append(i.literal(t)):r.log.warn("web.js: No list to add to: "+o+","+t)},this.failFetch=function(e,t){for(this.addStatus(e.req,t),e.options.noMeta||o.add(e.original,s.link("error"),t),e.resource.sameTerm(e.original)?console.log("@@ Recording failure for "+e.original+": "+e.status):console.log("@@ Recording failure original "+e.original+"( as "+e.resource+") : "+e.status),this.requested[r.uri.docpart(e.original.uri)]=e.status;this.fetchCallbacks[e.original.uri]&&this.fetchCallbacks[e.original.uri].length;)this.fetchCallbacks[e.original.uri].shift()(!1,"Fetch of <"+e.original.uri+"> failed: "+t,e);return delete this.fetchCallbacks[e.original.uri],this.fireCallbacks("fail",[e.original.uri,t]),e.abort(),e},this.linkData=function(e,t,n,i,a){if(n){var l,h=o.sym(r.uri.join(n,e.original.uri));if("alternate"===t||"seeAlso"===t||"meta"===t||"describedby"===t){if(h.uri===e.original.uri)return;l=s.rdfs("seeAlso")}else l="type"===t?r.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):o.sym(r.uri.join(t,"http://www.iana.org/assignments/link-relations/"));a?o.add(h,l,e.original,i):o.add(e.original,l,h,i)}},this.parseLinkHeader=function(e,t){var r;try{r=e.getResponseHeader("link")}catch(n){}if(r)for(var i=/<[^>]*>\s*(\s*;\s*[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*")))*(,|$)/g,o=/[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*"))/g,s=r.match(i),a=0;a<s.length;a++)for(var l=s[a].split(">"),h=l[0].substring(1),c=l[1],u=c.match(o),d=0;d<u.length;d++){var p=u[d],f=p.split("="),m=f[1].replace(/["']/g,"");this.linkData(e,m,h,t)}},this.doneFetch=function(e){for(this.addStatus(e.req,"Done."),this.requested[e.original.uri]="done";this.fetchCallbacks[e.original.uri]&&this.fetchCallbacks[e.original.uri].length;)this.fetchCallbacks[e.original.uri].shift()(!0,void 0,e);delete this.fetchCallbacks[e.original.uri],this.fireCallbacks("done",[e.original.uri])};var a=[r.Fetcher.RDFXMLHandler,r.Fetcher.XHTMLHandler,r.Fetcher.XMLHandler,r.Fetcher.HTMLHandler,r.Fetcher.TextHandler,r.Fetcher.N3Handler];a.map(this.addHandler),this.nowKnownAs=function(e,t){this.lookedUp[e.uri]?this.lookedUp[t.uri]||this.lookUpThing(t,e):this.lookedUp[t.uri]&&(this.lookedUp[e.uri]||this.lookUpThing(e,t))},this.webOperation=function(e,t,n){t=t.uri||t,n=n||{};var i=this;return new Promise(function(o,s){var a=r.Util.XMLHTTPFactory();a.options=n,n.noMeta||"undefined"==typeof tabulator||i.saveRequestMetadata(a,tabulator.kb,t),a.onreadystatechange=function(){if(4===a.readyState){var e=!a.status||a.status>=200&&a.status<300;n.noMeta||"undefined"==typeof tabulator||i.saveResponseMetadata(a,tabulator.kb),e&&o(a),s(a.status+" "+a.statusText)}},a.open(e,t,!0),n.contentType&&a.setRequestHeader("Content-type",n.contentType),a.send(n.data?n.data:void 0)})},this.webCopy=function(e,t,r){var n=this;return e=e.uri||e,new Promise(function(i,o){this.webOperation("GET",e).then(function(e){n.webOperation("PUT",t,{data:e.responseText,contentType:r})}).then(function(e){i(e)})["catch"](function(e){o(e)})})},this.lookUpThing=function(e,t,n,i,s){var a,l=o.uris(e),h=!0,c="",u={};if(n===!1||n===!0?(a=n,n={force:a}):(void 0===n&&(n={}),a=!!n.force),"undefined"!=typeof l)for(var d=0;d<l.length;d++){var p=l[d];u[p]=!0,this.lookedUp[p]=!0;var f=this,m=function(e){f.requestURI(r.uri.docpart(e),t,n,function(t,r,n){t?i&&i(!0,e):(i&&i(!1,r),h=!1,c+=r+"\n"),delete u[p],Object.keys(u).length>0||s&&s(h,c)})};m(p)}return l.length},this.load=function(e,t){var r=this;if(e instanceof Array){var n=e.map(function(e){return r.load(e)});return Promise.all(n)}return e=e.uri||e,new Promise(function(n,i){r.nowOrWhenFetched(e,t,function(e,t,r){e?n(r):i(t)})})},this.nowOrWhenFetched=function(e,t,n,i){e=e.uri||e,"function"==typeof t?(i={},n=t):"undefined"==typeof t||(i=t instanceof r.NamedNode?{referingTerm:t}:t),this.requestURI(e,t,i||{},n)},this.get=this.nowOrWhenFetched,this.getHeader=function(e,t){for(var r=this.store,n=r.each(void 0,s.link("requestedURI"),e.uri),i=0;i<n.length;i++){var o=n[i];if(void 0!==o){var a=r.any(o,s.link("response"));if(void 0!==o){var l=r.each(a,s.httph(t.toLowerCase()));return l.length?l.map(function(e){return e.value}):[]}}}},this.proxyIfNecessary=function(e){return"undefined"!=typeof tabulator&&tabulator.isExtension?e:r.Fetcher.crossSiteProxyTemplate&&"undefined"!=typeof document&&document.location&&"https:"===(""+document.location).slice(0,6)&&"http:"===e.slice(0,5)?r.Fetcher.crossSiteProxyTemplate.replace("{uri}",encodeURIComponent(e)):e},this.saveRequestMetadata=function(e,t,n){var i=t.bnode();if(e.resource=r.sym(n),e.req=i,!e.options.noMeta){var o=new Date,a="["+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()+"] ";t.add(i,s.rdfs("label"),t.literal(a+" Request for "+n),this.appNode),t.add(i,s.link("requestedURI"),t.literal(n),this.appNode),e.original&&e.original.uri!==n&&t.add(i,s.link("orginalURI"),t.literal(e.original.uri),this.appNode),t.add(i,s.link("status"),t.collection(),this.appNode)}return i},this.saveResponseMetadata=function(e,t){var n=t.bnode();if(e.req&&t.add(e.req,s.link("response"),n),t.add(n,s.http("status"),t.literal(e.status),n),t.add(n,s.http("statusText"),t.literal(e.statusText),n),e.headers={},"http"===r.uri.protocol(e.resource.uri)||"https"===r.uri.protocol(e.resource.uri)){e.headers=r.Util.getHTTPHeaders(e);for(var i in e.headers)t.add(n,s.httph(i.toLowerCase()),e.headers[i].trim(),n)}return n},this.requestURI=function(e,t,n,i){e=e.uri||e,e=e.split("#")[0],"boolean"==typeof n&&(n={force:n}),"undefined"==typeof n&&(n={});var o=!!n.force,a=this.store,l=arguments,h=n.baseURI||e;n.userCallback=i;var c=r.uri.protocol(e);if("tel"===c||"mailto"===c||"urn"===c)return console.log("Unsupported protocol in: "+e),i(!1,"Unsupported protocol",{status:900})||void 0;var u=a.sym(e),d=this.getState(e);if(o)delete this.nonexistant[e];else{if("fetched"===d)return i?i(!0):void 0;if("failed"===d)return i?i(!1,"Previously failed. "+this.requested[e],{status:this.requested[e]}):void 0}if(this.fireCallbacks("request",l),i&&(this.fetchCallbacks[e]?this.fetchCallbacks[e].push(i):this.fetchCallbacks[e]=[i]),this.requested[e]!==!0){this.requested[e]=!0,!n.noMeta&&t&&t.uri&&a.add(u.uri,s.link("requestedBy"),t.uri,this.appNode);var p=r.Util.XMLHTTPFactory(),f=p.req=a.bnode();p.original=r.sym(h),console.log("XHR original: "+p.original),p.options=n,p.resource=u;var m=this,g=new Date,v="["+g.getHours()+":"+g.getMinutes()+":"+g.getSeconds()+"] ";n.noMeta||(a.add(f,s.rdfs("label"),a.literal(v+" Request for "+e),this.appNode),a.add(f,s.link("requestedURI"),a.literal(e),this.appNode),a.add(f,s.link("status"),a.collection(),this.appNode));var y=function(){if(!p.withCredentials)return!1;if(p.retriedWithCredentials)return!0;p.retriedWithCredentials=!0,console.log("web: Retrying with no credentials for "+p.resource),p.abort(),delete m.requested[e];var r={};for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);return r.withCredentials=!1,m.addStatus(p.req,"Abort: Will retry with credentials SUPPRESSED to see if that helps"),m.requestURI(e,t,r,p.userCallback),!0},w=function(e){return function(t){if(e.onErrorWasCalled=!0,"undefined"!=typeof document&&r.Fetcher.crossSiteProxyTemplate&&document.location&&!e.proxyUsed){var n=r.uri.hostpart,i=""+document.location,o=e.resource.uri;if(n(i)&&n(o)&&n(i)!==n(o))if(401===e.status||403===e.status||404===e.status)b(e)();else{if(y(e))return;var a=r.Fetcher.crossSiteProxy(o);if(console.log("web: Direct failed so trying proxy "+a),m.addStatus(e.req,"BLOCKED -> Cross-site Proxy to <"+a+">"),e.aborted)return;var l=m.store,h=e.req;e.options.noMeta||l.add(h,s.http("redirectedTo"),l.sym(a),h),e.abort(),e.aborted=!0,m.addStatus(h,"redirected to new request"),m.requested[e.resource.uri]="redirected",m.redirectedTo[e.resource.uri]=a,m.fetchCallbacks[e.resource.uri]&&(m.fetchCallbacks[a]||(m.fetchCallbacks[a]=[]),m.fetchCallbacks[a]===m.fetchCallbacks[a].concat(m.fetchCallbacks[e.resource.uri]),delete m.fetchCallbacks[e.resource.uri]);var c=m.requestURI(a,e.resource,e.options,e.userCallback);if(c&&(c.proxyUsed=!0,c.original=e.original,console.log("Proxying but original still "+c.original)),c&&c.req)return void(e.options.noMeta||l.add(e.req,l.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),c.req,m.appNode))}e.status=999}}},b=function(t){return function(){var i=function(){if(!t.handleResponseDone){t.handleResponseDone=!0;var i=null,a=t.req;m.fireCallbacks("recv",l);var h=m.store;if(m.saveResponseMetadata(t,h),m.fireCallbacks("headers",[{uri:e,headers:t.headers}]),0===t.status){if(console.log("Masked error - status 0 for "+t.resource.uri),y(t))return;return void(t.status=900)}if(t.status>=400){if(404===t.status&&(h.fetcher.nonexistant[t.resource.uri]=!0),t.responseText.length>10){var c=h.bnode();h.add(c,s.http("content"),h.literal(t.responseText),c),t.statusText&&h.add(c,s.http("statusText"),h.literal(t.statusText),c)}return void m.failFetch(t,"HTTP error for "+t.resource+": "+t.status+" "+t.statusText)}var u,d=t.headers["content-location"],p=function(e){var t=a;if(d){var r=h.any(t,s.link("requestedURI"));r!==d&&h.add(h.sym(d),s.rdf("type"),e,m.appNode)}for(;;){var n=h.any(t,s.link("requestedURI"));if(n&&n.value&&h.add(h.sym(n.value),s.rdf("type"),e,m.appNode),t=h.any(void 0,h.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),t),!t)break;var i=h.any(t,h.sym("http://www.w3.org/2007/ont/link#response"));if(!i)break;var o=h.any(i,h.sym("http://www.w3.org/2007/ont/http#status"));if(!o)break;if("301"!==o&&"302"!==o)break}},f={rdf:"application/rdf+xml",owl:"application/rdf+xml",n3:"text/n3",ttl:"text/turtle",nt:"text/n3",acl:"text/n3",html:"text/html",xml:"text/xml"};if(200===t.status){p(s.link("Document"));var g=t.headers["content-type"];n.forceContentType&&(t.headers["content-type"]=n.forceContentType),(!g||g.indexOf("application/octet-stream")>=0)&&(u=f[t.resource.uri.split(".").pop()],u&&(t.headers["content-type"]=u)),g&&(0!==g.indexOf("image/")&&0!==g.indexOf("application/pdf")||p(h.sym("http://purl.org/dc/terms/Image"))),n.clearPreviousData&&h.removeDocument(t.resource)}if("file"!==r.uri.protocol(t.resource.uri)&&"chrome"!==r.uri.protocol(t.resource.uri)||(n.forceContentType?t.headers["content-type"]=n.forceContentType:(u=f[t.resource.uri.split(".").pop()],u?t.headers["content-type"]=u:t.headers["content-type"]="text/xml")),d){var v=r.uri.join(t.resource.uri,d);if(!o&&v!==t.resource.uri&&m.requested[v]&&"done"===m.requested[v])return m.doneFetch(t),void t.abort();m.requested[v]=!0}for(var w=0;w<m.handlers.length;w++)if(t.headers["content-type"]&&t.headers["content-type"].match(m.handlers[w].pattern)){i=new m.handlers[w];break}if(m.parseLinkHeader(t,a),!i)return void m.doneFetch(t);try{i.handlerFactory(t)}catch(b){m.failFetch(t,"Exception handling content-type "+t.headers["content-type"]+" was: "+b)}}};switch(t.readyState){case 0:var a,h=t.resource.uri;if(this.crossSiteProxyTemplate&&"undefined"!=typeof document&&document.location){var c=r.uri.hostpart,u=""+document.location;if(c(u)&&c(h)&&c(u)!==c(h)){if(a=this.crossSiteProxyTemplate.replace("{uri}",encodeURIComponent(h)),m.addStatus(t.req,"BLOCKED -> Cross-site Proxy to <"+a+">"),t.aborted)return;var d=m.store,p=t.req;d.add(p,s.http("redirectedTo"),d.sym(a),p);var f=t.req=d.bnode();d.add(p,s.http("redirectedRequest"),f,t.req);var g=new Date,v="["+g.getHours()+":"+g.getMinutes()+":"+g.getSeconds()+"] ";d.add(f,s.rdfs("label"),d.literal(v+" Request for "+a),this.appNode),d.add(f,s.link("status"),d.collection(),this.appNode),d.add(f,s.link("requestedURI"),d.literal(a),this.appNode);var w=d.bnode();d.add(p,s.link("response"),w),t.abort(),t.aborted=!0,t.redirected=!0,m.addStatus(p,"redirected XHR"),m.fetchCallbacks[t.resource.uri]&&(m.fetchCallbacks[a]||(m.fetchCallbacks[a]=[]),m.fetchCallbacks[a]===m.fetchCallbacks[a].concat(m.fetchCallbacks[t.resource.uri]),delete m.fetchCallbacks[t.resource.uri]),m.fireCallbacks("redirected",l),m.requested[t.resource.uri]="redirected";var b=m.requestURI(a,t.resource,t.options||{},t.userCallback);if(b&&b.req)return void d.add(t.req,d.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),b.req,m.appNode)}}m.failFetch(t,"HTTP Blocked. (ReadyState 0) Cross-site violation for <"+e+">");break;case 3:break;case 4:if(i(),t.handle&&void 0!==t.responseText){if("redirected"===m.requested[t.resource.uri])break;m.fireCallbacks("load",l),t.handle(function(){m.doneFetch(t)})}else t.redirected?m.addStatus(t.req,"Aborted and redirected to new request."):m.addStatus(t.req,"Fetch over. No data handled. Aborted = "+t.aborted)}}},T=e;"undefined"!=typeof tabulator&&tabulator.preferences.get("offlineModeUsingLocalhost")&&"http://"===T.slice(0,7)&&"localhost/"!==T.slice(7,17)&&(T="http://localhost/"+T.slice(7),r.log.warn("Localhost kludge for offline use: actually getting <"+T+">"));var x="https:"===T.slice(0,6);void 0!==n.withCredentials&&(x=n.withCredentials);var N=this.proxyIfNecessary(T);p.onerror=w(p),p.onreadystatechange=b(p),p.timeout=m.timeout,p.withCredentials=x,p.actualProxyURI=N,p.req=f,p.options=n,p.options=n,p.resource=u,p.requestedURI=T,p.ontimeout=function(){m.failFetch(p,"requestTimeout")};try{p.open("GET",N,this.async)}catch(R){return this.failFetch(p,"XHR open for GET failed for <"+T+">:\n	"+R)}if(o&&p.setRequestHeader("Cache-control","no-cache"),"undefined"!=typeof tabulator&&tabulator.isExtension&&p.channel&&("http"===r.uri.protocol(p.resource.uri)||"https"===r.uri.protocol(p.resource.uri)))try{p.channel.notificationCallbacks={getInterface:function(e){return e.equals(Components.interfaces.nsIChannelEventSink)?{onChannelRedirect:function(e,i,o){if(!p.aborted){var a=m.store,h=i.URI.spec,c=p.req;if(!p.options.noMeta){m.addStatus(p.req,"Redirected: "+p.status+" to <"+h+">"),a.add(c,s.http("redirectedTo"),a.sym(h),p.req);var u=p.req=a.bnode();a.add(c,s.http("redirectedRequest"),u,this.appNode);var d=new Date,f="["+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()+"] ";a.add(u,s.rdfs("label"),a.literal(f+" Request for "+h),this.appNode),a.add(u,s.link("status"),a.collection(),this.appNode),a.add(u,s.link("requestedURI"),a.literal(h),this.appNode);var g=a.bnode();a.add(c,s.link("response"),g),a.add(g,s.http("status"),a.literal(p.status),g),p.statusText&&a.add(g,s.http("statusText"),a.literal(p.statusText),g)}if(p.status-0!==303&&(a.HTTPRedirects[p.resource.uri]=h),p.status-0===301&&t){var v=r.uri.docpart(t.uri),y="Warning: "+p.resource+" has moved to <"+h+">.";t&&(y+=" Link in <"+v+" >should be changed",a.add(v,a.sym("http://www.w3.org/2007/ont/link#warning"),y,m.appNode))}p.abort(),p.aborted=!0,m.fetchCallbacks[p.resource.uri]&&(m.fetchCallbacks[h]||(m.fetchCallbacks[h]=[]),m.fetchCallbacks[h]===m.fetchCallbacks[h].concat(m.fetchCallbacks[p.resource.uri]),delete m.fetchCallbacks[p.resource.uri]),m.addStatus(c,"redirected"),m.fireCallbacks("redirected",l),m.requested[p.resource.uri]="redirected",m.redirectedTo[p.resource.uri]=h;var w=h.indexOf("#");w>=0&&(p.options.noMeta||a.add(p.resource,a.sym("http://www.w3.org/2007/ont/link#warning"),"Warning: "+p.resource+" HTTP redirects to"+h+' which should not contain a "#" sign'),h=h.slice(0,w));var b=m.requestURI(h,p.resource,p.options,p.userCallback);b&&b.req&&!n.noMeta&&a.add(p.req,a.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),b.req,m.appNode)}},asyncOnChannelRedirect:function(e,n,i,o){if(!p.aborted){var a=m.store,l=n.URI.spec,h=p.req;m.addStatus(p.req,"Redirected: "+p.status+" to <"+l+">"),a.add(h,s.http("redirectedTo"),a.sym(l),p.req);var c=p.req=a.bnode();a.add(h,s.http("redirectedRequest"),c,p.req);var u=new Date,d="["+u.getHours()+":"+u.getMinutes()+":"+u.getSeconds()+"] ";a.add(c,s.rdfs("label"),a.literal(d+" Request for "+l),this.appNode),a.add(c,s.link("status"),a.collection(),this.appNode),a.add(c,s.link("requestedURI"),a.literal(l),this.appNode);var f=a.bnode();if(a.add(h,s.link("response"),f),a.add(f,s.http("status"),a.literal(p.status),f),p.statusText&&a.add(f,s.http("statusText"),a.literal(p.statusText),f),p.status-0!==303&&(a.HTTPRedirects[p.resource.uri]=l),p.status-0===301&&t){var g=r.uri.docpart(t.uri),v="Warning: "+p.resource+" has moved to <"+l+">.";t&&(v+=" Link in <"+g+" >should be changed",a.add(g,a.sym("http://www.w3.org/2007/ont/link#warning"),v,m.appNode))}p.abort(),p.aborted=!0;var y=l.indexOf("#");if(y>=0){var w="Warning: "+p.resource+" HTTP redirects to"+l+' which do not normally contain a "#" sign';a.add(p.resource,a.sym("http://www.w3.org/2007/ont/link#warning"),w),l=l.slice(0,y)}m.requested[p.resource.uri]="redirected",m.redirectedTo[p.resource.uri]=l;var b=m.requestURI(l,p.resource,p.options,p.userCallback);b&&(b.original=p.original,b.req&&a.add(p.req,a.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),b.req,m.appNode))}}}:Components.results.NS_NOINTERFACE}}}catch(I){return m.failFetch(p,"@@ Couldn't set callback for redirects: "+I)}try{var k="";for(var D in this.mediatypes){""!==k&&(k+=", "),k+=D;for(var C in this.mediatypes[D])k+=";"+C+"="+this.mediatypes[D][C]}p.setRequestHeader("Accept",k),this.addStatus(p.req,"Accept: "+k)}catch(I){throw new Error("Can't set Accept header: "+I)}try{p.send(null)}catch(R){return this.failFetch(p,"XHR send failed:"+R)}return setTimeout(function(){4!==p.readyState&&m.isPending(p.resource.uri)&&m.failFetch(p,"requestTimeout")},this.timeout),this.addStatus(p.req,"HTTP Request sent."),p}},this.objectRefresh=function(e){var t=o.uris(e);if("undefined"!=typeof t)for(var n=0;n<t.length;n++)this.refresh(this.store.sym(r.uri.docpart(t[n])))},this.unload=function(e){this.store.removeMany(void 0,void 0,void 0,e),delete this.requested[e.uri]},this.refresh=function(e,t){this.fireCallbacks("refresh",arguments),this.requestURI(e.uri,void 0,{force:!0,clearPreviousData:!0},t)},this.retract=function(e){this.store.removeMany(void 0,void 0,void 0,e),e.uri&&delete this.requested[r.uri.docpart(e.uri)],this.fireCallbacks("retract",arguments)},this.getState=function(e){return"undefined"==typeof this.requested[e]?"unrequested":this.requested[e]===!0?"requested":"done"===this.requested[e]?"fetched":"redirected"===this.requested[e]?this.getState(this.redirectedTo[e]):"failed"},this.isPending=function(e){return this.requested[e]===!0}},r.fetcher=function(e,t,n){return new r.Fetcher(e,t,n)},r.parsable={"text/n3":!0,"text/turtle":!0,"application/rdf+xml":!0,"application/rdfa":!0,"application/ld+json":!0},r.parse=function(e,t,n,i,o){function s(){o&&o(null,t)}function a(e){if("application/ld+json"!==i||"application/nquads"!==i||"application/n-quads"!==i){if(!o)throw new Error("Error trying to parse <"+n+"> as "+i+":\n"+e+":\n"+e.stack);o(e,t)}}function l(e,r){e&&o(e,t);try{f.parse(r,h)}catch(e){o(e,t)}}function h(e,r,n){if(e&&o(e,t),r)y.push(r);else{for(var i=0;i<y.length;i++)c(t,y[i]);o(null,t)}}function c(e,t){var r=u(t.subject),n=u(t.predicate),i=u(t.object),o=null;t.graph&&(o=u(t.graph)),e.add(r,n,i,o)}function u(e){var t;if(v.isLiteral(e)){t=v.getLiteralValue(e);var n=v.getLiteralLanguage(e),i=new r.NamedNode(v.getLiteralType(e));return new r.Literal(t,n,i)}return v.isIRI(e)?new r.NamedNode(e):v.isBlank(e)?(t=e.substring(2,e.length),new r.BlankNode(t)):null}try{if("text/n3"===i||"text/turtle"===i){var d=r.N3Parser(t,t,n,n,null,null,"",null);d.loadBuf(e),s()}else if("application/rdf+xml"===i){var p=new r.RDFParser(t);p.parse(r.Util.parseXML(e),n,t.sym(n)),s()}else if("application/rdfa"===i)r.parseDOM_RDFa(r.Util.parseXML(e),t,n),s();else if("application/sparql-update"===i)r.sparqlUpdateParser(e,t,n),s();else{if("application/ld+json"!==i&&"application/nquads"!==i&&"application/n-quads"!==i)throw new Error("Don't know how to parse "+i+" yet");var f=g.Parser(),v=g.Util,y=[];if("application/ld+json"===i){var w;try{w=JSON.parse(e)}catch(b){o(b,null)}m.toRDF(w,{format:"application/nquads"},l)}else l(null,e)}}catch(T){a(T)}},r.serialize=function(e,t,n,i,o){function s(e,t){return o?void o(e,t):t}var a=null;try{var l,h=r.Serializer(t),c=t.statementsMatching(void 0,void 0,void 0,e);switch(h.suggestNamespaces(t.namespaces),h.setBase(n),i){case"application/rdf+xml":return a=h.statementsToXML(c),s(null,a);case"text/n3":case"text/turtle":case"application/x-turtle":case"application/n3":return a=h.statementsToN3(c),s(null,a);case"application/ld+json":l=h.statementsToN3(c),r.convert.convertToJson(l,o);break;case"application/n-quads":case"application/nquads":l=h.statementsToN3(c),a=r.convert.convertToNQuads(l,o);break;default:throw new Error("Serialize: Content-type "+i+" not supported for data write.")}}catch(u){if(o)return u;throw u}},"undefined"==typeof r.convert&&(r.convert={}),r.convert.convertToJson=function(e,t){var r,n=g.Parser(),i=g.Writer({format:"N-Quads"});f.waterfall([function(t){n.parse(e,t)},function(e,t,r){null!==e&&i.addTriple(e),"function"==typeof r&&i.end(r)},function(e,t){try{m.fromRDF(e,{format:"application/nquads"},t)}catch(r){t(r)}},function(e,n){r=JSON.stringify(e),t(null,r)}],function(e,n){t(e,r)})},r.convert.convertToNQuads=function(e,t){var r,n=g.Parser(),i=g.Writer({format:"N-Quads"});f.waterfall([function(t){n.parse(e,t)},function(e,t,r){null!==e&&i.addTriple(e),"function"==typeof r&&i.end(r)},function(e,n){r=e,t(null,r)}],function(e,n){t(e,r)})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports.$rdf=r):("function"==typeof define&&define.amd&&define([],function(){return r}),e.$rdf=r),r.buildTime="2016-04-09T12:10:06"}(this);
},{"async":1,"jsonld":14,"n3":15,"xmldom":40,"xmlhttprequest":undefined}]},{},[])("rdflib")
});

